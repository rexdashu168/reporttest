<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RexÂ§ßÂèîÁöÑ168Âè∞ËÇ°Á†îÁ©∂ÂÆ§ v11.7</title>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #c96442; --bg: #f5f4ef; --text: #333; --gray: #666; --border: #e0e0e0; --link: #2980b9; --up: #e74c3c; --down: #27ae60; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif; background: var(--bg); color: var(--text); padding-bottom: 60px; }
        .container { max-width: 800px; margin: 0 auto; padding: 12px; }
        @media(min-width: 1024px) { .container { max-width: 1400px; padding: 20px; } }
        @media(min-width: 1600px) { .container { max-width: 1600px; } }

        .loading-overlay { position: fixed; top:0; left:0; right:0; bottom:0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.3s; }
        .loading-overlay.hidden { opacity: 0; pointer-events: none; }
        .loading-spinner { width: 40px; height: 40px; border: 3px solid #e0e0e0; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .header { text-align: center; padding: 15px 0; border-bottom: 1px solid var(--border); }
        .header h1 { color: var(--primary); font-size: 22px; margin-bottom: 5px; font-weight: 800; }
        .db-switcher { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin: 15px 0; }
        .db-tab { padding: 6px 14px; background: #fff; border: 1px solid var(--border); border-radius: 20px; font-size: 13px; color: var(--gray); cursor: pointer; display: flex; align-items: center; gap: 5px; transition: all 0.2s; }
        .db-tab:hover { border-color: var(--primary); }
        .db-tab.active { background: var(--primary); color: #fff; border-color: var(--primary); }
        .count { background: rgba(0,0,0,0.1); padding: 1px 6px; border-radius: 10px; font-size: 10px; }

        .search-box { position: relative; margin-bottom: 15px; }
        .search-input { width: 100%; padding: 12px 35px 12px 40px; border-radius: 25px; border: 2px solid var(--border); background: #fff; font-size: 15px; outline: none; transition: border-color 0.2s; }
        .search-input:focus { border-color: var(--primary); }
        .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #999; }
        .clear-btn { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; background: #ccc; color: #fff; border-radius: 50%; font-size: 12px; line-height: 20px; text-align: center; cursor: pointer; display: none; }

        /* CB Áµ±Ë®àÂçÄÂ°ä */
        .cb-stats { background: #fff5f5; border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid #ffe0e0; }
        .cb-mode-header { background: linear-gradient(135deg, #e67e22, #d35400); color: #fff; padding: 10px 15px; border-radius: 10px 10px 0 0; font-weight: 700; font-size: 14px; text-align: center; margin-bottom: 0; }
        .cb-mode-switcher { display: flex; flex-direction: column; gap: 8px; margin-bottom: 12px; background: #fff5f0; padding: 12px; border-radius: 0 0 10px 10px; border: 1px solid #f5d5c5; border-top: none; }
        .cb-mode-row { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        .cb-mode-tab { padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; border: 1px solid #ddd; background: #fff; color: #666; transition: all 0.2s; }
        .cb-mode-tab:hover { border-color: var(--primary); }
        .cb-mode-tab.active { background: var(--primary); color: #fff; border-color: var(--primary); }
        .cb-sub-switcher { display: flex; gap: 6px; margin-bottom: 12px; padding-left: 10px; }
        .cb-sub-tab { padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: 600; cursor: pointer; border: 1px solid #ccc; background: #f9f9f9; color: #666; transition: all 0.2s; }
        .cb-sub-tab:hover { border-color: #3498db; }
        .cb-sub-tab.active { background: #3498db; color: #fff; border-color: #3498db; }
        .cb-sub-tab.blue { border-color: #90caf9; background: #e3f2fd; color: #1976d2; }
        .cb-sub-tab.blue:hover { border-color: #1976d2; }
        .cb-sub-tab.blue.active { background: #1976d2; color: #fff; border-color: #1976d2; }
        .cb-sub-tabs { display: flex; gap: 8px; margin-bottom: 12px; padding: 10px; background: #e3f2fd; border-radius: 10px; flex-wrap: wrap; }
        .cb-info-tabs { display: flex; gap: 8px; margin-top: 12px; padding: 10px; background: #e8f5e9; border-radius: 10px; flex-wrap: wrap; }
        .cb-info-tab { padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: 600; cursor: pointer; border: 1px solid #a5d6a7; background: #e8f5e9; color: #2e7d32; transition: all 0.2s; }
        .cb-info-tab:hover { border-color: #4caf50; }
        .cb-info-tab.active { background: #4caf50; color: #fff; border-color: #4caf50; }
        .cb-stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; }
        .cb-stat-item { background: #fff; padding: 12px 8px; border-radius: 8px; text-align: center; }
        .cb-stat-item.clickable { cursor: pointer; transition: all 0.2s; }
        .cb-stat-item.clickable:hover { background: #fff8f0; border: 1px solid var(--primary); }
        .cb-stat-num { font-size: 22px; font-weight: 800; color: var(--primary); }
        .cb-stat-label { font-size: 11px; color: #888; margin-top: 2px; }
        .cb-ind-title { font-size: 13px; font-weight: 600; color: #666; margin-bottom: 10px; }
        .cb-ind-grid { display: flex; flex-wrap: wrap; gap: 8px; }
        .cb-ind-tag { padding: 6px 12px; background: #fff; border-radius: 20px; font-size: 12px; color: #666; cursor: pointer; transition: all 0.2s; border: 1px solid #eee; }
        .cb-ind-tag:hover { border-color: var(--primary); color: var(--primary); }
        .cb-ind-tag .num { background: var(--primary); color: #fff; padding: 1px 6px; border-radius: 10px; font-size: 10px; margin-left: 4px; }
        
        /* Á´∂ÊãçÂâçÂçÅÂêçË°®Ê†º */
        .auction-top10-table { overflow-x: auto; margin-bottom: 10px; }
        .auction-top10-table table { width: 100%; border-collapse: collapse; font-size: 12px; background: #fff; border-radius: 8px; overflow: hidden; }
        .auction-top10-table th { background: #f8f8f8; padding: 8px 6px; text-align: center; font-weight: 600; color: #555; border-bottom: 1px solid #eee; white-space: nowrap; }
        .auction-top10-table td { padding: 8px 6px; text-align: center; border-bottom: 1px solid #f5f5f5; }
        .auction-top10-table tr:hover { background: #fff8f0; }
        .auction-top10-table .code { color: var(--primary); font-weight: 600; }
        .auction-top10-table .highlight { color: var(--primary); font-weight: 700; }
        .auction-top10-table .highlight-red { color: #e74c3c; font-weight: 700; }
        
        /* ÊµÅÈÄöÈ§òÈ°çÂâçÂçÅÂêçË°®Ê†º */
        .balance-top10-table { overflow-x: auto; margin-bottom: 10px; }
        .balance-top10-table table { width: 100%; border-collapse: collapse; font-size: 12px; background: #fff; border-radius: 8px; overflow: hidden; }
        .balance-top10-table th { background: #f8f8f8; padding: 8px 4px; text-align: center; font-weight: 600; color: #555; border-bottom: 1px solid #eee; white-space: nowrap; font-size: 11px; }
        .balance-top10-table td { padding: 6px 4px; text-align: center; border-bottom: 1px solid #f5f5f5; font-size: 11px; }
        .balance-top10-table tr:hover { background: #fff8f0; }
        .balance-top10-table .code { color: var(--primary); font-weight: 600; }
        .balance-top10-table .name-cell { text-align: left; min-width: 80px; max-width: 120px; white-space: normal; line-height: 1.3; }
        .balance-top10-table .highlight-red { color: #e74c3c; font-weight: 700; }
        
        /* ÊµÅÈÄöÈ§òÈ°ç‰∏ªË°®Ê†ºÊ¨ÑÂØ¨Á∏ÆÊ∏õ */
        .cb-table.balance-table { font-size: 11px; }
        .cb-table.balance-table th, .cb-table.balance-table td { padding: 6px 4px; }
        .cb-table.balance-table .name-col { max-width: 90px; white-space: normal; line-height: 1.3; text-align: left; }
        
        /* ‰∏ªÊó®Ê¨Ñ‰Ωç */
        .cb-table .subject-col { text-align: left; font-size: 11px; line-height: 1.4; max-width: 300px; white-space: normal; }
        .cb-table .name-col { max-width: 100px; white-space: normal; line-height: 1.3; text-align: left; }

        .card-list { display: flex; flex-direction: column; gap: 12px; }
        @media(min-width: 1024px) { .card-list:not(.cb-mode) { display: grid; grid-template-columns: repeat(2, 1fr); } }
        @media(min-width: 1400px) { .card-list:not(.cb-mode) { grid-template-columns: repeat(3, 1fr); } }
        .card-list.cb-mode { display: block; }
        .card { background: #fff; padding: 15px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 2px 5px rgba(0,0,0,0.02); cursor: pointer; transition: all 0.2s; }
        .card:hover { border-color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .card.industry-card { border-left: 4px solid #9b59b6; background: linear-gradient(135deg, #faf8fc 0%, #fff 100%); }
        .card-head { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .card-title { font-weight: 700; font-size: 16px; color: #2c3e50; }
        .card-meta { display: flex; gap: 5px; margin-bottom: 8px; flex-wrap: wrap; }
        .tag { font-size: 11px; padding: 2px 8px; border-radius: 6px; color: #fff; font-weight: 500; }
        .tag.brk { background: var(--primary); }
        .tag.ind { background: #2980b9; }
        .tag.trend-ind { background: #8e44ad; }
        .tag.dt { background: #e0e0e0; color: #666; }
        .tag.concept { background: #8e44ad; }
        .tag.trend-up { background: #27ae60; }
        .tag.trend-down { background: #e74c3c; }
        .tag.trend-warning { background: #f39c12; }
        .trend-warning { color: #f39c12; }
        
        /* ÂàóË°®ÂÖßÁØ©ÈÅ∏Ê°Ü - v11.7 Êñ∞Â¢ûÁç®Á´ãÂäüËÉΩ */
        .list-filter-bar { display: flex; align-items: center; gap: 10px; padding: 10px 12px; background: linear-gradient(135deg, #e8f5e9, #f1f8e9); border-radius: 10px; margin-bottom: 12px; flex-wrap: wrap; border: 1px solid #c8e6c9; }
        .list-filter-input { flex: 1; min-width: 180px; padding: 10px 15px; border: 2px solid #a5d6a7; border-radius: 25px; font-size: 14px; outline: none; transition: all 0.2s; background: #fff; }
        .list-filter-input:focus { border-color: #4caf50; box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1); }
        .list-filter-input::placeholder { color: #9e9e9e; }
        .list-filter-count { font-size: 13px; color: #555; white-space: nowrap; font-weight: 500; }
        .list-filter-count b { color: #4caf50; font-size: 15px; }
        .list-filter-clear { padding: 6px 12px; background: #ef5350; color: #fff; border: none; border-radius: 15px; font-size: 12px; cursor: pointer; transition: all 0.2s; }
        .list-filter-clear:hover { background: #d32f2f; }
        
        .tag.cb-tag { background: #e74c3c; font-size: 10px; padding: 1px 6px; }
        .cb-tags { display: flex; gap: 3px; flex-wrap: wrap; margin-left: auto; }
        .card-head { display: flex; align-items: center; gap: 8px; }
        .news-type { font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-right: 6px; font-weight: 600; }
        .news-type.ind-type { background: #9b59b6; color: #fff; }
        
        /* CB Âü∫Êú¨Ë≥áÊñôÂ≠êÊ®ôÁ±§ */
        .cb-info-tabs { display: flex; gap: 8px; margin: 10px 0; flex-wrap: wrap; }
        .cb-table tr.active-cb td { background: #e8f5e9; }
        .cb-table tr.active-cb:hover td { background: #c8e6c9; }
        
        /* ÁµêÊûúÂàóÂíå CB ÁØ©ÈÅ∏Ê®ôÁ±§ */
        .result-bar { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; margin-bottom: 10px; }
        .cb-filter-tags { display: flex; flex-wrap: wrap; gap: 6px; }
        .cb-filter-tag { font-size: 11px; padding: 4px 10px; border-radius: 15px; cursor: pointer; border: 1px solid #ddd; background: #fff; transition: all 0.2s; }
        .cb-filter-tag:hover { border-color: var(--primary); }
        .cb-filter-tag.active { background: var(--primary); color: #fff; border-color: var(--primary); }
        .cb-filter-tag .cnt { margin-left: 4px; opacity: 0.7; }
        .card-body { font-size: 13px; color: #555; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

        /* CB ÂàóË°®Ë°®Ê†º */
        .cb-table-wrap { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .cb-table { width: 100%; border-collapse: collapse; font-size: 13px; background: #fff; border-radius: 8px; overflow: hidden; }
        .cb-table th { background: #f8f9fa; padding: 12px 8px; text-align: center; color: #666; font-weight: 600; border-bottom: 2px solid #eee; white-space: nowrap; }
        .cb-table td { padding: 10px 8px; border-bottom: 1px solid #f0f0f0; text-align: center; white-space: nowrap; }
        .cb-table tr:hover td { background: #fffaf8; }
        .cb-table tr.filtered-hidden { display: none; }
        .cb-table .code { color: var(--primary); font-weight: 600; cursor: pointer; }
        .cb-table .stock { color: var(--link); cursor: pointer; }
        .cb-table th.sortable { cursor: pointer; user-select: none; }
        .cb-table th.sortable:hover { background: #eee; }
        .cb-table th .sort-icon { font-size: 10px; color: #999; margin-left: 2px; }
        .cb-table th.sort-asc .sort-icon { color: var(--primary); }
        .cb-table th.sort-desc .sort-icon { color: var(--primary); }
        .cb-table th.sort-asc .sort-icon::after { content: '‚Üë'; }
        .cb-table th.sort-desc .sort-icon::after { content: '‚Üì'; }
        .cb-table tfoot { background: #f8f9fa; }
        .cb-table tfoot td { border-top: 2px solid #ddd; padding: 12px 8px; }
        
        /* ÊâãÊ©üÁâàÈö±ËóèÈÉ®ÂàÜÊ¨Ñ‰Ωç */
        @media(max-width: 768px) {
            .cb-table { font-size: 12px; }
            .cb-table th, .cb-table td { padding: 8px 5px; }
            .cb-table .hide-mobile { display: none; }
        }
        
        /* Ê°åÊ©üÁâàÊªøÁâà */
        @media(min-width: 1024px) {
            .cb-table { font-size: 14px; }
            .cb-table th, .cb-table td { padding: 12px 10px; }
        }

        /* Modal */
        .modal { position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.6); z-index: 1000; display: none; justify-content: center; align-items: flex-end; }
        .modal.show { display: flex; }
        .modal-inner { background: #fff; width: 100%; max-width: 650px; height: 92vh; border-radius: 16px 16px 0 0; display: flex; flex-direction: column; animation: slideUp 0.3s; }
        @media(min-width: 1024px) { .modal-inner { max-width: 900px; } }
        @media(min-width: 1400px) { .modal-inner { max-width: 1100px; } }
        @keyframes slideUp { from{transform:translateY(100%)} to{transform:translateY(0)} }
        
        .m-head { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: flex-start; }
        .m-close { width: 32px; height: 32px; border-radius: 50%; border: none; background: #f0f0f0; font-size: 20px; color: #666; cursor: pointer; display: flex; justify-content: center; align-items: center; flex-shrink: 0; }
        .m-close:hover { background: #e0e0e0; }
        
        .nav-grid { display: flex; gap: 4px; padding: 10px 15px; background: #fafafa; border-bottom: 1px solid #eee; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .nav-btn { padding: 6px 10px; border-radius: 8px; border: none; background: #f0f0f0; font-size: 11px; font-weight: 600; color: #666; cursor: pointer; white-space: nowrap; transition: all 0.2s; flex-shrink: 0; }
        .nav-btn.active { background: var(--primary); color: #fff; }
        .nav-btn.green { background: #e8f5e9; color: #2e7d32; border: 1px solid #a5d6a7; }
        .nav-btn.green.active { background: #4caf50; color: #fff; border-color: #4caf50; }
        
        /* ÁØ©ÈÅ∏ÂäüËÉΩ */
        .filterable { cursor: pointer; position: relative; }
        .filterable:hover { background: #fff3cd; }
        .filter-dropdown { position: absolute; top: 100%; left: 0; background: #fff; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 100; min-width: 120px; max-height: 200px; overflow-y: auto; display: none; }
        .filter-dropdown.show { display: block; }
        .filter-dropdown div { padding: 8px 12px; cursor: pointer; font-size: 12px; border-bottom: 1px solid #eee; }
        .filter-dropdown div:hover { background: #f5f5f5; }
        .filter-dropdown div.active { background: #e3f2fd; color: #1976d2; font-weight: 600; }
        .filter-dropdown div:last-child { border-bottom: none; }
        
        /* Áµ±Ë®àÂàó */
        .stat-row { background: #f0f7ff !important; border-top: 2px solid var(--primary); }
        .stat-row td { color: var(--primary); }

        .m-body { flex: 1; overflow-y: auto; padding: 15px; background: #fff; -webkit-overflow-scrolling: touch; }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }
        
        .m-footer-tags { padding: 12px 15px; border-top: 1px solid #eee; background: #fafafa; display: none; }
        .m-footer-tags.show { display: block; }
        .m-footer-tags .tags-wrap { display: flex; flex-wrap: wrap; gap: 6px; }
        .m-footer-tags .tag { padding: 6px 12px; font-size: 12px; cursor: pointer; transition: all 0.2s; }
        .m-footer-tags .tag:hover { transform: scale(1.05); }

        .section-head { font-size: 14px; font-weight: 700; color: #444; margin: 20px 0 10px; padding: 8px 12px; background: linear-gradient(90deg, #f8f9fa, transparent); border-left: 4px solid var(--primary); border-radius: 0 8px 8px 0; }
        .section-head:first-child { margin-top: 0; }
        .hl-block { background: #fafaf8; padding: 12px; border-radius: 8px; border-left: 4px solid var(--primary); margin-bottom: 10px; font-size: 13px; line-height: 1.7; white-space: pre-wrap; }
        .hl-block b { color: var(--primary); }
        .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
        .info-label { color: #666; }
        .info-val { font-weight: 600; color: #333; }
        
        .list-item { padding: 12px; border: 1px solid #eee; border-radius: 10px; margin-bottom: 8px; background: #fff; cursor: pointer; transition: all 0.2s; }
        .list-item:hover { border-color: var(--primary); background: #fffaf8; }
        .list-title { font-weight: 700; font-size: 14px; color: #2c3e50; margin-bottom: 4px; }
        .list-sub { font-size: 12px; color: #888; margin-bottom: 6px; }
        .list-content { font-size: 13px; color: #555; line-height: 1.6; white-space: pre-wrap; }

        .tag-link { color: var(--link); cursor: pointer; font-weight: 600; }
        .tag-link:hover { text-decoration: underline; }
        
        .fin-switcher { display: flex; margin-bottom: 10px; border: 1px solid var(--primary); border-radius: 6px; overflow: hidden; }
        .fin-btn { flex: 1; padding: 8px; text-align: center; font-size: 13px; color: var(--primary); background: #fff; cursor: pointer; font-weight: 600; border-right: 1px solid var(--primary); transition: all 0.2s; }
        .fin-btn:last-child { border-right: none; }
        .fin-btn.active { background: var(--primary); color: #fff; }
        .fin-sub-pane { display: none; }
        .fin-sub-pane.active { display: block; }
        
        .rev-unit { text-align: right; font-size: 11px; color: #888; margin-bottom: 8px; }

        .table-wrap { overflow-x: auto; border: 1px solid #eee; border-radius: 8px; margin-bottom: 10px; -webkit-overflow-scrolling: touch; }
        .fin-table { width: 100%; border-collapse: collapse; font-size: 12px; white-space: nowrap; }
        .fin-table th { background: #f8f9fa; padding: 10px 8px; border-bottom: 2px solid #ddd; text-align: right; color: #555; position: sticky; top: 0; }
        .fin-table td { padding: 10px 8px; border-bottom: 1px solid #eee; text-align: right; color: #333; }
        .fin-table th:first-child, .fin-table td:first-child { position: sticky; left: 0; background: #fff; border-right: 1px solid #eee; text-align: left; z-index: 2; font-weight: 700; }
        .fin-table tr:nth-child(even) td { background: #fcfcfc; }
        .fin-table tr:nth-child(even) td:first-child { background: #fcfcfc; }
        .fin-table .highlight-row td { background: #fff3e0; font-weight: 700; }
        .fin-table .highlight-row td:first-child { background: #fff3e0; color: var(--primary); }
        
        .t-up { color: var(--up); font-weight: 700; }
        .t-down { color: var(--down); font-weight: 700; }

        .rating-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 15px; border-radius: 12px; margin-bottom: 15px; }
        .rating-card .big-num { font-size: 28px; font-weight: 800; }
        .rating-card .label { font-size: 12px; opacity: 0.8; }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-box { background: #f8f9fa; padding: 12px; text-align: center; border-radius: 8px; }
        .stat-box .num { font-size: 18px; font-weight: 700; color: var(--primary); }
        .stat-box .lbl { font-size: 11px; color: #888; margin-top: 2px; }

        .qa-item { margin-bottom: 15px; }
        .qa-q { background: #e3f2fd; padding: 10px 12px; border-radius: 8px 8px 0 0; font-weight: 600; color: #1565c0; font-size: 13px; }
        .qa-a { background: #f5f5f5; padding: 10px 12px; border-radius: 0 0 8px 8px; font-size: 13px; line-height: 1.6; color: #444; }

        .timeline-item { position: relative; padding-left: 20px; margin-bottom: 12px; }
        .timeline-item::before { content: ''; position: absolute; left: 0; top: 8px; width: 10px; height: 10px; background: var(--primary); border-radius: 50%; }
        .timeline-item::after { content: ''; position: absolute; left: 4px; top: 20px; width: 2px; height: calc(100% + 4px); background: #e0e0e0; }
        .timeline-item:last-child::after { display: none; }
        .timeline-date { font-size: 12px; font-weight: 700; color: var(--primary); }
        .timeline-text { font-size: 13px; color: #444; margin-top: 2px; }

        @media(min-width: 768px) { .modal { align-items: center; } .modal-inner { height: 85vh; border-radius: 16px; } }
        @media(max-width: 480px) { .cb-stats-grid { grid-template-columns: repeat(3, 1fr); } .cb-stat-num { font-size: 18px; } }
    </style>
</head>
<body>

<div class="loading-overlay" id="loader">
    <div class="loading-spinner"></div>
    <div style="font-weight:700;font-size:18px">RexÂ§ßÂèîÁöÑ168Âè∞ËÇ°Á†îÁ©∂ÂÆ§</div>
    <div style="font-size:12px;color:#888;margin-top:8px" id="loadStatus">Ê≠£Âú®ËºâÂÖ•Ë≥áÊñôÂ∫´...</div>
</div>

<div class="container">
    <div class="header">
        <h1>üìä RexÂ§ßÂèîÁöÑ168Âè∞ËÇ°Á†îÁ©∂ÂÆ§</h1>
        <p style="font-size:12px;color:#666">ÂÖ®Êñπ‰ΩçÂè∞ËÇ°ÊäïË≥áÊ±∫Á≠ñÁ≥ªÁµ± v11.7</p>
    </div>

    <div class="db-switcher">
        <div class="db-tab active" data-db="news">‚ö° Â§ñÈõª <span class="count" id="c-news">0</span></div>
        <div class="db-tab" data-db="memo">üìã Memo <span class="count" id="c-memo">0</span></div>
        <div class="db-tab" data-db="reports">üìë Áî¢Ê•≠ <span class="count" id="c-reports">0</span></div>
        <div class="db-tab" data-db="strategy">üîÆ Â±ïÊúõ <span class="count" id="c-strategy">0</span></div>
        <div class="db-tab" data-db="stocks">üè¢ ÂÄãËÇ° <span class="count" id="c-stocks">0</span></div>
        <div class="db-tab" data-db="trends">üìà Ë∂®Âã¢ <span class="count" id="c-trends">0</span></div>
        <div class="db-tab" data-db="cb">üé´ CB <span class="count" id="c-cb">0</span></div>
    </div>

    <div class="search-box">
        <span class="search-icon">üîç</span>
        <input type="text" class="search-input" id="search" placeholder="ÊêúÂ∞ãÂÖ¨Âè∏„ÄÅ‰ª£Ëôü„ÄÅÁî¢Ê•≠„ÄÅ#Tag..." oninput="handleInput(this)">
        <div class="clear-btn" id="clearBtn" onclick="clearSearch()">‚úï</div>
    </div>

    <!-- CB Áµ±Ë®àÂçÄÂ°ä (Âè™Âú® CB ÂàÜÈ†ÅÈ°ØÁ§∫) -->
    <div id="cbStatsArea" style="display:none"></div>
    
    <!-- ÂÄãËÇ°Áµ±Ë®àÂçÄÂ°ä (Âè™Âú®ÂÄãËÇ°ÂàÜÈ†ÅÈ°ØÁ§∫) -->
    <div id="stockStatsArea" style="display:none"></div>
    
    <!-- Memo Áµ±Ë®àÂçÄÂ°ä (Âè™Âú® Memo ÂàÜÈ†ÅÈ°ØÁ§∫) -->
    <div id="memoStatsArea" style="display:none"></div>

    <div class="result-bar">
        <div style="font-size:12px;color:#666;">ÊâæÂà∞ <b id="resCount" style="color:var(--primary)">0</b> Á≠ÜË≥áÊñô</div>
        <div id="cbFilterTags" class="cb-filter-tags" style="display:none"></div>
    </div>
    
    <!-- v11.7: ÂàóË°®ÁØ©ÈÅ∏Ê°ÜÂçÄÂüü (ÂãïÊÖãÊèíÂÖ•) -->
    <div id="listFilterArea"></div>
    
    <div class="card-list" id="list"></div>
</div>

<div class="modal" id="modal" onclick="closeModal(event)">
    <div class="modal-inner" onclick="event.stopPropagation()">
        <div class="m-head">
            <div id="m-info" style="flex:1"></div>
            <button class="m-close" onclick="closeModal()">√ó</button>
        </div>
        <div class="nav-grid" id="navGrid"></div>
        <div class="m-body" id="m-body"></div>
        <div class="m-footer-tags" id="m-tags"></div>
    </div>
</div>

<script>
const FILES = {
    NEWS: '01_news.xlsx', MEMO: '02_memo.xlsx', REPORTS: '03_reports.xlsx',
    MASTER: '04_master.xlsx', STRAT: '05_Strategy_01.xlsx', CB: '00_CB.xlsx', REV: '06_revenue.xlsx'
};

const DB = { 
    news:[], memo:[], memoStock:[], memoIndustry:[], reports:[], strategy:[], stocks:{}, 
    cb:[], cbHistory:[], cbAuction:[], cbPrimary:[], cbBoard:[], cbBalance:[], cbCBAS:[],
    cbRedeem:[], cbStopConv:[], cbPriceAdj:[], cbConcept:[], cbAll:[], cbPutback:[],
    conceptLists: {},
    trends:[], conceptStocks:[] 
};
let CB_MODE = 'info';
let CB_INFO_TAB = 'issue';
let CB_INFO_SUB = 'stats';
let PRIMARY_MODE = 'underwriting';
let STOCK_MODE = 'all';
let MEMO_MODE = 'all';
const META = { 
    memoDetail:{}, tracking:{}, finance:{}, products:{}, 
    concepts:{}, cbMap:{}, relatedNews:{}, relatedMemo:{},
    reportFocus:{}, reportViews:{}, reportRatings:{},
    stratMacro:{}, stratFundamental:{}, stratTheme:{}, stratChip:{}, stratTech:{}, stratQuarter:{}, stratPicks:{},
    revData: { month:{}, quarter:{}, year:{}, highlights:{} },
    cbStats: { total: 0, companies: 0, industries: {}, totalBalance: 0 },
    cbPrimaryStats: { underwriting: 0, board: 0 },
    cbBalanceStats: { total: 0, totalBalance: 0 },
    cbCBASStats: { total: 0 },
    stockStats: { total: 0, conceptTotal: 0, markets: {}, industries: {}, conceptCategories: {} },
    memoStats: { total: 0, stockTotal: 0, industryTotal: 0, brokers: {}, types: {} }
};

let CURR_DB = 'news';
const $ = id => document.getElementById(id);
const safe = v => (v==null||v==undefined?'':String(v).trim());

const normalizeCode = v => {
    if(!v) return '';
    let s = String(v).trim();
    if(s.match(/^\d+\.0$/)) s = s.replace('.0', '');
    s = s.replace(/\s*TT$/i, '');
    if(s.match(/^\d{1,4}$/) && s.length < 4) s = s.padStart(4, '0');
    return s;
};

const fmtDate = v => {
    if(!v) return '';
    if(typeof v === 'number' && v > 20000) { 
        const d = new Date((v-25569)*86400000); 
        return `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}`; 
    }
    return String(v).split(' ')[0].split('T')[0];
};
const getDateVal = v => { if(!v) return 0; if(typeof v === 'number') return (v-25569)*86400000; return new Date(v).getTime(); };
const fmtNum = (v, decimal=0) => {
    if(v===undefined||v===null||v==='') return '-';
    let n = parseFloat(String(v).replace(/,/g,''));
    if(isNaN(n)) return v;
    return decimal > 0 ? n.toFixed(decimal) : n.toLocaleString();
};
const colorClass = v => {
    if(!v||v==='-') return '';
    let n = parseFloat(String(v).replace(/[%$,]/g,''));
    return n>0?'t-up':n<0?'t-down':'';
};

const fmtTxt = t => {
    if(!t) return '';
    let html = safe(t).replace(/\n/g, '<br>');
    html = html.replace(/#(\S+)/g, '<span class="tag-link" onclick="setSearch(\'#$1\');closeModal()">#$1</span>');
    return html;
};

function handleInput(el) { 
    $('clearBtn').style.display = el.value.length > 0 ? 'block' : 'none'; 
    renderList(); 
}
function clearSearch() { 
    $('search').value=''; 
    $('search').focus(); 
    $('clearBtn').style.display='none'; 
    renderList(); 
}
window.setSearch = term => { $('search').value = term; handleInput($('search')); };

// ========== v11.7 Êñ∞Â¢ûÔºöÂàóË°®ÁØ©ÈÅ∏Ê°ÜÁç®Á´ãÂäüËÉΩ ==========
let listFilterTimeout = null;

// Âç≥ÊôÇÁØ©ÈÅ∏Ë°®Ê†ºË°åÔºà‰∏çÈáçÊñ∞Ê∏≤ÊüìÔºåÂè™Èö±Ëóè/È°ØÁ§∫Ôºâ
window.filterTableRows = function(inputEl) {
    // Èò≤ÊäñËôïÁêÜ
    if(listFilterTimeout) clearTimeout(listFilterTimeout);
    listFilterTimeout = setTimeout(() => {
        const filterText = inputEl.value.toLowerCase().trim();
        const tbody = document.querySelector('.cb-table tbody');
        if(!tbody) return;
        
        const rows = tbody.querySelectorAll('tr');
        let visibleCount = 0;
        
        rows.forEach(row => {
            if(row.classList.contains('summary-row') || row.classList.contains('stat-row')) {
                // Áµ±Ë®àÂàóÊ∞∏ÈÅ†È°ØÁ§∫
                return;
            }
            
            const rowText = row.textContent.toLowerCase();
            if(!filterText || rowText.includes(filterText)) {
                row.classList.remove('filtered-hidden');
                row.style.display = '';
                visibleCount++;
            } else {
                row.classList.add('filtered-hidden');
                row.style.display = 'none';
            }
        });
        
        // Êõ¥Êñ∞ÁØ©ÈÅ∏Ë®àÊï∏
        const countEl = document.getElementById('listFilterCount');
        if(countEl) {
            countEl.innerHTML = `È°ØÁ§∫ <b>${visibleCount}</b> Á≠Ü`;
        }
    }, 150);
};

// Ê∏ÖÈô§ÂàóË°®ÁØ©ÈÅ∏
window.clearListFilter = function() {
    const input = document.getElementById('listFilterInput');
    if(input) {
        input.value = '';
        filterTableRows(input);
        input.focus();
    }
};

// Ê∏≤ÊüìÂàóË°®ÁØ©ÈÅ∏Ê°ÜÔºàÂè™Âú® CB Ë°®Ê†ºÊ®°ÂºèÊôÇÈ°ØÁ§∫Ôºâ
function renderListFilterBar(totalCount) {
    return `
        <div class="list-filter-bar">
            <span style="font-size:13px;color:#2e7d32;font-weight:600;">üîé Ë°®Ê†ºÁØ©ÈÅ∏</span>
            <input type="text" class="list-filter-input" id="listFilterInput" 
                   placeholder="Ëº∏ÂÖ•ÈóúÈçµÂ≠óÂç≥ÊôÇÁØ©ÈÅ∏Áï∂ÂâçË°®Ê†º..." 
                   oninput="filterTableRows(this)">
            <div class="list-filter-count" id="listFilterCount">È°ØÁ§∫ <b>${totalCount}</b> Á≠Ü</div>
            <button class="list-filter-clear" onclick="clearListFilter()">Ê∏ÖÈô§</button>
        </div>
    `;
}
// ========== v11.7 Êñ∞Â¢ûÁµêÊùü ==========

async function fetchXlsx(url) {
    try {
        $('loadStatus').innerText = `ËºâÂÖ• ${url}...`;
        const res = await fetch(url);
        if(!res.ok) throw new Error();
        return XLSX.read(await res.arrayBuffer(), {type:'array'});
    } catch(e) { console.warn('Load Error:', url); return null; }
}

async function init() {
  try {
    let wb;
    
    // 1. Master + Ê¶ÇÂøµËÇ°
    wb = await fetchXlsx(FILES.MASTER);
    if(wb) {
        XLSX.utils.sheet_to_json(wb.Sheets['‰∏ªË≥áÊñôÂ∫´']||[]).forEach(r => {
            const code = normalizeCode(r['‰ª£Ëôü']);
            if(code) {
                DB.stocks[code] = {...r, '‰ª£Ëôü': code};
                const market = r['Â∏ÇÂ†¥ÂàÜÈ°û'] || 'ÂÖ∂‰ªñ';
                const industry = r['Áî¢Ê•≠ÂàÜÈ°û'] || 'ÂÖ∂‰ªñ';
                META.stockStats.markets[market] = (META.stockStats.markets[market] || 0) + 1;
                META.stockStats.industries[industry] = (META.stockStats.industries[industry] || 0) + 1;
            }
        });
        META.stockStats.total = Object.keys(DB.stocks).length;
        
        const csSheet = wb.Sheets['üí°Ê¶ÇÂøµËÇ°ÊóèÁæ§Ë≥áÊñôÂ∫´'];
        if(csSheet) {
            const range = XLSX.utils.decode_range(csSheet['!ref']);
            for(let R=3; R<=range.e.r; R++) {
                const code = normalizeCode(csSheet[XLSX.utils.encode_cell({r:R,c:0})]?.v);
                const name = csSheet[XLSX.utils.encode_cell({r:R,c:1})]?.v;
                const concept = csSheet[XLSX.utils.encode_cell({r:R,c:2})]?.v;
                const subCat = csSheet[XLSX.utils.encode_cell({r:R,c:3})]?.v;
                const desc = csSheet[XLSX.utils.encode_cell({r:R,c:4})]?.v;
                const importance = csSheet[XLSX.utils.encode_cell({r:R,c:5})]?.v;
                
                if(code && concept) {
                    if(!META.concepts[code]) META.concepts[code] = [];
                    META.concepts[code].push({ concept: safe(concept), sub: safe(subCat) });
                    
                    DB.conceptStocks.push({
                        '_code': code,
                        '_name': safe(name),
                        '_concept': safe(concept),
                        '_subCat': safe(subCat),
                        '_desc': safe(desc),
                        '_importance': safe(importance),
                        '_industry': DB.stocks[code]?.['Áî¢Ê•≠ÂàÜÈ°û'] || ''
                    });
                    
                    META.stockStats.conceptCategories[concept] = (META.stockStats.conceptCategories[concept] || 0) + 1;
                }
            }
        }
        META.stockStats.conceptTotal = DB.conceptStocks.length;
        
        const conceptSheets = ['ÂØåÊ´É50Êàê‰ªΩËÇ°', 'Âè∞ÁÅ£50Êàê‰ªΩËÇ°', '‰∏≠Âûã100Êàê‰ªΩËÇ°', 'NVDIAÊ¶ÇÂøµËÇ°', 'Âè∞Á©çÈõªÊ¶ÇÂøµËÇ°'];
        conceptSheets.forEach(sheetName => {
            const sheet = wb.Sheets[sheetName];
            if(sheet) {
                const rows = XLSX.utils.sheet_to_json(sheet);
                DB.conceptLists[sheetName] = rows.map(r => normalizeCode(r['‰ª£Á¢º'])).filter(c => c);
            }
        });
    }

    // 2. Revenue
    wb = await fetchXlsx(FILES.REV);
    if(wb) {
        const sheetM = wb.Sheets['000_ÊúàÁáüÊî∂'];
        if(sheetM) {
            const rows = XLSX.utils.sheet_to_json(sheetM, {defval: null});
            if(rows.length > 0) {
                const headers = Object.keys(rows[0]);
                const mCols = headers.filter(h => h.includes('ÂñÆÊúàÁáüÊî∂')).sort();
                const accCols = headers.filter(h => h.includes('Á¥ØÊúàÁáüÊî∂(ÂÑÑ)') && !h.includes('ÂñÆÊúà')).sort();
                
                rows.forEach(r => {
                    const code = normalizeCode(r['‰ª£Ëôü']);
                    if(!code || code.length > 5 || code.startsWith('0')) return;
                    
                    const data = [];
                    mCols.forEach(col => {
                        const m = col.match(/(\d+)M(\d+)/);
                        if(m && r[col] !== null && r[col] !== undefined) {
                            const year = 2000 + parseInt(m[1]);
                            const month = parseInt(m[2]);
                            const period = `${year}/${month.toString().padStart(2, '0')}`;
                            const accCol = accCols.find(c => c.includes(m[0]));
                            data.push({ 
                                d: period, period: m[0], year: year, month: month,
                                rev: r[col], acc: accCol ? r[accCol] : null
                            });
                        }
                    });
                    
                    if(data.length > 0) {
                        data.sort((a, b) => b.d.localeCompare(a.d));
                        META.revData.month[code] = data;
                    }
                });
            }
        }
        
        const sheetQ = wb.Sheets['000_Â≠£ÁáüÊî∂'];
        if(sheetQ) {
            const rows = XLSX.utils.sheet_to_json(sheetQ, {defval: null});
            if(rows.length > 0) {
                const headers = Object.keys(rows[0]);
                const qCols = headers.filter(h => h.includes('ÂñÆÂ≠£ÁáüÊî∂')).sort();
                
                rows.forEach(r => {
                    const code = normalizeCode(r['‰ª£Ëôü']);
                    if(!code || code.length > 5 || code.startsWith('0')) return;
                    
                    const data = [];
                    qCols.forEach(col => {
                        const m = col.match(/(\d+)Q(\d)/);
                        if(m && r[col] !== null && r[col] !== undefined) {
                            const year = 2000 + parseInt(m[1]);
                            data.push({ d: `${year}Q${m[2]}`, year: year, q: parseInt(m[2]), rev: r[col] });
                        }
                    });
                    
                    if(data.length > 0) {
                        data.sort((a, b) => b.d.localeCompare(a.d));
                        META.revData.quarter[code] = data;
                    }
                });
            }
        }
        
        const sheetY = wb.Sheets['000_Âπ¥ÁáüÊî∂'];
        if(sheetY) {
            const rows = XLSX.utils.sheet_to_json(sheetY, {defval: null});
            if(rows.length > 0) {
                const headers = Object.keys(rows[0]);
                const yCols = headers.filter(h => h.includes('Âπ¥Â∫¶ÁáüÊî∂')).sort();
                
                rows.forEach(r => {
                    const code = normalizeCode(r['‰ª£Ëôü']);
                    if(!code || code.length > 5 || code.startsWith('0')) return;
                    
                    const data = [];
                    yCols.forEach(col => {
                        const m = col.match(/(\d{4})/);
                        if(m && r[col] !== null && r[col] !== undefined) {
                            data.push({ d: m[0], year: parseInt(m[0]), rev: r[col] });
                        }
                    });
                    
                    if(data.length > 0) {
                        data.sort((a, b) => b.year - a.year);
                        META.revData.year[code] = data;
                    }
                });
            }
        }
        
        const sheetH = wb.Sheets['10_Ë≤°Â†±ÂÇôË®ª'];
        if(sheetH) {
            XLSX.utils.sheet_to_json(sheetH, {defval: null}).forEach(r => {
                const code = normalizeCode(r['‰ª£Ëôü']);
                if(code) META.revData.highlights[code] = r;
            });
        }
    }

    // 3. News
    wb = await fetchXlsx(FILES.NEWS);
    if(wb) {
        XLSX.utils.sheet_to_json(wb.Sheets['Â§ñÈõªÁ∂úÂêàÂ†±Â∞é']||[]).forEach(r => {
            const code = normalizeCode(r['ËÇ°Ëôü']);
            DB.news.push({...r, 'ËÇ°Ëôü': code});
            if(code) { 
                if(!META.relatedNews[code]) META.relatedNews[code]=[]; 
                META.relatedNews[code].push(r); 
            }
        });
        DB.news.sort((a,b) => getDateVal(b['Êó•Êúü'])-getDateVal(a['Êó•Êúü']));
    }

    // 4. Memo
    wb = await fetchXlsx(FILES.MEMO);
    if(wb) {
        const industryKeywords = ['Áî¢Ê•≠', 'TPCA', 'ÂúãÈöõËÇ°Â∏Ç', 'Á∏ΩÁ∂ì', 'Á≠ñÁï•'];
        
        XLSX.utils.sheet_to_json(wb.Sheets['Â†±ÂëäÁ∏ΩË°®']||[]).forEach(r => {
            const code = normalizeCode(r['ËÇ°Ëôü']);
            const reportType = safe(r['Â†±ÂëäÈ°ûÂûã']);
            const memoData = {...r, 'ËÇ°Ëôü': code};
            
            DB.memo.push(memoData);
            
            const isIndustry = industryKeywords.some(kw => reportType.includes(kw));
            if(isIndustry) {
                DB.memoIndustry.push(memoData);
            } else {
                DB.memoStock.push(memoData);
            }
            
            const broker = safe(r['Âà∏ÂïÜ']);
            if(broker) META.memoStats.brokers[broker] = (META.memoStats.brokers[broker] || 0) + 1;
            if(reportType) META.memoStats.types[reportType] = (META.memoStats.types[reportType] || 0) + 1;
            
            if(code) { 
                if(!META.relatedMemo[code]) META.relatedMemo[code]=[]; 
                META.relatedMemo[code].push(r); 
            }
        });
        DB.memo.sort((a,b) => getDateVal(b['Êó•Êúü'])-getDateVal(a['Êó•Êúü']));
        DB.memoStock.sort((a,b) => getDateVal(b['Êó•Êúü'])-getDateVal(a['Êó•Êúü']));
        DB.memoIndustry.sort((a,b) => getDateVal(b['Êó•Êúü'])-getDateVal(a['Êó•Êúü']));
        
        META.memoStats.total = DB.memo.length;
        META.memoStats.stockTotal = DB.memoStock.length;
        META.memoStats.industryTotal = DB.memoIndustry.length;
        
        XLSX.utils.sheet_to_json(wb.Sheets['Ë©≥Á¥∞ÂÖßÂÆπÂ∫´']||[]).forEach(r => META.memoDetail[safe(r['Á∑®Ëôü'])] = r);
        XLSX.utils.sheet_to_json(wb.Sheets['Ë≤°ÂãôÊï∏ÊìöÂΩôÁ∏Ω']||[]).forEach(r => META.finance[safe(r['ÂÖ¨Âè∏'])] = r);
        XLSX.utils.sheet_to_json(wb.Sheets['Áî¢ÂìÅÁµêÊßãÂàÜÊûê']||[]).forEach(r => META.products[safe(r['ÂÖ¨Âè∏'])] = r);
        XLSX.utils.sheet_to_json(wb.Sheets['ÂÖ¨Âè∏ËøΩËπ§Ë°®']||[]).forEach(r => META.tracking[safe(r['ÂÖ¨Âè∏'])] = r);
        XLSX.utils.sheet_to_json(wb.Sheets['Áî¢Ê•≠Ë∂®Âã¢Á∏ΩË¶Ω']||[]).forEach(r => {
            if(r['Áî¢Ê•≠']) DB.trends.push(r);
        });
    }

    // 5. Reports
    wb = await fetchXlsx(FILES.REPORTS);
    if(wb) {
        XLSX.utils.sheet_to_json(wb.Sheets['Â†±ÂëäÁ∏ΩË¶Ω']||[]).forEach(r => DB.reports.push(r));
        DB.reports.sort((a,b) => getDateVal(b['Â†±ÂëäÊó•Êúü'])-getDateVal(a['Â†±ÂëäÊó•Êúü']));
        
        XLSX.utils.sheet_to_json(wb.Sheets['ÁÑ¶ÈªûÂàÜÊûêÂÖßÂÆπ']||[]).forEach(r => {
            const rid = safe(r['Â†±ÂëäÁ∑®Ëôü']);
            if(rid) { if(!META.reportFocus[rid]) META.reportFocus[rid]=[]; META.reportFocus[rid].push(r); }
        });
        XLSX.utils.sheet_to_json(wb.Sheets['Âà∏ÂïÜËßÄÈªûÁµêË´ñ']||[]).forEach(r => {
            const rid = safe(r['Â†±ÂëäÁ∑®Ëôü']);
            if(rid) META.reportViews[rid] = r;
        });
        XLSX.utils.sheet_to_json(wb.Sheets['ÂÄãËÇ°Ë©ïÂÉπË°®']||[]).forEach(r => {
            const rid = safe(r['Â†±ÂëäÁ∑®Ëôü']);
            if(rid) { if(!META.reportRatings[rid]) META.reportRatings[rid]=[]; META.reportRatings[rid].push(r); }
        });
    }

    // 6. Strategy
    wb = await fetchXlsx(FILES.STRAT);
    if(wb) {
        const indexSheet = wb.Sheets['Â†±ÂëäÁ¥¢Âºï'];
        if(indexSheet) {
            const indexData = XLSX.utils.sheet_to_json(indexSheet, {header: 1});
            for(let i = 0; i < indexData.length; i++) {
                const row = indexData[i];
                if(row[0] === 'Â†±ÂëäÁ∑®Ëôü') {
                    for(let j = i+1; j < indexData.length; j++) {
                        const r = indexData[j];
                        if(r[0] && r[0].startsWith('RPT-')) {
                            const rptId = r[0];
                            const sheetName = wb.SheetNames.find(n => n.includes(rptId.replace('-', '')));
                            
                            DB.strategy.push({
                                'Â†±ÂëäÁ∑®Ëôü': rptId, 'Â†±Âëä‰∏ªÈ°å': r[1], '‰∏ªË¨õÂñÆ‰Ωç': r[2],
                                'Ë¨õËÄÖ': r[3], 'Â†±ÂëäÊó•Êúü': r[4], 'È†ÅÊï∏': r[5], '_sheetName': sheetName
                            });
                        }
                    }
                    break;
                }
            }
        }
        
        DB.strategy.forEach(report => {
            const sheetName = report._sheetName;
            if(sheetName && wb.Sheets[sheetName]) {
                const sheetData = XLSX.utils.sheet_to_json(wb.Sheets[sheetName], {header: 1});
                const sections = [];
                let currentSection = null;
                let basicInfo = {};
                
                for(let i = 1; i < sheetData.length; i++) {
                    const row = sheetData[i];
                    const tag = row[0];
                    const val = row[1];
                    
                    if(!tag) continue;
                    
                    if(['Â†±ÂëäÁ∑®Ëôü', 'Â†±Âëä‰∏ªÈ°å', 'ÂâØÊ®ôÈ°å', 'ÁôºÂ∏ÉÂñÆ‰Ωç', '‰∏ªË¨õ‰∫∫', 'ÁôºÂ∏ÉÊó•Êúü', 'Â†±ÂëäÈ†ÅÊï∏', 'Ê†∏ÂøÉËßÄÈªû', 'Ê®ôÁ±§ÂàÜÈ°û', 'Ë≥áÊñô‰æÜÊ∫ê'].includes(tag)) {
                        basicInfo[tag] = val;
                        continue;
                    }
                    
                    if(tag.startsWith('„Äê') && tag.endsWith('„Äë')) {
                        if(currentSection) sections.push(currentSection);
                        currentSection = { title: tag, items: [] };
                    } else if(currentSection) {
                        currentSection.items.push({ label: tag, value: val });
                    }
                }
                if(currentSection) sections.push(currentSection);
                
                META.stratSections = META.stratSections || {};
                META.stratSections[report['Â†±ÂëäÁ∑®Ëôü']] = { basic: basicInfo, sections: sections };
            }
        });
        
        DB.strategy.sort((a,b) => getDateVal(b['Â†±ÂëäÊó•Êúü'])-getDateVal(a['Â†±ÂëäÊó•Êúü']));
    }

    // 7. CB
    wb = await fetchXlsx(FILES.CB);
    if(wb) {
        const cbHighLow = {};
        const sheet00Name = wb.SheetNames.find(n => n.startsWith('00_'));
        if(sheet00Name) {
            XLSX.utils.sheet_to_json(wb.Sheets[sheet00Name]||[]).forEach(r => {
                const cbCode = safe(r['‰ª£Ëôü']);
                if(cbCode) {
                    const high = parseFloat(r['ÊéõÁâåÊúÄÈ´ò']) || 0;
                    const low = parseFloat(r['ÊéõÁâåÊúÄ‰Ωé']) || 0;
                    cbHighLow[cbCode] = { high: high, low: low, range: low > 0 ? ((high - low) / low * 100) : 0, avgVol: r['ÊúàÂùáÊàê‰∫§'] };
                }
            });
        }
        
        const cbLatestPrice = {};
        XLSX.utils.sheet_to_json(wb.Sheets['09_ÊúÄÊñ∞ÂãïÊÖãÊØèÈÄ±Êó•Ë°åÊÉÖ']||[]).forEach(r => {
            const cbCode = safe(r['‰ª£Á¢º']);
            if(cbCode) cbLatestPrice[cbCode] = parseFloat(r['CBÊî∂Áõ§ÂÉπ']) || 0;
        });
        
        const industrySimpleMap = {
            'ÂÖâÈõªÊ•≠': 'ÂÖâÈõª', 'ÂÖ∂‰ªñÊ•≠': 'ÂÖ∂‰ªñ', 'ÂÖ∂‰ªñÊ•≠ÈõªÂ≠êÊ•≠': 'ÂÖ∂‰ªñÈõªÂ≠ê', 'ÂåñÂ≠∏Â∑•Ê•≠': 'ÂåñÂ∑•', 'ÂçäÂ∞éÈ´îÊ•≠': 'ÂçäÂ∞éÈ´î', 'Â°ëËÜ†Â∑•Ê•≠': 'Â°ëËÜ†',
            'Â±ÖÂÆ∂ÁîüÊ¥ª': 'Â±ÖÂÆ∂ÁîüÊ¥ª', 'Âª∫ÊùêÁáüÈÄ†Ê•≠': 'Âª∫ÊùêÁáüÈÄ†', 'Êï∏‰ΩçÈõ≤Á´Ø': 'Êï∏‰ΩçÈõ≤Á´Ø', 'ÊñáÂåñÂâµÊÑèÊ•≠': 'ÊñáÂåñÂâµÊÑè', 'Ê©°ËÜ†Â∑•Ê•≠': 'ÂÖ∂‰ªñ', 'Ê∞¥Ê≥•Â∑•Ê•≠': 'Ê∞¥Ê≥•',
            'Ê±ΩËªäÂ∑•Ê•≠': 'Ê±ΩËªä', 'Ê≤πÈõªÁáÉÊ∞£Ê•≠': 'Ê≤πÈõªÁáÉÊ∞£', 'ÁéªÁíÉÈô∂Áì∑': 'ÂÖ∂‰ªñ', 'ÁîüÊäÄÈÜ´ÁôÇÊ•≠': 'ÁîüÊäÄÈÜ´ÁôÇ', 'Á¥°ÁπîÁ∫ñÁ∂≠': 'Á¥°ÁπîÁ∫ñÁ∂≠', 'Á∂†ËÉΩÁí∞‰øù': 'Á∂†ËÉΩÁí∞‰øù',
            'Ëà™ÈÅãÊ•≠': 'Ëà™ÈÅã', 'ËßÄÂÖâÈ§êÊóÖ': 'ËßÄÂÖâÈ§êÊóÖ', 'Ë≠âÂà∏Ê•≠': 'ÈáëËûç‰øùÈö™', 'Ë≤øÊòìÁôæË≤®Ê•≠': 'Ë≤øÊòìÁôæË≤®', 'Ë≥áË®äÊúçÂãôÊ•≠': 'Ë≥áË®äÊúçÂãô', 'Ëæ≤Ê•≠ÁßëÊäÄÊ•≠': 'Ëæ≤Ê•≠ÁßëÊäÄ',
            'ÈÄö‰ø°Á∂≤Ë∑ØÊ•≠': 'ÈÄö‰ø°Á∂≤Ë∑Ø', 'ÈÄ†Á¥ôÂ∑•Ê•≠': 'ÈÄ†Á¥ô', 'ÈÅãÂãï‰ºëÈñí': 'ÈÅãÂãï‰ºëÈñí', 'ÈáëÊéßÊ•≠': 'ÈáëËûç‰øùÈö™', 'ÈäÄË°åÊ•≠': 'ÈáëËûç‰øùÈö™', 'ÈãºÈêµÂ∑•Ê•≠': 'ÈãºÈêµ',
            'ÈõªÂô®ÈõªÁ∫ú': 'ÈõªÂô®ÈõªÁ∫ú', 'ÈõªÂ≠êÈÄöË∑ØÊ•≠': 'ÈõªÂ≠êÈÄöË∑Ø', 'ÈõªÂ≠êÈõ∂ÁµÑ‰ª∂Ê•≠': 'ÈõªÂ≠êÈõ∂ÁµÑ‰ª∂', 'ÈõªÊ©üÊ©üÊ¢∞': 'ÈõªÊ©üÊ©üÊ¢∞', 'ÈõªËÖ¶ÂèäÈÄ±ÈÇäË®≠ÂÇôÊ•≠': 'ÈõªËÖ¶ÂèäÈÄ±ÈÇä', 'È£üÂìÅÂ∑•Ê•≠': 'È£üÂìÅ'
        };
        const getSimpleIndustry = (ind) => industrySimpleMap[ind] || ind || 'ÂÖ∂‰ªñ';
        
        const cbBasicInfo = {};
        
        XLSX.utils.sheet_to_json(wb.Sheets['01_ALLCBÂü∫Êú¨Ë≥áÊñô']||[]).forEach(r => {
            const cbCode = safe(r['CB‰ª£Ëôü']);
            if(cbCode) {
                const hl = cbHighLow[cbCode] || {};
                const fullIndustry = safe(r['Áî¢Ê•≠ÂàÜÈ°û']);
                cbBasicInfo[cbCode] = {
                    stockCode: normalizeCode(r['ËÇ°Á•®‰ª£Ëôü']), name: safe(r['ÂêçÁ®±']), method: safe(r['Ë©¢ÂúàÁ´∂Êãç']),
                    guarantee: safe(r['Êìî‰øù']), rating: r['‰ø°Ë©ï'], issuer: safe(r['ÁôºË°åÂà∏ÂïÜ']), scale: r['ÁôºË°åË¶èÊ®°'],
                    convPrice: r['ËΩâÊèõÂÉπÊ†º'], years: r['ÁôºË°åÂπ¥Êúü'], issuePrice: r['ÁôºË°åÂÉπÊ†º'], expPrice: r['Âà∞ÊúüÈÇÑÊú¨ÂÉπÊ†º'],
                    premium: r['Ë®ÇÂÉπÊ∫¢ÂÉπÁéá'], position: safe(r['Áî¢Ê•≠Âú∞‰Ωç']), capital: r['ËÇ°Êú¨Â§ßÂ∞è'],
                    industry: getSimpleIndustry(fullIndustry), listDate: r['ÊéõÁâåÊó•Êúü'], expDate: r['Âà∞ÊúüÊó•Êúü'],
                    high: hl.high || parseFloat(r['ÊéõÁâåÊúÄÈ´ò']) || 0, low: hl.low || parseFloat(r['ÊéõÁâåÊúÄ‰Ωé']) || 0
                };
            }
        });
        
        const cbTimeline = {};
        XLSX.utils.sheet_to_json(wb.Sheets['02_ALLCBÁôºË°åÊôÇÁ®ã']||[]).forEach(r => {
            const cbCode = safe(r['CB‰ª£Ëôü']);
            if(cbCode) {
                cbTimeline[cbCode] = {
                    boardDate: r['Ëë£‰∫ãÊúÉÂÖ¨Âëä'], sendDate: r['ÈÄÅ‰ª∂Êó•Êúü'], effectDate: r['ÁîüÊïàÊó•Êúü'],
                    bidDate: safe(r['Ë©¢ÂúàÁ´∂ÊãçÊó•Êúü']), payDate: r['‰ª£Êî∂ÂÉπÊ¨æÂÖ¨Âëä'], listDate: r['ÊéõÁâåÊó•Êúü'], cbasDate: r['CBASÊãÜËß£Êó•']
                };
            }
        });
        
        const cbPutbackData = {};
        XLSX.utils.sheet_to_json(wb.Sheets['03_ALLCBË≥£ÂõûÊ¢ù‰ª∂']||[]).forEach(r => {
            const cbCode = safe(r['CB‰ª£Ëôü']);
            if(cbCode) {
                cbPutbackData[cbCode] = {
                    putDate1: r['Ë≥£ÂõûÊó•Êúü1'], putDate2: r['Ë≥£ÂõûÊó•Êúü2'],
                    putTiming: safe(r['ÊäïË≥á‰∫∫ÊèêÂâçË≥£Âõû']), putCondition: safe(r['Ë≥£ÂõûÊ¢ù‰ª∂'])
                };
            }
        });
        
        Object.entries(cbBasicInfo).forEach(([cbCode, info]) => {
            const timeline = cbTimeline[cbCode] || {};
            const putback = cbPutbackData[cbCode] || {};
            DB.cbAll.push({
                '_cbCode': cbCode, '_stockCode': info.stockCode, '_name': info.name, '_industry': info.industry,
                '_method': info.method, '_guarantee': info.guarantee, '_rating': info.rating, '_issuer': info.issuer,
                '_scale': info.scale, '_convPrice': info.convPrice, '_years': info.years, '_issuePrice': info.issuePrice,
                '_expPrice': info.expPrice, '_premium': info.premium, '_position': info.position, '_capital': info.capital,
                '_listDate': info.listDate, '_expDate': info.expDate, '_high': info.high, '_low': info.low,
                '_boardDate': timeline.boardDate, '_sendDate': timeline.sendDate, '_effectDate': timeline.effectDate,
                '_bidDate': timeline.bidDate, '_payDate': timeline.payDate, '_cbasDate': timeline.cbasDate,
                '_putDate1': putback.putDate1, '_putDate2': putback.putDate2,
                '_putTiming': putback.putTiming, '_putCondition': putback.putCondition
            });
        });
        
        // ÊèêÂâçË≥£Âõû
        const today = new Date();
        const threeMonthsLater = new Date(today.getTime() + 90 * 24 * 60 * 60 * 1000);
        
        DB.cbAll.forEach(cb => {
            const checkPutDate = (dateVal) => {
                if(!dateVal) return null;
                let d;
                if(typeof dateVal === 'number') d = new Date((dateVal - 25569) * 86400 * 1000);
                else if(typeof dateVal === 'string') d = new Date(dateVal.replace(/\//g, '-'));
                else if(dateVal instanceof Date) d = dateVal;
                if(d && !isNaN(d.getTime()) && d >= today && d <= threeMonthsLater) return d;
                return null;
            };
            
            const putDate1 = checkPutDate(cb._putDate1);
            const putDate2 = checkPutDate(cb._putDate2);
            const nearestPutDate = putDate1 || putDate2;
            
            if(nearestPutDate) {
                DB.cbPutback.push({
                    ...cb, '_nearestPutDate': nearestPutDate,
                    '_daysToput': Math.ceil((nearestPutDate - today) / (24 * 60 * 60 * 1000))
                });
            }
        });
        DB.cbPutback.sort((a, b) => a._nearestPutDate - b._nearestPutDate);
        
        Object.entries(cbBasicInfo).forEach(([cbCode, info]) => {
            const high = info.high;
            const low = info.low;
            if(high > 0 && low > 0) {
                DB.cbHistory.push({
                    '_cbCode': cbCode, '_stockCode': info.stockCode, '_name': info.name, '_industry': info.industry,
                    '_method': info.method, '_guarantee': info.guarantee, '_high': high, '_low': low,
                    '_range': (high - low) / low * 100, 'ËΩâÊèõÂÉπÊ†º(ÂÖÉ)': info.convPrice, 'Âà∞ÊúüÊó•': info.expDate,
                    'ÊéõÁâåÊó•Êúü': info.listDate, 'ÁôºË°åË¶èÊ®°': info.scale, 'ÁôºË°åÂà∏ÂïÜ': info.issuer
                });
            }
        });
        
        const dailyMap = {};
        XLSX.utils.sheet_to_json(wb.Sheets['09_ÊúÄÊñ∞ÂãïÊÖãÊØèÈÄ±Êó•Ë°åÊÉÖ']||[]).forEach(r => {
            const code = safe(r['‰ª£Á¢º']);
            const name = safe(Object.values(r)[1]);
            const ind = getSimpleIndustry(safe(r['Áî¢Ê•≠']));
            
            if(code) {
                dailyMap[code] = {
                    name: name, industry: ind, cbPrice: r['CBÊî∂Áõ§ÂÉπ'], stockPrice: r['ËÇ°ÂÉπ'],
                    convPrice: r['ËΩâÊèõÂÉπÊ†º'], convValue: r['ËΩâÊèõÂÉπÂÄº'], premium: r['Ê∫¢(Êäò)ÂÉπ%'], expDate: r['Âà∞ÊúüÊó•']
                };
            }
        });
        
        const activeCbCodes = new Set();
        META.cbStats.industries = {};
        
        XLSX.utils.sheet_to_json(wb.Sheets['08_ÊúÄÊñ∞ÂãïÊÖãÊØèÈÄ±Âü∫Êú¨Ë≥áÊñô']||[]).forEach(r => {
            const cbCode = safe(r['‰ª£Ëôü']);
            const stockCode = normalizeCode(r['ËΩâÊèõÊ®ôÁöÑ‰ª£Á¢º']);
            const daily = dailyMap[cbCode] || {};
            const hl = cbHighLow[cbCode] || {};
            const basic = cbBasicInfo[cbCode] || {};
            
            activeCbCodes.add(cbCode);
            const industry = basic.industry || daily.industry || 'ÂÖ∂‰ªñ';
            
            const cbData = {
                ...r, '_stockCode': stockCode, '_cbCode': cbCode, '_name': safe(r['ÂêçÁ®±']),
                '_stockName': safe(r['ËΩâÊèõÊ®ôÁöÑÂêçÁ®±']), '_industry': industry, '_cbPrice': daily.cbPrice,
                '_stockPrice': daily.stockPrice, '_convValue': daily.convValue, '_premium': daily.premium,
                '_high': hl.high || 0, '_low': hl.low || 0, '_range': hl.range || 0,
                '_method': basic.method || '', '_guarantee': basic.guarantee || ''
            };
            
            DB.cb.push(cbData);
            if(stockCode) { 
                if(!META.cbMap[stockCode]) META.cbMap[stockCode]=[]; 
                META.cbMap[stockCode].push(cbData); 
            }
            if(industry) META.cbStats.industries[industry] = (META.cbStats.industries[industry] || 0) + 1;
        });
        
        DB.cbHistory = DB.cbHistory.filter(c => !activeCbCodes.has(c._cbCode));
        
        XLSX.utils.sheet_to_json(wb.Sheets['04_ÊâÄÊúâCBÁ´∂ÊãçË≥áÊñôÂ∫´']||[]).forEach(r => {
            const cbCode = safe(r['CB‰ª£Ëôü']);
            if(!cbCode) return;
            
            const hl = cbHighLow[cbCode] || {};
            const high = hl.high || parseFloat(r['ÊéõÁâåÊúÄÈ´ò']) || 0;
            const low = hl.low || parseFloat(r['ÊéõÁâåÊúÄ‰Ωé']) || 0;
            const latestPrice = cbLatestPrice[cbCode] || 0;
            
            DB.cbAuction.push({
                '_cbCode': cbCode, '_stockCode': normalizeCode(r['ËÇ°Á•®‰ª£Ëôü']), '_name': safe(r['ÂêçÁ®±']),
                '_industry': getSimpleIndustry(safe(r['Áî¢Ê•≠ÂàÜÈ°û'])), '_guarantee': safe(r['Êìî‰øù']),
                '_high': high, '_low': low, '_latestPrice': latestPrice, '_range': low > 0 ? (high - low) / low * 100 : 0,
                'ÈñãÊ®ôÊó•Êúü': r['ÈñãÊ®ôÊó•Êúü'], 'Êà™Ê®ôÊó•': r['Êà™Ê®ôÊó•'], 'ÁôºË°åË¶èÊ®°': r['ÁôºË°åË¶èÊ®°'], 'Á´∂ÊãçÂºµÊï∏': r['Á´∂ÊãçÂºµÊï∏'],
                'Â∫ïÊ®ôÂÉπ': r['Â∫ïÊ®ôÂÉπ'], 'ÁêÜË´ñÂÉπ': r['ÁêÜË´ñÂÉπ'], 'ÊúÄ‰ΩéÂæóÊ®ô': r['ÊúÄ‰ΩéÂæóÊ®ô'], 'ÊúÄ‰ΩéÊ∫¢ÂÉπ': r['ÊúÄ‰ΩéÊ∫¢ÂÉπ'],
                'Âπ≥ÂùáÂæóÊ®ô': r['Âπ≥ÂùáÂæóÊ®ô'], 'Âπ≥ÂùáÊ∫¢ÂÉπ': r['Âπ≥ÂùáÊ∫¢ÂÉπ'], 'ÊäïÊ®ôÂÄçÊï∏': r['ÊäïÊ®ôÂÄçÊï∏'], 'ÂêàÊ†º‰ª∂Êï∏': r['ÂêàÊ†º‰ª∂Êï∏'],
                'ÁôºË°åÂà∏ÂïÜ': safe(r['ÁôºË°åÂà∏ÂïÜ']), 'ËΩâÊèõÂÉπ': r['ËΩâÊèõÂÉπ'], 'Ë®ÇÂÉπÊ∫¢ÂÉπÁéá': r['Ë®ÇÂÉπÊ∫¢ÂÉπÁéá']
            });
        });
        
        XLSX.utils.sheet_to_json(wb.Sheets['06_ÁôºË°åÊ°à‰ª∂']||[]).forEach(r => {
            DB.cbPrimary.push({
                '_stockCode': normalizeCode(r['ËÇ°Á•®‰ª£Ëôü']), '_cbCode': safe(r['Ê®ôÁöÑ‰ª£Ëôü']), '_name': safe(r['ÁôºË°åÊ®ôÁöÑ']),
                '_method': safe(r['Ë©¢Âúà/Á´∂Êãç']), '_tcri': safe(r['TCRI/Êìî‰øù']), '_amount': r['ÁôºË°åÈáè'],
                '_broker': safe(r['ÁôºË°åÂà∏ÂïÜ']), '_sendDate': r['ÈÄÅ‰ª∂Êó•'], '_effectDate': r['ÁîüÊïàÊó•'],
                '_bidPeriod': safe(r['Ë©¢Âúà/ÊäïÊ®ôÊúüÈñì']), '_premium': r['Ê∫¢ÂÉπÁéá'], '_convPrice': r['ËΩâÊèõÂÉπ'],
                '_listDate': r['ÊéõÁâåÊó•'], '_optionDate': r['ÂèØÊãÜËß£ÈÅ∏ÊìáÊ¨äÊó•'], '_price': r['ÊâøÈä∑ÂÉπÊ†º'],
                '_years': r['Âπ¥Êúü'], '_putback': safe(r['Ë≥£ÂõûÊ¢ù‰ª∂']), '_capital': r['ËÇ°Êú¨'],
                '_stockPrice': r['ËÇ°ÂÉπ'], '_volatility': r['60Â§©Ê≥¢ÂãïÁéá']
            });
        });
        META.cbPrimaryStats.underwriting = DB.cbPrimary.length;
        
        XLSX.utils.sheet_to_json(wb.Sheets['07_Ëë£‰∫ãÊúÉÊ±∫Ë≠∞']||[]).forEach(r => {
            DB.cbBoard.push({
                '_stockCode': normalizeCode(r['ËÇ°È∞æ‰ª£Ëôü'] || r['ËÇ°Á•®‰ª£Ëôü']), '_cbCode': safe(r['CB‰ª£Á¢º']),
                '_name': safe(r['ÁôºË°åÊ®ôÁöÑ']), '_method': safe(r['Ë©¢Âúà/Á´∂ÂÉπ']), '_tcri': safe(r['TCRI/Êìî‰øù']),
                '_amount': r['ÁôºË°åÈáè'], '_broker': safe(r['‰∏ªËæ¶Âà∏ÂïÜ']), '_maturity': safe(r['Âà∞ÊúüÊó•']),
                '_boardDate': r['Ëë£‰∫ãÊúÉÈÄöÈÅé'], '_capital': r['ËÇ°Êú¨(ÂÑÑ)'], '_note': safe(r['ÂÇôË®ª'])
            });
        });
        META.cbPrimaryStats.board = DB.cbBoard.length;
        
        XLSX.utils.sheet_to_json(wb.Sheets['10_ÊúÄÊñ∞ÂãïÊÖãÊØèÈÄ±È§òÈ°çË°®']||[]).forEach(r => {
            DB.cbBalance.push({
                '_cbCode': safe(r['Ë≠âÂà∏‰ª£Ëôü']), '_name': safe(r['Ë≠âÂà∏ÂêçÁ®±']),
                '_thisWeek': r['Êú¨ÈÄ±ËÇ°È°ç'], '_lastWeek': r['‰∏äÈÄ±ËÇ°È°ç'], '_change': r['Â¢ûÊ∏õÊï∏È°ç'],
                '_changeRate': r['Â¢ûÊ∏õÊØîÁéá'], '_remainRate': r['ÁôºË°åÊØîÁéá(Ââ©È§òÊØîÁéá)']
            });
        });
        META.cbBalanceStats.total = DB.cbBalance.length;
        
        XLSX.utils.sheet_to_json(wb.Sheets['11_ÊúÄÊñ∞ÂãïÊÖãCBASÂ†±ÂÉπË°®']||[]).forEach(r => {
            const tcriVal = safe(r['Êìî‰øùÈäÄË°å/‰ø°Áî®Ë©ïÁ≠â(TCRI)']);
            const isGuaranteed = tcriVal && !/^\d+$/.test(tcriVal) && /ÈäÄ|ÂïÜÈäÄ|ÂêàÂ∫´/.test(tcriVal);
            
            DB.cbCBAS.push({
                '_name': safe(r['ÂèØËΩâÂÇµÂêçÁ®±']), '_cbCode': safe(r['ÂèØËΩâÂÇµ‰ª£Á¢º']), '_tcri': tcriVal,
                '_guarantee': isGuaranteed ? 'Êúâ' : 'ÁÑ°', '_premium': r['Ê¨äÂà©Èáë(‰Ω∞ÂÖÉÂ†±ÂÉπ)'],
                '_optExpiry': r['ÈÅ∏ÊìáÊ¨äÂà∞ÊúüÊó•'], '_putPrice': r['Ë≥£ÂõûÂÉπÊ†º(A)'], '_putDate': r['Ë≥£ÂõûÊó•Êúü(B)'],
                '_remainYears': r['Ââ©È§òÂπ¥Êúü'], '_discountRate': r['ÊäòÁèæÁéá(C)'], '_premiumRef': r['Ê¨äÂà©ÈáëÂèÉËÄÉÂÉπ'],
                '_stockPrice': r['ÁèæËÇ°ÂèÉËÄÉÂÉπ'], '_convPrice': r['ËΩâÊèõÂÉπÊ†º'], '_convValue': r['CBËΩâÊèõÂÉπÂÄº'],
                '_cbPrice': r['CBÂèÉËÄÉÂÉπ'], '_premiumPct': r['Ê∫¢(Êäò)ÂÉπ%'], '_vol120': r['ËÇ°ÂÉπÊ≥¢ÂãïÁéá120Â§©%'],
                '_vol240': r['ËÇ°ÂÉπÊ≥¢ÂãïÁéá240Â§©%'], '_remainPct': r['ÊµÅÈÄöÈ§òÈ°çÂç†ÁôºË°åÁ∏ΩÈ°ç%'],
                '_origAmount': r['ÂéüÂßãÁôºË°åÈáè'], '_industry': safe(r['Áî¢Ê•≠'])
            });
        });
        META.cbCBASStats.total = DB.cbCBAS.length;
        
        XLSX.utils.sheet_to_json(wb.Sheets['12_ÂÖ¨Âè∏Âü∑Ë°åË¥ñÂõûÊ¨ä']||[]).forEach(r => {
            const subject = safe(r['‰∏ªÊó®']);
            const endMatch = subject.match(/(\d{3})Âπ¥(\d{1,2})Êúà(\d{1,2})Êó•ÁµÇÊ≠¢Ê´ÉÊ™ØË≤∑Ë≥£/);
            let endDate = '';
            if(endMatch) {
                const year = parseInt(endMatch[1]) + 1911;
                endDate = `${year}/${endMatch[2].padStart(2,'0')}/${endMatch[3].padStart(2,'0')}`;
            }
            const cbMatch = subject.match(/‰ª£Á¢º[Ôºö:](\d+)/);
            const cbCode = cbMatch ? cbMatch[1] : '';
            const cbNameMatch = subject.match(/Á∞°Á®±[Ôºö:]([^Ôºå,]+)[Ôºå,]/);
            const cbName = cbNameMatch ? cbNameMatch[1] : '';
            const daily = dailyMap[cbCode] || {};
            const hl = cbHighLow[cbCode] || {};
            
            DB.cbRedeem.push({
                '_stockCode': normalizeCode(r['ÂÖ¨Âè∏‰ª£Ëôü']), '_name': safe(r['ÂÖ¨Âè∏ÂêçÁ®±']),
                '_cbCode': cbCode, '_cbName': cbName, '_reportDate': safe(r['Áî≥Â†±Êó•Êúü']), '_endDate': endDate,
                '_cbPrice': daily.cbPrice || 0, '_high': hl.high || 0, '_low': hl.low || 0,
                '_subject': subject, '_asoExpiry': r['ASOÂà∞ÊúüÊó•']
            });
        });
        
        XLSX.utils.sheet_to_json(wb.Sheets['13_ÂÅúÊ≠¢ËΩâÊèõË≥áË®ä']||[]).forEach(r => {
            DB.cbStopConv.push({
                '_cbCode': safe(r['ÂÇµÂà∏‰ª£Á¢º']), '_name': safe(r['ÂÇµÂà∏Á∞°Á®±']),
                '_startDate': safe(r['ÂÅúÊ≠¢ËΩâ(‰∫§)ÊèõËµ∑Êó•']), '_endDate': safe(r['ÂÅúÊ≠¢ËΩâ(‰∫§)ÊèõËøÑÊó•']),
                '_reason': safe(r['ÂÅúÊ≠¢ËΩâ(‰∫§)Êèõ‰∫ãÁî±'])
            });
        });
        
        XLSX.utils.sheet_to_json(wb.Sheets['14_ËΩâÊèõÂÉπÊ†ºË™øÊï¥']||[]).forEach(r => {
            const subject = safe(r['‰∏ªÊó®']);
            const dateMatch = subject.match(/Ëá™(\d{3})Âπ¥(\d{1,2})Êúà(\d{1,2})Êó•Ëµ∑/);
            let adjDate = '';
            if(dateMatch) {
                const year = parseInt(dateMatch[1]) + 1911;
                adjDate = `${year}/${dateMatch[2].padStart(2,'0')}/${dateMatch[3].padStart(2,'0')}`;
            }
            const priceMatch = subject.match(/ËΩâÊèõÂÉπÊ†ºËá™([\d.]+)ÂÖÉË™øÊï¥ÁÇ∫([\d.]+)ÂÖÉ/);
            const origPrice = priceMatch ? priceMatch[1] : '';
            const newPrice = priceMatch ? priceMatch[2] : '';
            const cbMatch = subject.match(/‰ª£Á¢º[Ôºö:](\d+)/);
            const cbCode = cbMatch ? cbMatch[1] : '';
            const nameMatch = subject.match(/Á∞°Á®±[Ôºö:]([^Ôºå,]+)[Ôºå,]/);
            const cbName = nameMatch ? nameMatch[1] : '';
            
            DB.cbPriceAdj.push({
                '_stockCode': normalizeCode(r['ÂÖ¨Âè∏‰ª£Ëôü']), '_name': safe(r['ÂÖ¨Âè∏ÂêçÁ®±']),
                '_cbCode': cbCode, '_cbName': cbName, '_adjDate': adjDate,
                '_origPrice': origPrice, '_newPrice': newPrice, '_subject': subject
            });
        });
        
        META.cbStats.total = DB.cb.length;
        META.cbStats.historyTotal = DB.cbHistory.length;
        META.cbStats.auctionTotal = DB.cbAuction.length;
        const companies = new Set();
        let totalBal = 0;
        DB.cb.forEach(c => {
            if(c['_stockCode']) companies.add(c['_stockCode']);
            const bal = parseFloat(c['ÊúÄÊñ∞È§òÈ°ç(ÁôæËê¨)']) || 0;
            totalBal += bal;
        });
        META.cbStats.companies = companies.size;
        META.cbStats.totalBalance = totalBal;
    }

    $('c-news').innerText = DB.news.length;
    $('c-memo').innerText = DB.memo.length;
    $('c-reports').innerText = DB.reports.length;
    $('c-strategy').innerText = DB.strategy.length;
    $('c-stocks').innerText = Object.keys(DB.stocks).length;
    $('c-trends').innerText = DB.trends.length;
    $('c-cb').innerText = DB.cb.length;

    setTimeout(() => { $('loader').classList.add('hidden'); }, 100);
    
    document.querySelectorAll('.db-tab').forEach(tab => {
        tab.onclick = () => {
            CURR_DB = tab.dataset.db;
            document.querySelectorAll('.db-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            renderList();
        };
    });
    
    renderList();
  } catch(e) {
    console.error('Init Error:', e);
    $('loader').classList.add('hidden');
    $('loadStatus').innerText = 'ËºâÂÖ•ÁôºÁîüÈåØË™§';
  }
}

// ========== Áµ±Ë®àÂçÄÂ°äÊ∏≤ÊüìÂáΩÊï∏ÔºàÁ∞°ÂåñÁâàÔºâ==========
function renderStockStats() {
    const stats = META.stockStats;
    const industries = Object.entries(stats.industries).sort((a,b) => b[1]-a[1]);
    const concepts = Object.entries(stats.conceptCategories).sort((a,b) => b[1]-a[1]);
    const markets = Object.entries(stats.markets).sort((a,b) => b[1]-a[1]);
    
    const tabsHtml = `
        <div class="cb-mode-switcher">
            <span class="cb-mode-tab ${STOCK_MODE==='all'?'active':''}" onclick="setStockMode('all')">üè¢ ÂÖ®ÈÉ®ÂÄãËÇ°</span>
            <span class="cb-mode-tab ${STOCK_MODE==='concept'?'active':''}" onclick="setStockMode('concept')">üí° Ê¶ÇÂøµËÇ°</span>
        </div>
    `;
    
    if(STOCK_MODE === 'all') {
        return `<div class="cb-stats">${tabsHtml}
            <div class="cb-stats-grid">
                <div class="cb-stat-item"><div class="cb-stat-num">${stats.total}</div><div class="cb-stat-label">‰∏äÂ∏ÇÊ´ÉÂÖ¨Âè∏</div></div>
                ${markets.slice(0, 4).map(([m, cnt]) => 
                    `<div class="cb-stat-item clickable" onclick="setSearch('${m}')"><div class="cb-stat-num">${cnt}</div><div class="cb-stat-label">${m}</div></div>`
                ).join('')}
            </div>
            <div class="cb-ind-title">üìä ÂêÑÁî¢Ê•≠ÂàÜ‰Ωà</div>
            <div class="cb-ind-grid">${industries.slice(0, 25).map(([ind, cnt]) => 
                `<div class="cb-ind-tag" onclick="setSearch('${ind}')">${ind}<span class="num">${cnt}</span></div>`
            ).join('')}</div>
        </div>`;
    } else {
        return `<div class="cb-stats">${tabsHtml}
            <div class="cb-stats-grid">
                <div class="cb-stat-item"><div class="cb-stat-num">${stats.conceptTotal}</div><div class="cb-stat-label">Ê¶ÇÂøµËÇ°Á≠ÜÊï∏</div></div>
                <div class="cb-stat-item"><div class="cb-stat-num">${concepts.length}</div><div class="cb-stat-label">Ê¶ÇÂøµÂàÜÈ°ûÊï∏</div></div>
            </div>
            <div class="cb-ind-title">üí° ÁÜ±ÈñÄÊ¶ÇÂøµÂàÜÈ°û</div>
            <div class="cb-ind-grid">${concepts.slice(0, 30).map(([c, cnt]) => 
                `<div class="cb-ind-tag" onclick="setSearch('${c}')">${c}<span class="num">${cnt}</span></div>`
            ).join('')}</div>
        </div>`;
    }
}

function setStockMode(mode) { STOCK_MODE = mode; $('search').value = ''; renderList(); }

function renderMemoStats() {
    const stats = META.memoStats;
    const brokers = Object.entries(stats.brokers).sort((a,b) => b[1]-a[1]);
    const types = Object.entries(stats.types).sort((a,b) => b[1]-a[1]);
    
    const tabsHtml = `
        <div class="cb-mode-switcher">
            <span class="cb-mode-tab ${MEMO_MODE==='all'?'active':''}" onclick="setMemoMode('all')">üìã ÂÖ®ÈÉ®</span>
            <span class="cb-mode-tab ${MEMO_MODE==='stock'?'active':''}" onclick="setMemoMode('stock')">üè¢ ÂÄãËÇ°</span>
            <span class="cb-mode-tab ${MEMO_MODE==='industry'?'active':''}" onclick="setMemoMode('industry')">üè≠ Áî¢Ê•≠</span>
        </div>
    `;
    
    if(MEMO_MODE === 'all') {
        return `<div class="cb-stats">${tabsHtml}
            <div class="cb-stats-grid">
                <div class="cb-stat-item"><div class="cb-stat-num">${stats.total}</div><div class="cb-stat-label">MemoÁ∏ΩÊï∏</div></div>
                <div class="cb-stat-item clickable" onclick="setMemoMode('stock')"><div class="cb-stat-num">${stats.stockTotal}</div><div class="cb-stat-label">ÂÄãËÇ°Â†±Âëä</div></div>
                <div class="cb-stat-item clickable" onclick="setMemoMode('industry')"><div class="cb-stat-num">${stats.industryTotal}</div><div class="cb-stat-label">Áî¢Ê•≠Â†±Âëä</div></div>
            </div>
            <div class="cb-ind-title">üìä Â†±ÂëäÈ°ûÂûãÂàÜ‰Ωà</div>
            <div class="cb-ind-grid">${types.slice(0, 15).map(([t, cnt]) => 
                `<div class="cb-ind-tag" onclick="setSearch('${t}')">${t}<span class="num">${cnt}</span></div>`
            ).join('')}</div>
        </div>`;
    } else if(MEMO_MODE === 'stock') {
        return `<div class="cb-stats">${tabsHtml}
            <div class="cb-stats-grid">
                <div class="cb-stat-item"><div class="cb-stat-num">${stats.stockTotal}</div><div class="cb-stat-label">ÂÄãËÇ°Â†±ÂëäÊï∏</div></div>
                <div class="cb-stat-item"><div class="cb-stat-num">${brokers.length}</div><div class="cb-stat-label">Âà∏ÂïÜÊï∏</div></div>
            </div>
            <div class="cb-ind-title">üè¶ ÂêÑÂà∏ÂïÜÂ†±ÂëäÊï∏</div>
            <div class="cb-ind-grid">${brokers.slice(0, 15).map(([b, cnt]) => 
                `<div class="cb-ind-tag" onclick="setSearch('${b}')">${b}<span class="num">${cnt}</span></div>`
            ).join('')}</div>
        </div>`;
    } else {
        return `<div class="cb-stats">${tabsHtml}
            <div class="cb-stats-grid">
                <div class="cb-stat-item"><div class="cb-stat-num">${stats.industryTotal}</div><div class="cb-stat-label">Áî¢Ê•≠Â†±ÂëäÊï∏</div></div>
            </div>
            <div class="cb-ind-title">üìä Áî¢Ê•≠Â†±ÂëäÈ°ûÂûã</div>
            <div class="cb-ind-grid">${types.filter(([t]) => t.includes('Áî¢Ê•≠') || t.includes('TPCA')).map(([t, cnt]) => 
                `<div class="cb-ind-tag" onclick="setSearch('${t}')">${t}<span class="num">${cnt}</span></div>`
            ).join('')}</div>
        </div>`;
    }
}

function setMemoMode(mode) { MEMO_MODE = mode; $('search').value = ''; renderList(); }

// CB Áµ±Ë®àÂçÄÂ°äÔºàÁ∞°ÂåñÁâà - ‰øùÊåÅÊ†∏ÂøÉÂäüËÉΩÔºâ
function renderCBStats() {
    const stats = META.cbStats;
    const industries = Object.entries(stats.industries).sort((a,b) => b[1]-a[1]);
    
    const tabsHtml = `
        <div class="cb-mode-header">üìä ÂèØËΩâÂÇµË≥áÊñôÂ∫´</div>
        <div class="cb-mode-switcher">
            <div class="cb-mode-row">
                <span class="cb-mode-tab ${CB_MODE==='info'?'active':''}" onclick="setCbMode('info')">üìã Âü∫Êú¨Ë≥áÊñô</span>
                <span class="cb-mode-tab ${CB_MODE==='history'?'active':''}" onclick="setCbMode('history')">üìú Ê≠∑Âè≤È´ò‰Ωé</span>
                <span class="cb-mode-tab ${CB_MODE==='active'?'active':''}" onclick="setCbMode('active')">üé´ ÁõÆÂâçÊéõÁâå</span>
            </div>
            <div class="cb-mode-row">
                <span class="cb-mode-tab ${CB_MODE==='primary'?'active':''}" onclick="setCbMode('primary')">üìù ÂàùÁ¥öÂ∏ÇÂ†¥</span>
                <span class="cb-mode-tab ${CB_MODE==='auction'?'active':''}" onclick="setCbMode('auction')">üî® Á´∂ÊãçË≥áË®ä</span>
                <span class="cb-mode-tab ${CB_MODE==='cbas'?'active':''}" onclick="setCbMode('cbas')">üíπ CBASÂ†±ÂÉπ</span>
            </div>
            <div class="cb-mode-row">
                <span class="cb-mode-tab ${CB_MODE==='putback'?'active':''}" onclick="setCbMode('putback')">üìÖ ÊèêÂâçË≥£Âõû</span>
                <span class="cb-mode-tab ${CB_MODE==='balance'?'active':''}" onclick="setCbMode('balance')">üìä ÊµÅÈÄöÈ§òÈ°ç</span>
            </div>
        </div>
    `;
    
    // ‰æùÊìöÊ®°ÂºèËøîÂõû‰∏çÂêåÁµ±Ë®àÂÖßÂÆπ
    if(CB_MODE === 'active') {
        return `<div class="cb-stats">${tabsHtml}
            <div class="cb-stats-grid">
                <div class="cb-stat-item"><div class="cb-stat-num">${stats.total}</div><div class="cb-stat-label">ÊéõÁâå‰∏≠CB</div></div>
                <div class="cb-stat-item"><div class="cb-stat-num">${stats.companies}</div><div class="cb-stat-label">ÁôºË°åÂÖ¨Âè∏Êï∏</div></div>
            </div>
            <div class="cb-ind-title">üìä ÂêÑÁî¢Ê•≠CBÂàÜ‰Ωà</div>
            <div class="cb-ind-grid">${industries.slice(0, 20).map(([ind, cnt]) => 
                `<div class="cb-ind-tag" onclick="setSearch('${ind}')">${ind}<span class="num">${cnt}</span></div>`
            ).join('')}</div>
        </div>`;
    } else if(CB_MODE === 'auction') {
        return `<div class="cb-stats">${tabsHtml}
            <div class="cb-stats-grid">
                <div class="cb-stat-item"><div class="cb-stat-num">${DB.cbAuction.length}</div><div class="cb-stat-label">Á´∂ÊãçCBÁ∏ΩÊï∏</div></div>
                <div class="cb-stat-item clickable" onclick="setSearch('ÊúâÊìî‰øù')"><div class="cb-stat-num">${DB.cbAuction.filter(c=>c._guarantee==='ÊúâÊìî‰øù').length}</div><div class="cb-stat-label">ÊúâÊìî‰øù</div></div>
                <div class="cb-stat-item clickable" onclick="setSearch('ÁÑ°Êìî‰øù')"><div class="cb-stat-num">${DB.cbAuction.filter(c=>c._guarantee==='ÁÑ°Êìî‰øù').length}</div><div class="cb-stat-label">ÁÑ°Êìî‰øù</div></div>
            </div>
        </div>`;
    } else if(CB_MODE === 'putback') {
        const within30 = DB.cbPutback.filter(c => c._daysToput <= 30).length;
        return `<div class="cb-stats">${tabsHtml}
            <div class="cb-stats-grid">
                <div class="cb-stat-item"><div class="cb-stat-num">${DB.cbPutback.length}</div><div class="cb-stat-label">Ëøë3ÂÄãÊúàÂèØË≥£Âõû</div></div>
                <div class="cb-stat-item"><div class="cb-stat-num trend-down">${within30}</div><div class="cb-stat-label">30Â§©ÂÖß</div></div>
            </div>
        </div>`;
    } else {
        // ÂÖ∂‰ªñÊ®°ÂºèÈ°ØÁ§∫Âü∫Êú¨Áµ±Ë®à
        return `<div class="cb-stats">${tabsHtml}
            <div class="cb-stats-grid">
                <div class="cb-stat-item"><div class="cb-stat-num">${DB.cbAll.length}</div><div class="cb-stat-label">ÂÖ®ÈÉ®CB</div></div>
                <div class="cb-stat-item"><div class="cb-stat-num">${DB.cb.length}</div><div class="cb-stat-label">ÊéõÁâå‰∏≠</div></div>
            </div>
        </div>`;
    }
}

function setPrimaryMode(mode) { PRIMARY_MODE = mode; $('search').value = ''; renderList(); }
function setCbMode(mode) { CB_MODE = mode; $('search').value = ''; renderList(); }
function setCbInfoTab(tab) { CB_INFO_TAB = tab; renderList(); }
function setCbInfoSub(sub) { CB_INFO_SUB = sub; renderList(); }

// ========== ‰∏ªË¶Å renderList ÂáΩÊï∏ ==========
function renderList() {
    const q = $('search').value.toLowerCase().trim();
    const qOriginal = $('search').value.trim();
    let list = [];
    
    // È°ØÁ§∫/Èö±ËóèÁµ±Ë®àÂçÄÂ°ä
    if(CURR_DB === 'cb') {
        $('cbStatsArea').innerHTML = renderCBStats();
        $('cbStatsArea').style.display = 'block';
        $('stockStatsArea').style.display = 'none';
        $('memoStatsArea').style.display = 'none';
    } else if(CURR_DB === 'stocks') {
        $('stockStatsArea').innerHTML = renderStockStats();
        $('stockStatsArea').style.display = 'block';
        $('cbStatsArea').style.display = 'none';
        $('memoStatsArea').style.display = 'none';
    } else if(CURR_DB === 'memo') {
        $('memoStatsArea').innerHTML = renderMemoStats();
        $('memoStatsArea').style.display = 'block';
        $('cbStatsArea').style.display = 'none';
        $('stockStatsArea').style.display = 'none';
    } else {
        $('cbStatsArea').style.display = 'none';
        $('stockStatsArea').style.display = 'none';
        $('memoStatsArea').style.display = 'none';
    }
    
    if(CURR_DB==='news') list = DB.news;
    else if(CURR_DB==='memo') {
        if(MEMO_MODE === 'all') list = DB.memo;
        else if(MEMO_MODE === 'stock') list = DB.memoStock;
        else if(MEMO_MODE === 'industry') list = DB.memoIndustry;
    }
    else if(CURR_DB==='reports') list = DB.reports;
    else if(CURR_DB==='strategy') list = DB.strategy;
    else if(CURR_DB==='stocks') {
        if(STOCK_MODE === 'all') list = Object.values(DB.stocks);
        else if(STOCK_MODE === 'concept') list = DB.conceptStocks;
    }
    else if(CURR_DB==='trends') list = DB.trends;
    else if(CURR_DB==='cb') {
        if(CB_MODE === 'info') list = DB.cbAll;
        else if(CB_MODE === 'active') list = DB.cb;
        else if(CB_MODE === 'history') list = DB.cbHistory;
        else if(CB_MODE === 'auction') list = DB.cbAuction;
        else if(CB_MODE === 'primary') list = PRIMARY_MODE === 'underwriting' ? DB.cbPrimary : DB.cbBoard;
        else if(CB_MODE === 'balance') list = DB.cbBalance;
        else if(CB_MODE === 'cbas') list = DB.cbCBAS;
        else if(CB_MODE === 'putback') list = DB.cbPutback;
    }

    const filtered = list.filter(i => {
        const str = JSON.stringify(i).toLowerCase();
        if(str.includes(q)) return true;
        if(CURR_DB==='memo' && i['Á∑®Ëôü']) {
            const d = META.memoDetail[i['Á∑®Ëôü']];
            if(d && JSON.stringify(d).toLowerCase().includes(q)) return true;
        }
        return false;
    });
    
    $('resCount').innerText = filtered.length;

    let html = '';
    
    // v11.7: CB Ê®°ÂºèÈ°ØÁ§∫ÂàóË°®ÁØ©ÈÅ∏Ê°Ü
    if(CURR_DB === 'cb') {
        $('listFilterArea').innerHTML = renderListFilterBar(filtered.length);
    } else {
        $('listFilterArea').innerHTML = '';
    }
    
    // CB Áî®Ë°®Ê†ºÂΩ¢Âºè
    if(CURR_DB === 'cb') {
        let validFiltered = filtered;
        const noFilterModes = ['primary', 'balance', 'cbas', 'info', 'putback'];
        if(!noFilterModes.includes(CB_MODE)) {
            validFiltered = filtered.filter(r => {
                const high = parseFloat(r['_high']) || 0;
                const low = parseFloat(r['_low']) || 0;
                return high > 0 && low > 0;
            });
        }
        
        $('resCount').innerText = validFiltered.length;
        // Êõ¥Êñ∞ÁØ©ÈÅ∏Ê°ÜË®àÊï∏
        const filterCountEl = document.getElementById('listFilterCount');
        if(filterCountEl) filterCountEl.innerHTML = `È°ØÁ§∫ <b>${validFiltered.length}</b> Á≠Ü`;
        
        if(CB_MODE === 'auction') {
            html = `<div class="cb-table-wrap"><table class="cb-table" id="cbTable">
                <thead><tr>
                    <th class="sortable" data-col="_cbCode" data-type="string">CB‰ª£Ëôü</th>
                    <th>CBÁ∞°Á®±</th>
                    <th class="sortable hide-mobile" data-col="ÈñãÊ®ôÊó•Êúü" data-type="date">ÈñãÊ®ôÊó•</th>
                    <th class="sortable" data-col="ÊäïÊ®ôÂÄçÊï∏" data-type="num">ÊäïÊ®ôÂÄçÊï∏</th>
                    <th class="sortable" data-col="ÊúÄ‰ΩéÂæóÊ®ô" data-type="num">ÊúÄ‰ΩéÂæóÊ®ô</th>
                    <th class="sortable" data-col="Âπ≥ÂùáÂæóÊ®ô" data-type="num">Âπ≥ÂùáÂæóÊ®ô</th>
                    <th class="sortable" data-col="_high" data-type="num">ÊéõÁâåÊúÄÈ´ò</th>
                    <th class="sortable" data-col="_low" data-type="num">ÊéõÁâåÊúÄ‰Ωé</th>
                    <th class="sortable" data-col="_range" data-type="num">ÊåØÂπÖ%</th>
                </tr></thead><tbody>`;
            
            validFiltered.slice(0, 150).forEach(r => {
                html += `<tr>
                    <td class="code">${r['_cbCode']}</td>
                    <td>${r['_name']}</td>
                    <td class="hide-mobile">${fmtDate(r['ÈñãÊ®ôÊó•Êúü'])}</td>
                    <td>${fmtNum(r['ÊäïÊ®ôÂÄçÊï∏'], 2)}x</td>
                    <td>${fmtNum(r['ÊúÄ‰ΩéÂæóÊ®ô'], 2)}</td>
                    <td>${fmtNum(r['Âπ≥ÂùáÂæóÊ®ô'], 2)}</td>
                    <td>${fmtNum(r['_high'], 1)}</td>
                    <td>${fmtNum(r['_low'], 1)}</td>
                    <td class="${colorClass(r['_range'])}">${fmtNum(r['_range'], 1)}%</td>
                </tr>`;
            });
            html += `</tbody></table></div>`;
        } else if(CB_MODE === 'active' || CB_MODE === 'history') {
            html = `<div class="cb-table-wrap"><table class="cb-table" id="cbTable">
                <thead><tr>
                    <th class="sortable" data-col="_cbCode" data-type="string">CB‰ª£Ëôü</th>
                    <th>CBÁ∞°Á®±</th>
                    <th class="hide-mobile">Ê®ôÁöÑËÇ°Á•®</th>
                    <th class="sortable hide-mobile" data-col="_industry" data-type="string">Áî¢Ê•≠</th>
                    <th class="sortable" data-col="_high" data-type="num">ÊéõÁâåÊúÄÈ´ò</th>
                    <th class="sortable" data-col="_low" data-type="num">ÊéõÁâåÊúÄ‰Ωé</th>
                    <th class="sortable" data-col="_range" data-type="num">ÊåØÂπÖ%</th>
                    <th class="sortable" data-col="expDate" data-type="date">Âà∞ÊúüÊó•</th>
                </tr></thead><tbody>`;
            
            validFiltered.slice(0, 150).forEach(r => {
                const cbCode = r['_cbCode'] || safe(r['‰ª£Ëôü']);
                const cbName = r['_name'] || safe(r['ÂêçÁ®±']);
                const stockCode = r['_stockCode'] || '';
                const stockName = r['_stockName'] || '';
                const ind = r['_industry'] || '';
                const high = r['_high'];
                const low = r['_low'];
                const range = r['_range'];
                const expDate = fmtDate(r['Âà∞ÊúüÊó•']);
                
                html += `<tr>
                    <td class="code">${cbCode}</td>
                    <td>${cbName}</td>
                    <td class="stock hide-mobile" onclick="openStock('${stockCode}')">${stockName} ${stockCode}</td>
                    <td class="hide-mobile">${ind}</td>
                    <td>${fmtNum(high, 1)}</td>
                    <td>${fmtNum(low, 1)}</td>
                    <td class="${colorClass(range)}">${fmtNum(range, 1)}%</td>
                    <td>${expDate}</td>
                </tr>`;
            });
            html += `</tbody></table></div>`;
        } else if(CB_MODE === 'putback') {
            html = `<div class="cb-table-wrap"><table class="cb-table" id="cbTable">
                <thead><tr>
                    <th>CB‰ª£Ëôü</th><th>CBÁ∞°Á®±</th><th>ËÇ°Á•®</th><th>Ë≥£ÂõûÊó•Êúü</th><th>Ââ©È§òÂ§©Êï∏</th><th>ËΩâÊèõÂÉπ</th>
                </tr></thead><tbody>`;
            
            validFiltered.forEach(r => {
                const daysClass = r._daysToput <= 30 ? 't-down' : (r._daysToput <= 60 ? 'trend-warning' : '');
                html += `<tr>
                    <td class="code">${r._cbCode}</td>
                    <td>${r._name || ''}</td>
                    <td class="stock" onclick="openStock('${r._stockCode}')">${r._stockCode}</td>
                    <td>${fmtDate(r._nearestPutDate)}</td>
                    <td class="${daysClass}">${r._daysToput} Â§©</td>
                    <td>${fmtNum(r._convPrice, 2)}</td>
                </tr>`;
            });
            html += `</tbody></table></div>`;
        } else if(CB_MODE === 'balance') {
            html = `<div class="cb-table-wrap"><table class="cb-table balance-table" id="cbTable">
                <thead><tr>
                    <th>‰ª£Ëôü</th><th>ÂêçÁ®±</th><th>Êú¨ÈÄ±</th><th>‰∏äÈÄ±</th><th>Â¢ûÊ∏õ</th><th>ÊØîÁéá%</th><th>Ââ©È§ò%</th>
                </tr></thead><tbody>`;
            
            validFiltered.slice(0, 150).forEach(r => {
                const change = parseFloat(r._change) || 0;
                const changeRate = parseFloat(r._changeRate) || 0;
                html += `<tr>
                    <td class="code">${r._cbCode}</td>
                    <td class="name-col">${r._name}</td>
                    <td>${fmtNum(r._thisWeek, 0)}</td>
                    <td>${fmtNum(r._lastWeek, 0)}</td>
                    <td class="${change < 0 ? 't-down' : ''}">${fmtNum(change, 0)}</td>
                    <td class="${changeRate < 0 ? 't-down' : ''}">${fmtNum(changeRate, 2)}%</td>
                    <td>${fmtNum(r._remainRate, 0)}%</td>
                </tr>`;
            });
            html += `</tbody></table></div>`;
        } else if(CB_MODE === 'cbas') {
            html = `<div class="cb-table-wrap"><table class="cb-table" id="cbTable">
                <thead><tr>
                    <th>‰ª£Ëôü</th><th>ÂêçÁ®±</th><th>Êìî‰øù</th><th>Âπ¥Êúü</th><th>Ê¨äÂà©Èáë</th><th>ËΩâÊèõÂÉπ</th><th>ËÇ°ÂÉπ</th><th>Ê∫¢ÊäòÂÉπ%</th>
                </tr></thead><tbody>`;
            
            validFiltered.slice(0, 150).forEach(r => {
                const premPct = parseFloat(r._premiumPct) || 0;
                html += `<tr>
                    <td class="code">${r._cbCode}</td>
                    <td class="name-col">${r._name}</td>
                    <td>${r._guarantee}</td>
                    <td>${fmtNum(r._remainYears, 2)}</td>
                    <td>${fmtNum(r._premium, 2)}</td>
                    <td>${fmtNum(r._convPrice, 2)}</td>
                    <td>${fmtNum(r._stockPrice, 2)}</td>
                    <td class="${colorClass(premPct)}">${fmtNum(premPct, 1)}%</td>
                </tr>`;
            });
            html += `</tbody></table></div>`;
        } else {
            // info Ê®°ÂºèÊàñÂÖ∂‰ªñ
            html = `<div class="cb-table-wrap"><table class="cb-table" id="cbTable">
                <thead><tr>
                    <th>CB‰ª£Ëôü</th><th>CBÁ∞°Á®±</th><th>ËÇ°Á•®</th><th class="hide-mobile">Áî¢Ê•≠</th><th>Ë©¢/Á´∂</th><th>Êìî‰øù</th><th>ËΩâÊèõÂÉπ</th>
                </tr></thead><tbody>`;
            
            validFiltered.slice(0, 150).forEach(r => {
                html += `<tr>
                    <td class="code">${r._cbCode}</td>
                    <td>${r._name || ''}</td>
                    <td class="stock" onclick="openStock('${r._stockCode}')">${r._stockCode}</td>
                    <td class="hide-mobile">${r._industry || ''}</td>
                    <td>${r._method || ''}</td>
                    <td>${r._guarantee || ''}</td>
                    <td>${fmtNum(r._convPrice, 2)}</td>
                </tr>`;
            });
            html += `</tbody></table></div>`;
        }
    } else {
        // ÂÖ∂‰ªñÂàÜÈ†ÅÁî®Âç°Áâá
        filtered.slice(0, 100).forEach(i => {
            let title='', sub='', date='', code='', tagClass='brk', body='', click='', cardClass='card';
            
            if(CURR_DB==='stocks') {
                if(STOCK_MODE === 'all') {
                    title = i['ÂÖ¨Âè∏ÂêçÁ®±']; code = i['‰ª£Ëôü']; sub = i['Áî¢Ê•≠ÂàÜÈ°û']; 
                    body = i['Ê•≠ÂãôÊëòË¶Å'] || i['Áî¢Ê•≠Á¥∞ÂàÜ'] || '';
                    click = `openStock('${code}')`;
                } else {
                    title = i['_name']; code = i['_code']; 
                    sub = i['_concept']; tagClass = 'concept';
                    body = `${i['_subCat'] ? '„Äê'+i['_subCat']+'„Äë' : ''}${i['_desc'] || ''}`;
                    click = `openStock('${code}')`;
                }
                const cbList = META.cbMap[code] || [];
                if(cbList.length > 0) {
                    i._cbTags = cbList.map(cb => `<span class="tag cb-tag">${cb._name || cb['ÂêçÁ®±']}</span>`).join('');
                }
            }
            else if(CURR_DB==='news') {
                const dataType = i['Ë≥áÊñôÈ°ûÂûã'] || '';
                const isIndustry = dataType === 'Áî¢Ê•≠Ë∂®Âã¢';
                title = i['ÂÖ¨Âè∏']; code = i['ËÇ°Ëôü']; sub = isIndustry ? 'Áî¢Ê•≠Ë∂®Âã¢' : i['Â†±Â∞éÈáçÈªûÂàÜÈ°û']; 
                date = i['Êó•Êúü']; tagClass = isIndustry ? 'trend-ind' : 'ind';
                body = safe(i['ÂÆåÊï¥Â†±Â∞éÂÖßÂÆπ']).substring(0, 150);
                click = `openNews('${i['Á∑®Ëôü']}')`;
                if(isIndustry) cardClass = 'card industry-card';
            }
            else if(CURR_DB==='memo') {
                title = i['ÂÖ¨Âè∏']; code = i['ËÇ°Ëôü']; sub = i['Â†±ÂëäÈ°ûÂûã']; date = i['Êó•Êúü'];
                const d = META.memoDetail[i['Á∑®Ëôü']];
                body = d ? (safe(d['ÁáüÈÅãÈáçÈªû']).substring(0,100) + '...') : 'ÈªûÊìäÊü•ÁúãË©≥ÊÉÖ';
                click = `openMemo('${i['Á∑®Ëôü']}')`;
                const reportType = i['Â†±ÂëäÈ°ûÂûã'] || '';
                if(reportType.includes('Áî¢Ê•≠')) { tagClass = 'trend-ind'; cardClass = 'card industry-card'; }
            }
            else if(CURR_DB==='reports') {
                title = i['Â†±ÂëäÊ®ôÈ°å']; sub = i['Âà∏ÂïÜÂêçÁ®±'] + ' - ' + safe(i['Áî¢Ê•≠ÂêçÁ®±']); 
                date = i['Â†±ÂëäÊó•Êúü']; tagClass = 'ind'; body = i['ÂâØÊ®ôÈ°å'] || '';
                click = `openReport('${i['Â†±ÂëäÁ∑®Ëôü']}')`;
            }
            else if(CURR_DB==='strategy') {
                title = i['Â†±Âëä‰∏ªÈ°å']; sub = i['‰∏ªË¨õÂñÆ‰Ωç']; date = i['Â†±ÂëäÊó•Êúü']; tagClass = 'ind';
                const secData = META.stratSections?.[i['Â†±ÂëäÁ∑®Ëôü']];
                const coreView = secData?.basic?.['Ê†∏ÂøÉËßÄÈªû'] || '';
                const speaker = i['Ë¨õËÄÖ'] || '';
                body = `${speaker ? 'Ë¨õËÄÖ: '+speaker+' | ' : ''}${coreView.substring(0, 80)}`;
                click = `openStrategy('${i['Â†±ÂëäÁ∑®Ëôü']}')`;
            }
            else if(CURR_DB==='trends') {
                title = i['Áî¢Ê•≠']; sub = i['Ë∂®Âã¢Âà§Êñ∑']; tagClass = 'trend-up'; code = i['ËÇ°Ëôü']; 
                body = `‰ª£Ë°®:${i['‰ª£Ë°®ÂÖ¨Âè∏']} | ‰ΩçÁΩÆ:${i['ÊôØÊ∞£‰ΩçÁΩÆ']}`;
                click = `openTrend('${i['Áî¢Ê•≠']}')`;
            }

            html += `<div class="${cardClass}" onclick="${click}">
                <div class="card-head"><div class="card-title">${title} ${code?`<span style="color:#999;font-weight:400">${code}</span>`:''}</div>${i._cbTags ? `<div class="cb-tags">${i._cbTags}</div>` : ''}</div>
                <div class="card-meta"><span class="tag ${tagClass}">${sub||'‰∏ÄËà¨'}</span>${date?`<span class="tag dt">${fmtDate(date)}</span>`:''}</div>
                <div class="card-body">${body}</div>
            </div>`;
        });
    }
    
    $('list').innerHTML = html || '<div style="text-align:center;padding:30px;color:#999">ÁÑ°Áõ∏Á¨¶Ë≥áÊñô</div>';
    
    if(CURR_DB === 'cb') {
        $('list').classList.add('cb-mode');
        setTimeout(initCbSort, 50);
    } else {
        $('list').classList.remove('cb-mode');
    }
}

// ========== Modal Áõ∏Èóú ==========
function showModal(infoHtml, navItems) {
    $('m-info').innerHTML = infoHtml;
    $('navGrid').innerHTML = navItems.map((n,i) => 
        `<button class="nav-btn ${i===0?'active':''}" onclick="swTab('${n.id}', this)">${n.icon} ${n.label}</button>`
    ).join('');
    $('navGrid').style.display = navItems.length > 1 ? 'flex' : 'none';
    const tagsEl = $('m-tags');
    if(tagsEl && !tagsEl.innerHTML) tagsEl.classList.remove('show');
    $('modal').classList.add('show');
}

window.swTab = (id, el) => {
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    if(el) el.classList.add('active');
    document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
    const pane = document.getElementById('tab-'+id);
    if(pane) pane.classList.add('active');
};

window.swFin = idx => {
    document.querySelectorAll('.fin-btn').forEach((b,i) => b.classList.toggle('active', i===idx));
    document.querySelectorAll('.fin-sub-pane').forEach((p,i) => p.classList.toggle('active', i===idx));
};

window.closeModal = e => {
    if(!e || e.target.id==='modal' || e.target.classList.contains('m-close')) {
        $('modal').classList.remove('show');
        const tagsEl = $('m-tags');
        if(tagsEl) { tagsEl.innerHTML = ''; tagsEl.classList.remove('show'); }
    }
};

// CB Ë°®Ê†ºÊéíÂ∫è
let cbSortCol = null;
let cbSortDir = 'asc';

window.initCbSort = () => {
    document.querySelectorAll('.cb-table th.sortable').forEach(th => {
        th.addEventListener('click', (e) => {
            const col = th.dataset.col;
            const type = th.dataset.type;
            
            if(cbSortCol === col) {
                cbSortDir = cbSortDir === 'asc' ? 'desc' : 'asc';
            } else {
                cbSortCol = col;
                cbSortDir = 'desc';
            }
            
            document.querySelectorAll('.cb-table th.sortable').forEach(h => h.classList.remove('sort-asc', 'sort-desc'));
            th.classList.add(cbSortDir === 'asc' ? 'sort-asc' : 'sort-desc');
            
            const tbody = document.querySelector('.cb-table tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            rows.sort((a, b) => {
                let aVal, bVal;
                const aIndex = Array.from(th.parentNode.children).indexOf(th);
                
                aVal = a.children[aIndex]?.textContent?.trim() || '';
                bVal = b.children[aIndex]?.textContent?.trim() || '';
                
                aVal = aVal.replace(/%/g, '').replace(/x/g, '').replace(/,/g, '');
                bVal = bVal.replace(/%/g, '').replace(/x/g, '').replace(/,/g, '');
                
                if(aVal === '-') aVal = type === 'num' ? '-999999999' : '';
                if(bVal === '-') bVal = type === 'num' ? '-999999999' : '';
                
                if(type === 'num') {
                    aVal = parseFloat(aVal) || 0;
                    bVal = parseFloat(bVal) || 0;
                } else if(type === 'date') {
                    aVal = aVal.replace(/\//g, '');
                    bVal = bVal.replace(/\//g, '');
                }
                
                if(aVal < bVal) return cbSortDir === 'asc' ? -1 : 1;
                if(aVal > bVal) return cbSortDir === 'asc' ? 1 : -1;
                return 0;
            });
            
            rows.forEach(row => tbody.appendChild(row));
        });
    });
};

// ========== ÈñãÂïüÂêÑÁ®ÆË©≥ÊÉÖÈ†ÅÔºàÁ∞°ÂåñÁâàÔºâ==========
window.openStock = code => {
    if(!code || code==='-') return;
    code = normalizeCode(code);
    const s = DB.stocks[code] || { 'ÂÖ¨Âè∏ÂêçÁ®±': code, '‰ª£Ëôü': code };
    const name = s['ÂÖ¨Âè∏ÂêçÁ®±'] || code;
    const concepts = META.concepts[code] || [];
    const cbs = META.cbMap[code] || [];

    const infoHtml = `
        <div style="font-size:22px;font-weight:700;margin-bottom:5px">${name} <span style="color:#999;font-size:16px">${code}</span></div>
        <div class="card-meta">
            <span class="tag ind">${s['Áî¢Ê•≠ÂàÜÈ°û']||'Êú™ÂàÜÈ°û'}</span>
            ${concepts.slice(0,3).map(c=>`<span class="tag concept">#${c.concept}</span>`).join('')}
        </div>
    `;

    let content = `<div class="section-head">üìä Âü∫Êú¨Ë≥áÊñô</div>
        <div class="info-row"><span class="info-label">Áî¢Ê•≠ÂàÜÈ°û</span><span class="info-val">${s['Áî¢Ê•≠ÂàÜÈ°û']||'-'}</span></div>
        <div class="info-row"><span class="info-label">Â∏ÇÂ†¥ÂàÜÈ°û</span><span class="info-val">${s['Â∏ÇÂ†¥ÂàÜÈ°û']||'-'}</span></div>`;
    
    if(cbs.length) {
        content += `<div class="section-head">üé´ ÂèØËΩâÂÇµ (${cbs.length})</div>`;
        cbs.forEach(c => {
            content += `<div class="hl-block"><b>${c['_name']||c['ÂêçÁ®±']}</b><br>Âà∞Êúü: ${fmtDate(c['Âà∞ÊúüÊó•'])}</div>`;
        });
    }

    $('m-body').innerHTML = `<div id="tab-main" class="tab-pane active">${content}</div>`;
    showModal(infoHtml, []);
};

window.openMemo = id => {
    const m = DB.memo.find(i => String(i['Á∑®Ëôü']) === String(id));
    if(!m) return;
    const d = META.memoDetail[id] || {};

    const infoHtml = `
        <div style="font-size:20px;font-weight:700;margin-bottom:5px">${m['ÂÖ¨Âè∏']} <span style="color:#999;font-size:14px">${m['ËÇ°Ëôü']}</span></div>
        <div class="card-meta">
            <span class="tag brk">${m['Âà∏ÂïÜ']}</span>
            <span class="tag ind">${m['Â†±ÂëäÈ°ûÂûã']}</span>
            <span class="tag dt">${fmtDate(m['Êó•Êúü'])}</span>
        </div>
    `;

    const navItems = [
        {id:'op', icon:'üéØ', label:'ÁáüÈÅãÈáçÈªû'},
        {id:'strat', icon:'üöÄ', label:'Á≠ñÁï•ÊñπÂêë'}
    ];

    const tOp = d['ÁáüÈÅãÈáçÈªû'] ? `<div class="hl-block">${fmtTxt(d['ÁáüÈÅãÈáçÈªû'])}</div>` : '<div style="color:#999;text-align:center;padding:20px">ÁÑ°Ë≥áÊñô</div>';
    const tStrat = d['Á≠ñÁï•ÊñπÂêë'] ? `<div class="hl-block">${fmtTxt(d['Á≠ñÁï•ÊñπÂêë'])}</div>` : '<div style="color:#999;text-align:center;padding:20px">ÁÑ°Ë≥áÊñô</div>';

    $('m-body').innerHTML = `
        <div id="tab-op" class="tab-pane active">${tOp}</div>
        <div id="tab-strat" class="tab-pane">${tStrat}</div>
    `;
    showModal(infoHtml, navItems);
};

window.openReport = rid => {
    const r = DB.reports.find(i => i['Â†±ÂëäÁ∑®Ëôü'] === rid);
    if(!r) return;

    const infoHtml = `
        <div style="font-size:18px;font-weight:700;color:var(--primary);margin-bottom:5px">${r['Â†±ÂëäÊ®ôÈ°å']}</div>
        <div class="card-meta">
            <span class="tag brk">${r['Âà∏ÂïÜÂêçÁ®±']}</span>
            <span class="tag dt">${fmtDate(r['Â†±ÂëäÊó•Êúü'])}</span>
        </div>
    `;

    let content = '';
    ['Ê†∏ÂøÉÈáçÈªû1','Ê†∏ÂøÉÈáçÈªû2','Ê†∏ÂøÉÈáçÈªû3'].forEach((k,i) => {
        if(r[k]) content += `<div class="hl-block"><b>${i+1}.</b> ${r[k]}</div>`;
    });

    $('m-body').innerHTML = `<div id="tab-main" class="tab-pane active">${content}</div>`;
    showModal(infoHtml, []);
};

window.openStrategy = rid => {
    const r = DB.strategy.find(i => i['Â†±ÂëäÁ∑®Ëôü'] === rid);
    if(!r) return;

    const infoHtml = `
        <div style="font-size:18px;font-weight:700;color:var(--primary);margin-bottom:5px">${r['Â†±Âëä‰∏ªÈ°å']}</div>
        <div class="card-meta">
            <span class="tag brk">${r['‰∏ªË¨õÂñÆ‰Ωç']}</span>
            <span class="tag dt">${fmtDate(r['Â†±ÂëäÊó•Êúü'])}</span>
        </div>
    `;

    const secData = META.stratSections?.[rid];
    let content = '';
    if(secData?.basic?.['Ê†∏ÂøÉËßÄÈªû']) {
        content += `<div class="hl-block"><b>üìå Ê†∏ÂøÉËßÄÈªû</b><br>${fmtTxt(secData.basic['Ê†∏ÂøÉËßÄÈªû'])}</div>`;
    }

    $('m-body').innerHTML = `<div id="tab-main" class="tab-pane active">${content}</div>`;
    showModal(infoHtml, []);
};

window.openTrend = indName => {
    const t = DB.trends.find(i => i['Áî¢Ê•≠'] === indName);
    if(!t) return;

    const infoHtml = `
        <div style="font-size:20px;font-weight:700;margin-bottom:5px">${t['Áî¢Ê•≠']}</div>
        <div class="card-meta">
            <span class="tag trend-up">${t['Ë∂®Âã¢Âà§Êñ∑']}</span>
        </div>
    `;

    const stockCode = normalizeCode(t['ËÇ°Ëôü']);
    const content = `
        <div class="info-row"><span class="info-label">‰ª£Ë°®ÂÖ¨Âè∏</span><span class="info-val tag-link" onclick="openStock('${stockCode}')">${t['‰ª£Ë°®ÂÖ¨Âè∏']} ${stockCode}</span></div>
        <div class="section-head">üöÄ ÈóúÈçµÈ©ÖÂãïÂõ†Á¥†</div>
        <div class="hl-block">${fmtTxt(t['ÈóúÈçµÈ©ÖÂãïÂõ†Á¥†'])}</div>
    `;

    $('m-body').innerHTML = `<div id="tab-main" class="tab-pane active">${content}</div>`;
    showModal(infoHtml, []);
};

window.openNews = id => {
    const n = DB.news.find(i => String(i['Á∑®Ëôü']) === String(id));
    if(!n) return;

    const infoHtml = `
        <div style="font-size:18px;font-weight:700;margin-bottom:5px">${n['ÂÖ¨Âè∏']} <span style="color:#999;font-size:14px">${n['ËÇ°Ëôü']}</span></div>
        <div class="card-meta">
            <span class="tag ind">${n['Â†±Â∞éÈáçÈªûÂàÜÈ°û']}</span>
            <span class="tag dt">${fmtDate(n['Êó•Êúü'])}</span>
        </div>
    `;

    const content = `<div class="hl-block">${fmtTxt(n['ÂÆåÊï¥Â†±Â∞éÂÖßÂÆπ'])}</div>`;

    $('m-body').innerHTML = `<div id="tab-main" class="tab-pane active">${content}</div>`;
    showModal(infoHtml, []);
};

window.onload = init;
</script>
</body>
</html>
