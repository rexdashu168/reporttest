<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rexå¤§å”æŠ•è³‡ç ”ç©¶å®¤</title>
    
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script>
        if (typeof XLSX === 'undefined') {
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"><\/script>');
        }
    </script>

    <style>
        /* ===== åŸºç¤é‡ç½® ===== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", sans-serif; background: #f5f4ef; min-height: 100vh; color: #2d2d2d; }
        .container { max-width: 1200px; margin: 0 auto; padding: 12px; padding-bottom: 80px; }
        
        /* ===== Loading ç•«é¢æ¨£å¼ ===== */
        .loading-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: #f5f4ef;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999; transition: opacity 0.5s ease, visibility 0.5s;
        }
        .loading-overlay.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .splash-content { text-align: center; width: 80%; max-width: 320px; animation: fadeIn 0.5s ease-out; }
        .splash-icon { font-size: 48px; margin-bottom: 20px; animation: bounce 2s infinite; }
        .splash-title { font-size: 18px; color: #2d2d2d; font-weight: 700; margin-bottom: 8px; letter-spacing: 1px; }
        .splash-subtitle { font-size: 13px; color: #8b8b8b; margin-bottom: 25px; font-weight: 400; }
        .splash-progress-track { width: 100%; height: 4px; background: #e5e3dc; border-radius: 4px; overflow: hidden; }
        .splash-progress-bar { height: 100%; background: #c96442; width: 0%; border-radius: 4px; transition: width 0.3s ease-out; box-shadow: 0 0 10px rgba(201, 100, 66, 0.3); }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-10px); } 60% { transform: translateY(-5px); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ===== Header & Tabs ===== */
        .header { text-align: center; padding: 20px 0 15px; border-bottom: 1px solid #e5e3dc; margin-bottom: 15px; }
        .header h1 { font-size: 22px; color: #c96442; margin-bottom: 4px; }
        .header .subtitle { color: #6b6b6b; font-size: 13px; }
        .db-switcher { display: flex; justify-content: center; gap: 6px; margin: 15px 0; flex-wrap: wrap; }
        .db-tab { padding: 8px 14px; border: 2px solid #e5e3dc; background: #fff; border-radius: 20px; font-size: 12px; font-weight: 600; color: #6b6b6b; cursor: pointer; transition: all 0.2s; }
        .db-tab:hover { border-color: #c96442; color: #c96442; }
        .db-tab.active { background: #c96442; border-color: #c96442; color: #fff; }
        .db-tab .count { background: rgba(0,0,0,0.1); padding: 1px 6px; border-radius: 8px; font-size: 10px; margin-left: 3px; }
        .db-tab.active .count { background: rgba(255,255,255,0.3); }

        /* ===== Search & Filter ===== */
        .search-section { background: #fff; border: 1px solid #e5e3dc; border-radius: 16px; padding: 14px; margin-bottom: 15px; }
        .main-search { position: relative; margin-bottom: 10px; }
        .main-search::before { content: "ğŸ”"; position: absolute; left: 14px; top: 50%; transform: translateY(-50%); font-size: 15px; }
        #mainSearchInput { width: 100%; padding: 12px 12px 12px 44px; border: 2px solid #e5e3dc; border-radius: 25px; background: #fafaf8; font-size: 15px; }
        #mainSearchInput:focus { outline: none; border-color: #c96442; background: #fff; }
        .search-suggestions { position: absolute; top: 100%; left: 0; right: 0; background: #fff; border: 1px solid #e5e3dc; border-radius: 12px; margin-top: 4px; max-height: 400px; overflow-y: auto; z-index: 100; display: none; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .search-suggestions.active { display: block; }
        .suggestion-group { padding: 6px 0; border-bottom: 1px solid #f0eeea; }
        .suggestion-group-title { padding: 4px 12px; font-size: 10px; color: #8b8b8b; text-transform: uppercase; }
        .suggestion-item { padding: 10px 12px; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .suggestion-item:hover { background: #fafaf8; }
        .hot-tags { margin-bottom: 10px; }
        .hot-tags-title { font-size: 11px; color: #8b8b8b; margin-bottom: 6px; }
        .hot-tags-list { display: flex; flex-wrap: wrap; gap: 5px; }
        .hot-tag { padding: 5px 10px; background: linear-gradient(135deg, #fff3e6, #ffe6cc); border: none; border-radius: 12px; font-size: 12px; color: #c96442; cursor: pointer; transition: all 0.2s; }
        .filter-row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
        .filter-select { flex: 1; min-width: 100px; }
        .filter-select select { width: 100%; padding: 9px 10px; border: 1px solid #e5e3dc; border-radius: 18px; background: #fafaf8; font-size: 12px; cursor: pointer; }
        .clear-all-btn { padding: 9px 14px; background: transparent; border: 1px solid #d64545; border-radius: 18px; font-size: 12px; color: #d64545; cursor: pointer; transition: all 0.2s; }
        .clear-all-btn:hover { background: #d64545; color: #fff; }
        .active-filters { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 8px; }
        .active-filter { display: inline-flex; align-items: center; gap: 5px; padding: 4px 10px; background: #c96442; color: #fff; border-radius: 12px; font-size: 11px; }

        /* ===== Cards & List ===== */
        .stats-bar { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; margin-bottom: 10px; font-size: 12px; color: #6b6b6b; }
        .stats-bar strong { color: #c96442; }
        .sort-options { display: flex; gap: 6px; }
        .sort-btn { padding: 4px 10px; background: #eceae3; border: none; border-radius: 10px; font-size: 11px; cursor: pointer; transition: all 0.2s; }
        .sort-btn.active { background: #c96442; color: #fff; }
        .reports-list { display: flex; flex-direction: column; gap: 10px; }
        .card-base { background: #fff; border: 1px solid #e5e3dc; border-radius: 14px; padding: 14px; cursor: pointer; transition: all 0.2s; }
        .card-base:hover { border-color: #c96442; box-shadow: 0 4px 16px rgba(201,100,66,0.12); transform: translateY(-1px); }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .card-left { display: flex; align-items: center; gap: 8px; flex: 1; flex-wrap: wrap; }
        .company-name { font-size: 15px; font-weight: 700; }
        .company-link { color: #c96442; cursor: pointer; text-decoration: underline; }
        .stock-code { font-size: 11px; color: #8b8b8b; background: #f0eeea; padding: 2px 6px; border-radius: 6px; cursor: pointer; }
        .importance { color: #f5a623; font-size: 11px; }
        .card-meta { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; }
        .meta-tag { font-size: 10px; padding: 3px 8px; border-radius: 10px; font-weight: 500; }
        .meta-tag.broker { background: #c96442; color: #fff; }
        .meta-tag.category { background: #5a9e6f; color: #fff; }
        .meta-tag.industry { background: #6b8cce; color: #fff; }
        .meta-tag.date { background: #eceae3; color: #5a5a5a; }
        .meta-tag.trend { background: #27ae60; color: #fff; }
        .meta-tag.rating { background: #9b59b6; color: #fff; }
        .card-content { font-size: 13px; color: #5a5a5a; line-height: 1.6; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .card-tags { display: flex; flex-wrap: wrap; gap: 4px; }
        .mini-tag { font-size: 10px; padding: 2px 6px; background: #fff3e6; color: #c96442; border-radius: 6px; cursor: pointer; }
        .card-data { display: flex; gap: 12px; flex-wrap: wrap; padding-top: 8px; border-top: 1px solid #f0eeea; margin-top: 8px; }
        .data-item { font-size: 11px; }
        .data-label { color: #8b8b8b; }
        .data-value { font-weight: 600; }
        .data-value.positive { color: #2e7d46; }

        /* Card Variants */
        .trend-card { background: linear-gradient(135deg, #fff, #f0fdf4); border: 2px solid #5a9e6f; }
        .trend-badge { font-size: 10px; padding: 2px 8px; background: #5a9e6f; color: #fff; border-radius: 8px; margin-bottom: 6px; display: inline-block; }
        .stock-card { background: linear-gradient(135deg, #fff, #f8f9ff); border: 2px solid #6b8cce; }
        .stock-badge { font-size: 10px; padding: 2px 8px; background: #6b8cce; color: #fff; border-radius: 8px; margin-bottom: 6px; display: inline-block; }
        .industry-card { background: linear-gradient(135deg, #fff, #faf5ff); border: 2px solid #9b59b6; }
        .industry-badge { font-size: 10px; padding: 2px 8px; background: #9b59b6; color: #fff; border-radius: 8px; margin-bottom: 6px; display: inline-block; }
        .strategy-card { background: linear-gradient(135deg, #fff, #fff8f0); border: 2px solid #e67e22; }
        .strategy-badge { font-size: 10px; padding: 2px 8px; background: #e67e22; color: #fff; border-radius: 8px; margin-bottom: 6px; display: inline-block; }

        /* ===== Modals ===== */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: none; overflow-y: auto; padding: 15px 10px; }
        .modal-overlay.active { display: block; }
        .modal-content { max-width: 900px; margin: 0 auto; background: #fff; border-radius: 18px; overflow: hidden; animation: modalIn 0.2s ease; }
        @keyframes modalIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .modal-header { padding: 16px; background: #fafaf8; border-bottom: 1px solid #e5e3dc; display: flex; justify-content: space-between; align-items: flex-start; }
        .modal-header-info { flex: 1; }
        .modal-title { font-size: 18px; font-weight: 700; margin-bottom: 3px; }
        .modal-subtitle { font-size: 13px; color: #6b6b6b; }
        .modal-close { width: 32px; height: 32px; border: none; background: #eceae3; border-radius: 50%; font-size: 18px; cursor: pointer; margin-left: 10px; }
        .modal-body { padding: 16px; max-height: 70vh; overflow-y: auto; }
        .modal-section { margin-bottom: 18px; }
        .section-title { font-size: 13px; font-weight: 600; color: #c96442; margin-bottom: 10px; padding-bottom: 6px; border-bottom: 1px solid #eceae3; }
        .content-block { background: #fafaf8; border-radius: 10px; padding: 12px; font-size: 13px; line-height: 1.8; white-space: pre-wrap; }
        .tags-block { display: flex; flex-wrap: wrap; gap: 5px; }
        .modal-tag { font-size: 12px; padding: 4px 10px; background: #fff3e6; color: #c96442; border-radius: 12px; cursor: pointer; }
        
        /* Modal Tabs */
        .tab-buttons { display: flex; gap: 4px; margin-bottom: 12px; flex-wrap: wrap; border-bottom: 1px solid #eceae3; padding-bottom: 8px; }
        .tab-btn { padding: 8px 14px; background: #eceae3; border: none; border-radius: 8px 8px 0 0; font-size: 12px; cursor: pointer; font-weight: 500; }
        .tab-btn.active { background: #c96442; color: #fff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Rich Content & Tables */
        .info-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
        .info-item { background: #fafaf8; padding: 10px; border-radius: 8px; }
        .info-label { font-size: 13px; color: #8b8b8b; margin-bottom: 3px; }
        .info-value { font-size: 13px; font-weight: 600; }
        .info-value.large { font-size: 16px; }
        .product-item { background: #fafaf8; padding: 12px; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid #c96442; }
        .product-name { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .product-ratio { font-size: 14px; color: #5a9e6f; line-height: 1.5; }
        .timeline-item { padding: 10px; background: #fafaf8; border-radius: 8px; margin-bottom: 8px; border-left: 3px solid #c96442; cursor: pointer; }
        .timeline-date { font-size: 13px; color: #c96442; font-weight: 600; }
        .quarter-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .quarter-card { background: #fafaf8; border-radius: 10px; padding: 12px; border-top: 3px solid #c96442; }
        .quarter-title { font-size: 16px; font-weight: 700; color: #c96442; margin-bottom: 8px; }
        .quarter-factors { font-size: 11px; line-height: 1.6; }
        .factor-positive { color: #2e7d46; }
        .factor-negative { color: #d64545; }
        .stock-pick-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .stock-pick-table th { background: #fafaf8; padding: 8px; text-align: left; border-bottom: 2px solid #e5e3dc; font-weight: 600; }
        .stock-pick-table td { padding: 8px; border-bottom: 1px solid #f0eeea; }
        .stock-pick-table tr:hover td { background: #fafaf8; }
        .pick-badge { display: inline-block; width: 18px; height: 18px; background: #c96442; color: #fff; border-radius: 50%; text-align: center; line-height: 18px; font-size: 10px; }
        .finance-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
        .finance-card { background: #f8fafc; border-radius: 12px; padding: 20px; border: 1px solid #e2e8f0; }
        .finance-card h4 { margin: 0 0 15px 0; color: #1e293b; font-size: 1rem; border-bottom: 2px solid #3b82f6; padding-bottom: 8px; }
        .finance-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e2e8f0; }
        .related-item { padding: 10px; background: #fafaf8; border-radius: 8px; margin-bottom: 8px; cursor: pointer; border: 1px solid transparent; }
        .related-title { font-size: 13px; font-weight: 600; margin-bottom: 4px; }
        .empty-state { text-align: center; padding: 50px 20px; color: #8b8b8b; }
        .error-box { background: #fff3f3; border: 1px solid #d64545; border-radius: 12px; padding: 20px; margin: 20px; text-align: center; }
        
        @media (max-width: 600px) { .header h1 { font-size: 18px; } .db-tab { padding: 6px 10px; font-size: 11px; } .filter-row { flex-direction: column; } .filter-select { min-width: 100%; } .info-grid { grid-template-columns: 1fr 1fr; } .tab-btn { padding: 6px 10px; font-size: 11px; } }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="splash-content">
            <div class="splash-icon">ğŸ“Š</div>
            <h2 class="splash-title" id="loadingMain">ç³»çµ±å•Ÿå‹•ä¸­...</h2>
            <p class="splash-subtitle" id="loadingSub">æ­£åœ¨åˆå§‹åŒ– Rexå¤§å”æŠ•è³‡è³‡æ–™åº«</p>
            <div class="splash-progress-track">
                <div class="splash-progress-bar" id="loadingProgressBar"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Rexå¤§å”æŠ•è³‡ç ”ç©¶å®¤</h1>
            <p class="subtitle">åˆ¸å•†ç ”ç©¶å ±å‘Š Ã— å¤–é›»å¿«å ± Ã— Call Memo Ã— æŠ•è³‡ç­–ç•¥</p>
        </div>
        <div class="db-switcher">
            <button class="db-tab active" data-db="news" onclick="switchDB('news')">âš¡ å¤–é›»å ±å° <span class="count" id="newsCount">0</span></button>
            <button class="db-tab" data-db="memo" onclick="switchDB('memo')">ğŸ“‹ å ±å‘ŠMemo <span class="count" id="memoCount">0</span></button>
            <button class="db-tab" data-db="reports" onclick="switchDB('reports')">ğŸ“‘ ç”¢æ¥­å ±å‘Š <span class="count" id="reportsCount">0</span></button>
            <button class="db-tab" data-db="strategy" onclick="switchDB('strategy')">ğŸ¯ æŠ•è³‡å±•æœ› <span class="count" id="strategyCount">0</span></button>
            <button class="db-tab" data-db="trends" onclick="switchDB('trends')">ğŸ“ˆ ç”¢æ¥­è¶¨å‹¢ <span class="count" id="trendsCount">0</span></button>
            <button class="db-tab" data-db="industry" onclick="switchDB('industry')">ğŸ­ ç”¢æ¥­å‹•æ…‹ <span class="count" id="industryCount">0</span></button>
            <button class="db-tab" data-db="stocks" onclick="switchDB('stocks')">ğŸ¢ å€‹è‚¡æŸ¥è©¢ <span class="count" id="stocksCount">0</span></button>
            <button class="db-tab" data-db="cb" onclick="switchDB('cb')">ğŸ« CBçµ±è¨ˆ <span class="count" id="cbCount">0</span></button>
        </div>
        <div class="search-section">
            <div class="main-search">
                <input type="text" id="mainSearchInput" placeholder="æœå°‹å…¬å¸åç¨±ã€è‚¡è™Ÿã€æ¨™ç±¤ã€åˆ¸å•†...">
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>
            <div class="hot-tags">
                <div class="hot-tags-title">ğŸ”¥ ç†±é–€é—œéµå­—</div>
                <div class="hot-tags-list" id="hotTagsList"></div>
            </div>
            <div class="filter-row">
                <div class="filter-select"><select id="brokerFilter"><option value="">æ‰€æœ‰åˆ¸å•†</option></select></div>
                <div class="filter-select" id="categoryFilterWrap"><select id="categoryFilter"><option value="">æ‰€æœ‰åˆ†é¡</option></select></div>
                <div class="filter-select" id="importanceFilterWrap"><select id="importanceFilter"><option value="">æ‰€æœ‰é‡è¦æ€§</option><option value="â­â­â­â­â­">â­â­â­â­â­</option><option value="â­â­â­â­">â­â­â­â­</option><option value="â­â­â­">â­â­â­</option></select></div>
                <div class="filter-select" id="industryFilterWrap" style="display:none;"><select id="industryFilter"><option value="">æ‰€æœ‰ç”¢æ¥­</option></select></div>
                <div class="filter-select" id="marketFilterWrap" style="display:none;"><select id="marketFilter"><option value="">æ‰€æœ‰å¸‚å ´</option></select></div>
                <button class="clear-all-btn" onclick="clearAllFilters()">æ¸…é™¤ç¯©é¸</button>
            </div>
            <div class="active-filters" id="activeFilters"></div>
        </div>
        <div class="stats-bar">
            <span>æ‰¾åˆ° <strong id="filteredCount">0</strong> ç­†çµæœ</span>
            <div class="sort-options">
                <button class="sort-btn active" data-sort="date" onclick="setSort('date')">æœ€æ–°</button>
                <button class="sort-btn" data-sort="importance" onclick="setSort('importance')">é‡è¦æ€§</button>
            </div>
        </div>
        <div class="reports-list" id="reportsList"></div>
    </div>
    
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-header-info" id="modalHeaderInfo"></div>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <script>
    // ===== æª”æ¡ˆè·¯å¾‘ =====
    const NEWS_FILE = '01_news.xlsx';
    const MEMO_FILE = '02_memo.xlsx';
    const REPORTS_FILE = '03_reports.xlsx';
    const MASTER_FILE = '04_master.xlsx';
    const STRATEGY_FILE = '05_Strategy.xlsx'; // ç¢ºä¿æª”æ¡ˆåç¨±å¤§å°å¯«æ­£ç¢º
    const CB_FILE = '00_CB.xlsx';
    const REVENUE_FILE = '06_revenue.xlsx';

    // ===== å…¨åŸŸè³‡æ–™è®Šæ•¸ =====
    let newsData = [], newsContent = {}, trendsData = [];
    let cbData = {}, cbIndustry = {}, cbList = [], cbPriceRange = {}; 
    let revenueData = {}; 
    let memoReports = [], memoTracking = {}, memoFinance = {}, memoProducts = {}, memoTimeline = [], memoIndustryTrends = [], memoDetails = {};
    let reportsData = [], reportDetails = {}, reportStocksData = {};
    let masterStocks = {}, conceptStocks = [];
    let strategyReports = [], strategyThemes = {}, strategyQuarters = {}, strategyPicks = {};
    let currentDB = 'news', currentSort = 'date';
    let activeFilters = { search: '', broker: '', category: '', importance: '', industry: '', tag: '', market: '' };
    let searchIndex = { companies: {}, tags: {}, brokers: {}, stocks: {}, industries: {} };

    // ===== å·¥å…·å‡½æ•¸ =====
    async function fetchFile(url) {
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`æª”æ¡ˆ ${url} è¼‰å…¥å¤±æ•— (Status: ${response.status})`);
            return await response.arrayBuffer();
        } catch (e) { console.error(e); throw e; }
    }

    function updateLoadingStatus(mainText, subText, progress) {
        if(mainText) document.getElementById('loadingMain').textContent = mainText;
        if(subText) document.getElementById('loadingSub').textContent = subText;
        if(progress !== undefined) document.getElementById('loadingProgressBar').style.width = progress + '%';
    }

    function formatDate(v) {
        if (!v) return '';
        if (typeof v === 'string') return v;
        if (typeof v === 'number') {
            const d = new Date((v - 25569) * 86400 * 1000);
            return d.toLocaleDateString('zh-TW');
        }
        return String(v);
    }

    function safeStr(v) { return (v === null || v === undefined) ? '' : String(v).trim(); }

    function formatContent(text, forceSimple = false) {
        if (!text) return '';
        if (forceSimple) return text.replace(/;/g, 'ï¼›').replace(/â€¢/g, '<br>â€¢ ');
        const segments = text.split(';').filter(s => s.trim());
        if (segments.length <= 1) return text.replace(/â€¢/g, '<br>â€¢ ');
        let html = '';
        segments.forEach(seg => {
            seg = seg.trim();
            if (!seg) return;
            const colonMatch = seg.match(/^([^:ï¼š]{2,20})[:ï¼š](.+)$/);
            if (colonMatch) {
                const title = colonMatch[1].trim();
                const body = colonMatch[2].trim();
                let icon = 'ğŸ“Œ', color = '#c96442';
                if (title.includes('å±•æœ›') || title.includes('é æœŸ')) { icon = 'ğŸ”®'; color = '#9b59b6'; }
                else if (title.includes('é¢¨éšª') || title.includes('æŒ‘æˆ°')) { icon = 'âš ï¸'; color = '#e74c3c'; }
                else if (title.includes('æˆé•·') || title.includes('ç‡Ÿæ”¶')) { icon = 'ğŸ“ˆ'; color = '#27ae60'; }
                else if (title.includes('ç”¢å“') || title.includes('çµ„åˆ')) { icon = 'ğŸ“¦'; color = '#3498db'; }
                html += `<div style="margin-bottom:12px;padding:12px 14px;background:linear-gradient(135deg,#fff,#fafaf8);border-radius:10px;border-left:4px solid ${color};box-shadow:0 1px 3px rgba(0,0,0,0.05);"><div style="font-weight:600;color:${color};margin-bottom:8px;font-size:16px;">${icon} ${title}</div><div style="font-size:15px;line-height:1.8;color:#444;">${body}</div></div>`;
            } else {
                html += `<div style="margin-bottom:10px;padding:10px 12px;background:#fafaf8;border-radius:8px;font-size:15px;line-height:1.8;color:#444;">${seg}</div>`;
            }
        });
        return html;
    }

    function parseTags(tagStr) {
        if (!tagStr) return [];
        return tagStr.split('#').filter(t => t.trim()).map(t => t.trim());
    }

    function excelDateToStr(val) {
        if (!val) return '';
        if (!isNaN(val) && typeof val === 'number') {
            const utc_days = Math.floor(val - 25569);
            const date = new Date(utc_days * 86400 * 1000);
            return `${date.getFullYear()}/${String(date.getMonth() + 1).padStart(2,'0')}/${String(date.getDate()).padStart(2,'0')}`;
        }
        const str = String(val);
        const match = str.match(/(\d{4})-(\d{2})-(\d{2})/);
        if (match) return `${match[1]}/${match[2]}/${match[3]}`;
        return str;
    }

    // ===== è¼‰å…¥é‚è¼¯ (ä¿®å¾©é‡é»ï¼šæ‹†åˆ†å›ç¨ç«‹å‡½æ•¸) =====
    async function loadCBData() {
        try {
            const data = await fetchFile(CB_FILE);
            const wb = XLSX.read(data, { type: 'array' });
            
            const ws16 = wb.Sheets['16_ç”¢æ¥­åˆ†é¡'];
            if (ws16) {
                XLSX.utils.sheet_to_json(ws16).forEach(r => {
                    if (!r['è‚¡ç¥¨ä»£è™Ÿ']) return;
                    cbIndustry[String(r['è‚¡ç¥¨ä»£è™Ÿ'])] = { industry: r['ç”¢æ¥­åˆ†é¡'] || 'å…¶ä»–', name: r['å…¬å¸åç¨±'] };
                });
            }
            
            const ws08 = wb.Sheets['08_æœ€æ–°å‹•æ…‹æ¯é€±åŸºæœ¬è³‡æ–™'];
            if (ws08) {
                XLSX.utils.sheet_to_json(ws08).forEach(r => {
                    if (!r['è½‰æ›æ¨™çš„ä»£ç¢¼']) return;
                    const stockCode = String(r['è½‰æ›æ¨™çš„ä»£ç¢¼']).trim();
                    const issue = parseFloat(r['å¯¦éš›ç™¼è¡Œç¸½é¡(ç™¾è¬)']) || 0;
                    const remain = parseFloat(r['æœ€æ–°é¤˜é¡(ç™¾è¬)']) || 0;
                    
                    const cbInfo = {
                        cbCode: String(r['ä»£è™Ÿ']),
                        cbName: String(r['åç¨±']),
                        stockCode: stockCode,
                        stockName: String(r['è½‰æ›æ¨™çš„åç¨±']),
                        conversionPrice: parseFloat(r['è½‰æ›åƒ¹æ ¼(å…ƒ)']) || 0,
                        maturityDate: excelDateToStr(r['åˆ°æœŸæ—¥']),
                        remainAmount: remain,
                        remainPct: issue > 0 ? ((remain/issue)*100).toFixed(1) : '0',
                        industry: cbIndustry[stockCode]?.industry || 'å…¶ä»–'
                    };
                    
                    if (!cbData[stockCode]) cbData[stockCode] = [];
                    cbData[stockCode].push(cbInfo);
                    cbList.push(cbInfo);
                });
            }
        } catch(e) { console.warn('CBè¼‰å…¥å¤±æ•—', e); }
    }

    async function loadNewsData() {
        try {
            const data = await fetchFile(NEWS_FILE);
            const wb = XLSX.read(data, { type: 'array' });
            const wsNews = wb.Sheets['å¤–é›»ç¶œåˆå ±å°'];
            if (wsNews) {
                XLSX.utils.sheet_to_json(wsNews).forEach(r => {
                    if (!r['ç·¨è™Ÿ']) return;
                    if (safeStr(r['è³‡æ–™é¡å‹']) === 'å€‹è‚¡å ±å°') {
                        newsData.push({ id: safeStr(r['ç·¨è™Ÿ']), date: safeStr(r['æ—¥æœŸ']), company: safeStr(r['å…¬å¸']), stockCode: safeStr(r['è‚¡è™Ÿ']), broker: safeStr(r['åˆ¸å•†ä¾†æº']), category: safeStr(r['å ±å°é‡é»åˆ†é¡']), importance: safeStr(r['é‡è¦æ€§']), tags: safeStr(r['æ¨™ç±¤']) });
                        newsContent[safeStr(r['ç·¨è™Ÿ'])] = safeStr(r['å®Œæ•´å ±å°å…§å®¹']);
                    } else if (safeStr(r['è³‡æ–™é¡å‹']) === 'ç”¢æ¥­è¶¨å‹¢') {
                        trendsData.push({ id: safeStr(r['ç·¨è™Ÿ']), date: safeStr(r['æ—¥æœŸ']), topic: safeStr(r['å…¬å¸']), broker: safeStr(r['åˆ¸å•†ä¾†æº']), content: safeStr(r['å®Œæ•´å ±å°å…§å®¹']), companies: safeStr(r['è‚¡è™Ÿ']), tags: safeStr(r['æ¨™ç±¤']) });
                    }
                });
            }
        } catch(e) { console.warn('Newsè¼‰å…¥å¤±æ•—', e); throw e; }
    }

    async function loadMemoData() {
        try {
            const data = await fetchFile(MEMO_FILE);
            const wb = XLSX.read(data, { type: 'array' });
            
            const s1 = wb.Sheets['å ±å‘Šç¸½è¡¨'];
            if(s1) XLSX.utils.sheet_to_json(s1).forEach(r => { if(r['ç·¨è™Ÿ']) memoReports.push({ id: safeStr(r['ç·¨è™Ÿ']), date: safeStr(r['æ—¥æœŸ']), company: safeStr(r['å…¬å¸']), stockCode: safeStr(r['è‚¡è™Ÿ']), broker: safeStr(r['åˆ¸å•†']), type: safeStr(r['å ±å‘Šé¡å‹']), importance: safeStr(r['é‡è¦æ€§']), industry: safeStr(r['ç”¢æ¥­']), revenueYoY: safeStr(r['ç‡Ÿæ”¶YoY']), grossMargin: safeStr(r['æ¯›åˆ©ç‡']), eps: safeStr(r['EPS']) }); });
            
            const s2 = wb.Sheets['è©³ç´°å…§å®¹åº«'];
            if(s2) XLSX.utils.sheet_to_json(s2).forEach(r => { if(r['ç·¨è™Ÿ']) memoDetails[safeStr(r['ç·¨è™Ÿ'])] = { operation: safeStr(r['ç‡Ÿé‹é‡é»']), strategy: safeStr(r['ç­–ç•¥æ–¹å‘']), qa: safeStr(r['é‡è¦QAæ‘˜è¦']), rexView: safeStr(r['Rexè§€å¯Ÿ']), followUp: safeStr(r['å¾ŒçºŒè¿½è¹¤']), tags: safeStr(r['æ¨™ç±¤']) }; });
            
            const s3 = wb.Sheets['å…¬å¸è¿½è¹¤è¡¨'];
            if(s3) XLSX.utils.sheet_to_json(s3).forEach(r => { if(r['ç·¨è™Ÿ']) memoTracking[safeStr(r['å…¬å¸'])] = { rating: safeStr(r['æŠ•è³‡è©•ç­‰']), targetPrice: safeStr(r['ç›®æ¨™åƒ¹']), trackStatus: safeStr(r['è¿½è¹¤ç‹€æ…‹']) }; });
            
            const s4 = wb.Sheets['è²¡å‹™æ•¸æ“šå½™ç¸½'];
            if(s4) XLSX.utils.sheet_to_json(s4).forEach(r => { if(r['å…¬å¸']) memoFinance[safeStr(r['å…¬å¸'])] = { revenue3Q: safeStr(r['3Q25ç‡Ÿæ”¶']), revenueYoY: safeStr(r['ç‡Ÿæ”¶YoY']), grossMargin: safeStr(r['æ¯›åˆ©ç‡']), eps: safeStr(r['EPS']), guidance4Q: safeStr(r['4Q25æŒ‡å¼•']) }; });
            
            const s5 = wb.Sheets['ç”¢å“çµæ§‹åˆ†æ'];
            if(s5) XLSX.utils.sheet_to_json(s5).forEach(r => { if(r['å…¬å¸']) memoProducts[safeStr(r['å…¬å¸'])] = { products: [{name:safeStr(r['ä¸»è¦ç”¢å“1']),ratio:safeStr(r['ä½”æ¯”/è¡¨ç¾1'])},{name:safeStr(r['ä¸»è¦ç”¢å“2']),ratio:safeStr(r['ä½”æ¯”/è¡¨ç¾2'])}].filter(p=>p.name), driver: safeStr(r['é—œéµæˆé•·å‹•èƒ½']), outlook2026: safeStr(r['2026å±•æœ›']) }; });
            
            const s5_time = wb.Sheets['é—œéµæ™‚ç¨‹è¿½è¹¤'];
            if(s5_time) XLSX.utils.sheet_to_json(s5_time).forEach(r => { if(r['å…¬å¸']) memoTimeline.push({ time: safeStr(r['æ™‚é–“']), company: safeStr(r['å…¬å¸']), stockCode: safeStr(r['è‚¡è™Ÿ']), event: safeStr(r['äº‹ä»¶']), type: safeStr(r['é¡å‹']), impact: safeStr(r['é æœŸå½±éŸ¿']), status: safeStr(r['è¿½è¹¤ç‹€æ…‹']) }); });
            
            const s6 = wb.Sheets['ç”¢æ¥­è¶¨å‹¢ç¸½è¦½'];
            if(s6) XLSX.utils.sheet_to_json(s6).forEach(r => { if(r['ç”¢æ¥­']) memoIndustryTrends.push({ industry: safeStr(r['ç”¢æ¥­']), trend: safeStr(r['è¶¨å‹¢åˆ¤æ–·']), companies: safeStr(r['ä»£è¡¨å…¬å¸']), stockCodes: safeStr(r['è‚¡è™Ÿ']), driver: safeStr(r['é—œéµé©…å‹•å› ç´ ']), risk: safeStr(r['é¢¨éšªå› ç´ ']), outlook: safeStr(r['2026å±•æœ›']), suggestion: safeStr(r['æŠ•è³‡å»ºè­°']) }); });
        } catch(e) { console.warn('Memoè¼‰å…¥å¤±æ•—', e); }
    }

    async function loadReportsData() {
        try {
            const data = await fetchFile(REPORTS_FILE);
            const wb = XLSX.read(data, { type: 'array' });
            
            const s1 = wb.Sheets['å ±å‘Šç¸½è¦½'];
            if(s1) XLSX.utils.sheet_to_json(s1).forEach(r => { if(r['å ±å‘Šç·¨è™Ÿ']) reportsData.push({ id: safeStr(r['å ±å‘Šç·¨è™Ÿ']), broker: safeStr(r['åˆ¸å•†åç¨±']), date: formatDate(r['å ±å‘Šæ—¥æœŸ']), industry: safeStr(r['ç”¢æ¥­åç¨±']), title: safeStr(r['å ±å‘Šæ¨™é¡Œ']), highlights: [safeStr(r['æ ¸å¿ƒé‡é»1']), safeStr(r['æ ¸å¿ƒé‡é»2'])] }); });
            
            const s2 = wb.Sheets['ç„¦é»åˆ†æå…§å®¹'];
            if(s2) XLSX.utils.sheet_to_json(s2).forEach(r => { if(r['å ±å‘Šç·¨è™Ÿ']) { const id=safeStr(r['å ±å‘Šç·¨è™Ÿ']); if(!reportDetails[id]) reportDetails[id]=[]; reportDetails[id].push({ sectionTitle: safeStr(r['æ®µè½æ¨™é¡Œ']), content: safeStr(r['æ®µè½å…§å®¹']), marketSize: safeStr(r['å¸‚å ´è¦æ¨¡æ•¸æ“š']) }); }});
            
            const s4 = wb.Sheets['é¦–é¸å€‹è‚¡è©•åƒ¹'];
            if(s4) XLSX.utils.sheet_to_json(s4).forEach(r => { if(r['å ±å‘Šç·¨è™Ÿ']) { const id=safeStr(r['å ±å‘Šç·¨è™Ÿ']); if(!reportStocksData[id]) reportStocksData[id]=[]; reportStocksData[id].push({ name: safeStr(r['å…¬å¸åç¨±']), code: safeStr(r['è‚¡ç¥¨ä»£è™Ÿ']), rating: safeStr(r['è©•ç­‰']), target: r['ç›®æ¨™åƒ¹'], eps25: r['EPS_FY25F'], highlight: safeStr(r['æŠ•è³‡äº®é»']) }); }});
        } catch(e) { console.warn('Reportsè¼‰å…¥å¤±æ•—', e); }
    }

    async function loadStrategyData() {
        try {
            const data = await fetchFile(STRATEGY_FILE);
            const wb = XLSX.read(data, { type: 'array' });
            
            const s1 = wb.Sheets['å ±å‘Šç¸½è¦½'];
            if(s1) XLSX.utils.sheet_to_json(s1).forEach(r => { if(r['å ±å‘Šç·¨è™Ÿ']) strategyReports.push({ id: safeStr(r['å ±å‘Šç·¨è™Ÿ']), broker: safeStr(r['åˆ¸å•†åç¨±']), date: formatDate(r['å ±å‘Šæ—¥æœŸ']), type: safeStr(r['å ±å‘Šé¡å‹']), title: safeStr(r['å ±å‘Šæ¨™é¡Œ']), indexLow: r['æŒ‡æ•¸é æ¸¬å€é–“_ä½'], indexHigh: r['æŒ‡æ•¸é æ¸¬å€é–“_é«˜'], macroSummary: safeStr(r['ç¸½ç¶“è§€é»æ‘˜è¦']) }); });
            
            const s4 = wb.Sheets['é¡Œæèˆ‡è¶¨å‹¢'];
            if(s4) XLSX.utils.sheet_to_json(s4).forEach(r => { if(r['å ±å‘Šç·¨è™Ÿ']) { const id=safeStr(r['å ±å‘Šç·¨è™Ÿ']); if(!strategyThemes[id]) strategyThemes[id]=[]; strategyThemes[id].push({ topic: safeStr(r['é¡Œæä¸»é¡Œ']), content: safeStr(r['é¡Œæå…§å®¹']), data: safeStr(r['ç›¸é—œæ•¸æ“š']), value: safeStr(r['æ•¸æ“šå€¼']) }); }});
            
            const s7 = wb.Sheets['å­£åº¦è¡Œæƒ…è¦åŠƒ'];
            if(s7) XLSX.utils.sheet_to_json(s7).forEach(r => { if(r['å ±å‘Šç·¨è™Ÿ']) { const id=safeStr(r['å ±å‘Šç·¨è™Ÿ']); if(!strategyQuarters[id]) strategyQuarters[id]=[]; strategyQuarters[id].push({ quarter: safeStr(r['å­£åº¦']), indexLow: r['æŒ‡æ•¸é æ¸¬_ä½'], indexHigh: r['æŒ‡æ•¸é æ¸¬_é«˜'], positives: [safeStr(r['åˆ©å¤šå› ç´ 1'])].filter(Boolean), negatives: [safeStr(r['åˆ©ç©ºå› ç´ 1'])].filter(Boolean) }); }});
            
            const s8 = wb.Sheets['é¸è‚¡ç­–ç•¥'];
            if(s8) XLSX.utils.sheet_to_json(s8).forEach(r => { if(r['å ±å‘Šç·¨è™Ÿ']) { const id=safeStr(r['å ±å‘Šç·¨è™Ÿ']); if(!strategyPicks[id]) strategyPicks[id]=[]; strategyPicks[id].push({ industry: safeStr(r['ç”¢æ¥­åˆ†é¡']), theme: safeStr(r['æŠ•è³‡é¡Œæ']), stockCode: safeStr(r['è‚¡ç¥¨ä»£è™Ÿ']), stockName: safeStr(r['å…¬å¸åç¨±']), q1: safeStr(r['26Q1']), q2: safeStr(r['26Q2']) }); }});
        } catch(e) { console.warn('Strategyè¼‰å…¥å¤±æ•—', e); }
    }

    async function loadMasterData() {
        try {
            const data = await fetchFile(MASTER_FILE);
            const wb = XLSX.read(data, { type: 'array' });
            const s1 = wb.Sheets['ä¸»è³‡æ–™åº«'];
            if(s1) XLSX.utils.sheet_to_json(s1).forEach(r => { if(r['ä»£è™Ÿ']) { const d = { code: safeStr(r['ä»£è™Ÿ']), name: safeStr(r['å…¬å¸åç¨±']), market: safeStr(r['å¸‚å ´åˆ†é¡']), industry: safeStr(r['ç”¢æ¥­åˆ†é¡']), price: safeStr(r['æˆäº¤']), change: safeStr(r['æ¼²è·Œåƒ¹']), changePercent: safeStr(r['æ¼²è·Œå¹…']), marketCap: safeStr(r['å¸‚å€¼(å„„)']), business: safeStr(r['æ¥­å‹™æ‘˜è¦']), listedYears: safeStr(r['æ›ç‰Œå¹´æ•¸']), capital: safeStr(r['è‚¡æœ¬(å„„)']) }; masterStocks[d.code] = d; masterStocks[d.name] = d; } });
        } catch(e) { console.warn('Masterè¼‰å…¥å¤±æ•—', e); }
    }

    async function loadRevenueData() {
        try {
            const data = await fetchFile(REVENUE_FILE);
            const wb = XLSX.read(data, { type: 'array' });
            const wsMonth = wb.Sheets['000_æœˆç‡Ÿæ”¶'];
            if(wsMonth) {
                const rows = XLSX.utils.sheet_to_json(wsMonth);
                const headers = Object.keys(rows[0]||{});
                const monthCols = headers.filter(h=>h.includes('å–®æœˆç‡Ÿæ”¶'));
                rows.forEach(r => { if(r['ä»£è™Ÿ']) { const c=String(r['ä»£è™Ÿ']).trim(); revenueData[c] = { monthly: monthCols.slice(-12).map(col => ({ period: col.replace('å–®æœˆç‡Ÿæ”¶(å„„)',''), value: r[col]||'' })) }; } });
            }
        } catch(e) { console.warn('Revenueè¼‰å…¥å¤±æ•—', e); }
    }

    // ===== ä¸»ç¨‹å¼å•Ÿå‹• =====
    window.onload = async function() {
        const overlay = document.getElementById('loadingOverlay');
        try {
            updateLoadingStatus('è®€å–å¤–é›»å¿«å ±...', 'æ­£åœ¨åŒæ­¥åœ‹éš›é‡‘èè³‡è¨Š', 10);
            await loadNewsData();
            
            updateLoadingStatus('è§£æç ”ç©¶å ±å‘Š...', 'æ­£åœ¨å½™æ•´åˆ¸å•† Memo èˆ‡ç”¢æ¥­è¶¨å‹¢', 30);
            await loadMemoData();
            await loadReportsData();
            
            updateLoadingStatus('è¼‰å…¥å€‹è‚¡è³‡æ–™...', 'æ­£åœ¨å»ºç«‹å°è‚¡ä¸»è³‡æ–™åº«ç´¢å¼•', 55);
            await loadMasterData();
            await loadStrategyData();
            
            updateLoadingStatus('è§£æè²¡å‹™ç‡Ÿæ”¶...', 'æ­£åœ¨æ•´åˆè²¡å‹™èˆ‡ CB è³‡æ–™åº«', 80);
            await loadCBData();
            await loadRevenueData();
            
            updateLoadingStatus('å³å°‡å®Œæˆ...', 'æ­£åœ¨å»ºæ§‹æ™ºæ…§æœå°‹å¼•æ“', 95);
            buildSearchIndex();
            buildFilters();
            buildHotTags();
            updateCounts();
            
            updateLoadingStatus('è¼‰å…¥å®Œæˆ', 'æ­¡è¿ä¾†åˆ° Rexå¤§å”æŠ•è³‡ç ”ç©¶å®¤', 100);
            setTimeout(() => { renderCurrentDB(); overlay.classList.add('hidden'); }, 500);

            document.getElementById('mainSearchInput').addEventListener('input', onSearchInput);
            document.getElementById('mainSearchInput').addEventListener('focus', () => showSuggestions());
            document.addEventListener('click', e => { if (!e.target.closest('.main-search')) hideSuggestions(); });
        } catch (e) {
            console.error(e);
            document.querySelector('.splash-icon').textContent = 'âš ï¸';
            updateLoadingStatus('è¼‰å…¥å¤±æ•—', e.message, 0);
            document.querySelector('.splash-progress-bar').style.background = '#d64545';
            const errorDiv = document.createElement('div');
            errorDiv.innerHTML = `<button onclick="location.reload()" style="margin-top:20px;padding:8px 20px;background:#d64545;color:white;border:none;border-radius:20px;cursor:pointer;">é‡æ–°å˜—è©¦</button>`;
            document.querySelector('.splash-content').appendChild(errorDiv);
        }
    };

    function buildSearchIndex() {
        searchIndex = { companies: {}, tags: {}, brokers: {}, stocks: {}, industries: {} };
        Object.values(masterStocks).forEach(s => { if (s.code && !searchIndex.stocks[s.code]) searchIndex.stocks[s.code] = s; });
        newsData.forEach(item => {
            if (item.company) {
                if (!searchIndex.companies[item.company]) searchIndex.companies[item.company] = { count: 0, code: item.stockCode };
                searchIndex.companies[item.company].count++;
            }
            parseTags(item.tags).forEach(tag => { if (!searchIndex.tags[tag]) searchIndex.tags[tag]=0; searchIndex.tags[tag]++; });
        });
    }

    function buildFilters() {
        const brokers = [...new Set([...newsData.map(n => n.broker), ...memoReports.map(m => m.broker)])].filter(Boolean).sort();
        document.getElementById('brokerFilter').innerHTML = '<option value="">æ‰€æœ‰åˆ¸å•†</option>' + brokers.map(b => `<option value="${b}">${b}</option>`).join('');
        const categories = [...new Set(newsData.map(n => n.category))].filter(Boolean).sort();
        document.getElementById('categoryFilter').innerHTML = '<option value="">æ‰€æœ‰åˆ†é¡</option>' + categories.map(c => `<option value="${c}">${c}</option>`).join('');
        const industries = [...new Set([...reportsData.map(r => r.industry), ...memoReports.map(m => m.industry)])].filter(Boolean).sort();
        document.getElementById('industryFilter').innerHTML = '<option value="">æ‰€æœ‰ç”¢æ¥­</option>' + industries.map(i => `<option value="${i}">${i}</option>`).join('');
    }

    function buildHotTags() {
        const topTags = Object.entries(searchIndex.tags).sort((a, b) => b[1] - a[1]).slice(0, 12);
        document.getElementById('hotTagsList').innerHTML = topTags.map(([tag]) => `<button class="hot-tag" onclick="searchByTag('${tag}')">#${tag}</button>`).join('');
    }

    function updateCounts() {
        document.getElementById('newsCount').textContent = newsData.length;
        document.getElementById('memoCount').textContent = memoReports.length;
        document.getElementById('reportsCount').textContent = reportsData.length;
        document.getElementById('strategyCount').textContent = strategyReports.length;
        document.getElementById('trendsCount').textContent = trendsData.length;
        document.getElementById('industryCount').textContent = memoIndustryTrends.length;
        document.getElementById('cbCount').textContent = cbList.length;
        document.getElementById('stocksCount').textContent = new Set(Object.values(masterStocks).map(s => s.code)).size;
    }

    function onSearchInput(e) {
        activeFilters.search = e.target.value.trim().toLowerCase();
        if (activeFilters.search) showSuggestions(activeFilters.search); else hideSuggestions();
        renderCurrentDB();
    }

    function showSuggestions(query = '') {
        const c = document.getElementById('searchSuggestions');
        if (!query) { c.classList.remove('active'); return; }
        const mS = Object.entries(searchIndex.stocks).filter(([cd, d]) => cd.includes(query) || d.name.toLowerCase().includes(query)).slice(0, 5);
        let html = '';
        if(mS.length > 0) html += `<div class="suggestion-group"><div class="suggestion-group-title">å€‹è‚¡</div>${mS.map(([cd, d]) => `<div class="suggestion-item" onclick="openStockModal('${cd}')"><div class="suggestion-icon stock">ğŸ“ˆ</div><div class="suggestion-text"><div class="suggestion-main">${d.name}</div><div class="suggestion-sub">${cd}</div></div></div>`).join('')}</div>`;
        if(html) { c.innerHTML = html; c.classList.add('active'); } else hideSuggestions();
    }
    function hideSuggestions() { document.getElementById('searchSuggestions').classList.remove('active'); }
    function searchByTag(tag) { document.getElementById('mainSearchInput').value = '#' + tag; activeFilters.search = ''; activeFilters.tag = tag; renderCurrentDB(); }

    function switchDB(db) {
        currentDB = db;
        document.querySelectorAll('.db-tab').forEach(tab => tab.classList.toggle('active', tab.dataset.db === db));
        document.getElementById('categoryFilterWrap').style.display = (db === 'news') ? 'block' : 'none';
        document.getElementById('industryFilterWrap').style.display = ['reports', 'memo', 'industry', 'stocks'].includes(db) ? 'block' : 'none';
        renderCurrentDB();
    }
    
    function clearAllFilters() { activeFilters = { search: '', broker: '', category: '', importance: '', industry: '', tag: '' }; document.getElementById('mainSearchInput').value = ''; renderCurrentDB(); }
    function setSort(sort) { currentSort = sort; renderCurrentDB(); }

    function renderCurrentDB() {
        const renderers = { news: renderNews, memo: renderMemo, reports: renderReports, strategy: renderStrategy, trends: renderTrends, industry: renderIndustry, stocks: renderStocks, cb: renderCB };
        if (renderers[currentDB]) renderers[currentDB]();
    }

    // ===== å®Œæ•´å‘ˆç¾é‚è¼¯ (Full Render Logic) =====
    function renderNews() {
        let filtered = newsData.filter(item => {
            if (activeFilters.search && ![item.company, item.stockCode, item.category].join(' ').toLowerCase().includes(activeFilters.search)) return false;
            return true;
        });
        filtered.sort((a, b) => String(b.date).localeCompare(String(a.date)));
        document.getElementById('reportsList').innerHTML = filtered.map(item => `
            <div class="card-base" onclick="openNewsModal('${item.id}')">
                <div class="card-header"><div class="card-left"><span class="company-name">${item.company}</span><span class="stock-code">${item.stockCode}</span></div><span class="importance">${item.importance}</span></div>
                <div class="card-meta"><span class="meta-tag broker">${item.broker}</span><span class="meta-tag date">${item.date}</span><span class="meta-tag category">${item.category}</span></div>
                <div class="card-content">${(newsContent[item.id]||'').replace(/â€¢/g, '').substring(0, 100)}...</div>
            </div>`).join('');
        document.getElementById('filteredCount').textContent = filtered.length;
    }

    function renderMemo() {
        let filtered = memoReports.filter(item => {
            if (activeFilters.search && ![item.company, item.stockCode, item.broker].join(' ').toLowerCase().includes(activeFilters.search)) return false;
            return true;
        });
        filtered.sort((a, b) => String(b.date).localeCompare(String(a.date)));
        document.getElementById('reportsList').innerHTML = filtered.map(item => {
            const detail = memoDetails[item.id] || {};
            const tracking = memoTracking[item.company] || {};
            return `<div class="card-base" onclick="openMemoModal('${item.id}')">
                <div class="card-header"><div class="card-left"><span class="company-name">${item.company}</span><span class="stock-code">${item.stockCode}</span></div><span class="importance">${item.importance}</span></div>
                <div class="card-meta"><span class="meta-tag broker">${item.broker}</span><span class="meta-tag industry">${item.industry}</span><span class="meta-tag date">${item.date}</span>${tracking.rating ? `<span class="meta-tag rating">${tracking.rating}</span>` : ''}</div>
                <div class="card-content">${(detail.operation || '').substring(0, 80)}...</div>
                <div class="card-data"><div class="data-item"><span class="data-label">ç‡Ÿæ”¶YoY </span><span class="data-value">${item.revenueYoY}</span></div><div class="data-item"><span class="data-label">EPS </span><span class="data-value">${item.eps}</span></div></div>
            </div>`;
        }).join('');
        document.getElementById('filteredCount').textContent = filtered.length;
    }

    function renderReports() {
        let filtered = reportsData.filter(r => {
             if (activeFilters.search && ![r.title, r.industry].join(' ').toLowerCase().includes(activeFilters.search)) return false;
             return true;
        });
        document.getElementById('reportsList').innerHTML = filtered.map(r => `
            <div class="card-base" onclick="openReportModal('${r.id}')">
                <div class="card-meta"><span class="meta-tag broker">${r.broker}</span><span class="meta-tag industry">${r.industry}</span><span class="meta-tag date">${r.date}</span></div>
                <div class="company-name" style="margin:8px 0;">${r.title}</div>
                <div class="card-content">${r.highlights.join(' / ').substring(0,100)}</div>
            </div>`).join('');
        document.getElementById('filteredCount').textContent = filtered.length;
    }

    function renderStrategy() {
        let filtered = strategyReports.filter(r => {
             if (activeFilters.search && ![r.title, r.type].join(' ').toLowerCase().includes(activeFilters.search)) return false;
             return true;
        });
        document.getElementById('reportsList').innerHTML = filtered.map(r => `
            <div class="card-base strategy-card" onclick="openStrategyModal('${r.id}')">
                <span class="strategy-badge">ğŸ¯ ${r.type}</span>
                <div class="card-meta"><span class="meta-tag broker">${r.broker}</span><span class="meta-tag date">${r.date}</span></div>
                <div class="company-name" style="margin:8px 0;">${r.title}</div>
                <div class="card-content">${r.macroSummary ? r.macroSummary.substring(0,100) : '...'}</div>
            </div>`).join('');
        document.getElementById('filteredCount').textContent = filtered.length;
    }

    function renderTrends() {
        document.getElementById('reportsList').innerHTML = trendsData.map(t => `
            <div class="card-base trend-card" onclick="openTrendModal('${t.id}')">
                <span class="trend-badge">ğŸ“ˆ ç”¢æ¥­è¶¨å‹¢</span>
                <div class="card-meta"><span class="meta-tag broker">${t.broker}</span><span class="meta-tag date">${t.date}</span></div>
                <div class="company-name" style="margin:8px 0;">${t.topic}</div>
                <div class="card-content">${t.content.substring(0,80)}...</div>
            </div>`).join('');
        document.getElementById('filteredCount').textContent = trendsData.length;
    }

    function renderIndustry() {
        document.getElementById('reportsList').innerHTML = memoIndustryTrends.map((i,idx) => `
            <div class="card-base industry-card" onclick="openIndustryModal(${idx})">
                <span class="industry-badge">${i.trend}</span>
                <div class="card-header"><span class="company-name">${i.industry}</span><span class="meta-tag trend">${i.position||''}</span></div>
                <div class="card-content">é©…å‹•ï¼š${i.driver}</div>
            </div>`).join('');
        document.getElementById('filteredCount').textContent = memoIndustryTrends.length;
    }

    function renderStocks() {
        const list = Object.values(masterStocks);
        let filtered = list.filter(s => {
             if (activeFilters.search && ![s.code, s.name].join(' ').toLowerCase().includes(activeFilters.search)) return false;
             return true;
        });
        document.getElementById('reportsList').innerHTML = filtered.slice(0,50).map(s => `
            <div class="card-base stock-card" onclick="openStockModal('${s.code}')">
                <span class="stock-badge">${s.market}</span>
                <div class="card-header"><div class="card-left"><span class="company-name">${s.name}</span><span class="stock-code">${s.code}</span></div><div style="text-align:right;"><div style="font-weight:700;">${s.price}</div><div style="font-size:12px;color:${String(s.changePercent).includes('-')?'#d64545':'#2e7d46'}">${s.changePercent}</div></div></div>
                <div class="card-meta"><span class="meta-tag industry">${s.industry}</span></div>
            </div>`).join('');
        document.getElementById('filteredCount').textContent = filtered.length;
    }

    function renderCB() {
        // CB çµ±è¨ˆå„€è¡¨æ¿
        const industryStats = {};
        cbList.forEach(cb => {
            const ind = cb.industry || 'å…¶ä»–';
            if (!industryStats[ind]) industryStats[ind] = { count: 0 };
            industryStats[ind].count++;
        });
        const sortedIndustries = Object.entries(industryStats).sort((a, b) => b[1].count - a[1].count);

        let filteredCBs = cbList.filter(cb => {
            if (activeFilters.search && ![cb.cbCode, cb.cbName, cb.stockName].join(' ').toLowerCase().includes(activeFilters.search)) return false;
            if (activeFilters.industry && cb.industry !== activeFilters.industry) return false;
            return true;
        });

        let html = `<div style="background:linear-gradient(135deg,#fff5f5,#fff0f0);border-radius:15px;padding:20px;margin-bottom:20px;border:1px solid #f5d5d5;">
            <h3 style="margin:0 0 15px 0;color:#c96442;font-size:18px;">ğŸ« å¯è½‰å‚µå¸‚å ´çµ±è¨ˆ</h3>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;">
                <div style="text-align:center;padding:15px;background:#fff;border-radius:10px;"><div style="font-size:28px;font-weight:700;color:#e74c3c;">${cbList.length}</div><div style="font-size:14px;color:#666;">æ›ç‰Œä¸­CBç¸½æ•¸</div></div>
                <div style="text-align:center;padding:15px;background:#fff;border-radius:10px;"><div style="font-size:28px;font-weight:700;color:#3498db;">${Object.keys(cbData).length}</div><div style="font-size:14px;color:#666;">ç™¼è¡Œå…¬å¸æ•¸</div></div>
            </div>
        </div>`;
        
        // ç”¢æ¥­åˆ†ä½ˆ Filter
        html += `<div style="background:#fff;border-radius:15px;padding:20px;margin-bottom:20px;"><h3 style="font-size:16px;">ğŸ“Š å„ç”¢æ¥­CBåˆ†ä½ˆ</h3><div style="display:flex;flex-wrap:wrap;gap:10px;">
            ${sortedIndustries.map(([ind, data]) => `<div onclick="activeFilters.industry='${ind}';renderCB();" style="cursor:pointer;padding:10px 15px;background:${activeFilters.industry===ind?'#e74c3c':'#f8f8f8'};color:${activeFilters.industry===ind?'#fff':'#333'};border-radius:10px;"><b>${ind}</b> (${data.count})</div>`).join('')}
            ${activeFilters.industry ? `<div onclick="activeFilters.industry='';renderCB();" style="cursor:pointer;padding:10px;border:1px solid #e74c3c;color:#e74c3c;border-radius:10px;">âœ• æ¸…é™¤</div>` : ''}
        </div></div>`;

        // CB Table
        html += `<div style="background:#fff;border-radius:15px;padding:20px;"><div style="overflow-x:auto;"><table style="width:100%;border-collapse:collapse;font-size:14px;">
            <thead><tr style="background:#f8f8f8;"><th style="padding:12px;">CBä»£è™Ÿ</th><th>CBç°¡ç¨±</th><th>æ¨™çš„</th><th>è½‰æ›åƒ¹</th><th>é¤˜é¡</th><th>åˆ°æœŸæ—¥</th></tr></thead>
            <tbody>${filteredCBs.slice(0,100).map(cb => `<tr style="border-bottom:1px solid #f0f0f0;" onclick="openStockModal('${cb.stockCode}')">
                <td style="padding:12px;color:#e74c3c;font-weight:bold;">${cb.cbCode}</td><td>${cb.cbName}</td><td>${cb.stockName}</td><td style="text-align:right;">${cb.conversionPrice}</td><td style="text-align:right;">${cb.remainAmount}</td><td style="text-align:center;">${cb.maturityDate}</td>
            </tr>`).join('')}</tbody></table></div></div>`;
        
        document.getElementById('reportsList').innerHTML = html;
        document.getElementById('filteredCount').textContent = filteredCBs.length;
    }

    // ===== Modals =====
    function openModal() { document.getElementById('modalOverlay').classList.add('active'); document.body.style.overflow = 'hidden'; }
    function closeModal(e) { if (!e || e.target === document.getElementById('modalOverlay') || e.target.classList.contains('modal-close')) { document.getElementById('modalOverlay').classList.remove('active'); document.body.style.overflow = ''; } }

    function openNewsModal(id) {
        const item = newsData.find(n => n.id == id);
        if (!item) return;
        document.getElementById('modalHeaderInfo').innerHTML = `<div class="modal-meta"><span class="meta-tag broker">${item.broker}</span><span class="meta-tag date">${item.date}</span></div><h2 class="modal-title">${item.company}</h2>`;
        document.getElementById('modalBody').innerHTML = `<div class="modal-section"><h3 class="section-title">å®Œæ•´å ±å°</h3><div class="content-block">${formatContent(newsContent[id]||'')}</div></div>`;
        openModal();
    }

    function openMemoModal(id) {
        const item = memoReports.find(m => m.id == id);
        if (!item) return;
        const detail = memoDetails[id] || {};
        const finance = memoFinance[item.company] || {};
        const products = memoProducts[item.company] || {};
        const tracking = memoTracking[item.company] || {};
        
        document.getElementById('modalHeaderInfo').innerHTML = `<div class="modal-meta"><span class="meta-tag broker">${item.broker}</span><span class="meta-tag industry">${item.industry}</span></div><h2 class="modal-title">${item.company} (${item.stockCode})</h2><p class="modal-subtitle">${item.type}</p>`;
        
        let html = `<div class="tab-buttons"><button class="tab-btn active" onclick="switchTab('overview')">ç¸½è¦½</button><button class="tab-btn" onclick="switchTab('finance')">è²¡å‹™</button><button class="tab-btn" onclick="switchTab('products')">ç”¢å“</button></div>`;
        
        // ç¸½è¦½ Tab
        html += `<div class="tab-content active" id="tab-overview">
            <div class="info-grid">
                <div class="info-item"><div class="info-label">è©•ç­‰</div><div class="info-value">${tracking.rating||'-'}</div></div>
                <div class="info-item"><div class="info-label">ç›®æ¨™åƒ¹</div><div class="info-value large" style="color:#2e7d46">${tracking.targetPrice||'-'}</div></div>
                <div class="info-item"><div class="info-label">EPS</div><div class="info-value">${item.eps||'-'}</div></div>
            </div>
            ${detail.operation ? `<div class="section-block"><h4>ç‡Ÿé‹é‡é»</h4><div class="content-text full-content">${formatContent(detail.operation)}</div></div>` : ''}
            ${detail.strategy ? `<div class="section-block"><h4>ç­–ç•¥æ–¹å‘</h4><div class="content-text">${formatContent(detail.strategy)}</div></div>` : ''}
        </div>`;
        
        // è²¡å‹™ Tab
        html += `<div class="tab-content" id="tab-finance">
            <div class="finance-grid">
                <div class="finance-card"><h4>ç‡Ÿæ”¶ç²åˆ©</h4>
                <div class="finance-item"><span>ç‡Ÿæ”¶YoY</span><span>${finance.revenueYoY||'-'}</span></div>
                <div class="finance-item"><span>æ¯›åˆ©ç‡</span><span>${finance.grossMargin||'-'}</span></div>
                <div class="finance-item"><span>ç¨…å¾Œæ·¨åˆ©</span><span>${finance.netIncome||'-'}</span></div>
                </div>
            </div>
            ${finance.guidance4Q ? `<div class="section-block"><h4>4QæŒ‡å¼•</h4><div>${finance.guidance4Q}</div></div>` : ''}
        </div>`;

        // ç”¢å“ Tab
        html += `<div class="tab-content" id="tab-products">
            ${products.products ? products.products.map(p=>`<div class="product-item"><div class="product-name">${p.name}</div><div class="product-ratio">${p.ratio}</div></div>`).join('') : ''}
            ${products.driver ? `<div class="section-block"><h4>å‹•èƒ½</h4><div>${products.driver}</div></div>`:''}
        </div>`;
        
        document.getElementById('modalBody').innerHTML = html;
        openModal();
    }
    
    function switchTab(tabId) {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
    }

    function openReportModal(id) {
        const r = reportsData.find(x => x.id == id);
        if(!r) return;
        const details = reportDetails[id] || [];
        const stocks = reportStocksData[id] || [];
        
        document.getElementById('modalHeaderInfo').innerHTML = `<div class="modal-meta"><span class="meta-tag broker">${r.broker}</span><span class="meta-tag industry">${r.industry}</span></div><h2 class="modal-title">${r.title}</h2>`;
        
        let html = `<div class="modal-section"><h3 class="section-title">æ ¸å¿ƒé‡é»</h3><div class="content-block">${r.highlights.join('<br>â€¢ ')}</div></div>`;
        
        if(details.length > 0) {
            html += `<div class="modal-section"><h3 class="section-title">ç„¦é»åˆ†æ</h3>${details.map(d => `<div style="margin-bottom:15px;background:#fafaf8;padding:15px;border-left:4px solid #3b82f6;"><div style="font-weight:700;color:#1e40af;margin-bottom:8px;">${d.sectionTitle}</div><div class="content-text">${formatContent(d.content)}</div>${d.marketSize ? `<div style="margin-top:5px;font-size:12px;color:#666;">å¸‚å ´è¦æ¨¡: ${d.marketSize}</div>` : ''}</div>`).join('')}</div>`;
        }
        
        if(stocks.length > 0) {
            html += `<div class="modal-section"><h3 class="section-title">å€‹è‚¡è©•åƒ¹</h3><table class="stock-pick-table"><thead><tr><th>å…¬å¸</th><th>è©•ç­‰</th><th>ç›®æ¨™åƒ¹</th><th>EPS</th></tr></thead><tbody>${stocks.map(s=>`<tr onclick="openStockModal('${s.code}')"><td>${s.name}</td><td>${s.rating}</td><td>${s.target}</td><td>${s.eps25}</td></tr>`).join('')}</tbody></table></div>`;
        }
        
        document.getElementById('modalBody').innerHTML = html;
        openModal();
    }

    function openStrategyModal(id) {
        const r = strategyReports.find(x => x.id == id);
        if(!r) return;
        const themes = strategyThemes[id] || [];
        const quarters = strategyQuarters[id] || [];
        const picks = strategyPicks[id] || [];

        document.getElementById('modalHeaderInfo').innerHTML = `<div class="modal-meta"><span class="meta-tag broker">${r.broker}</span></div><h2 class="modal-title">${r.title}</h2>`;
        
        let html = `<div class="tab-buttons"><button class="tab-btn active" onclick="switchStrategyTab('overview')">ç¸½è¦½</button><button class="tab-btn" onclick="switchStrategyTab('themes')">é¡Œæ</button><button class="tab-btn" onclick="switchStrategyTab('quarters')">å­£åº¦</button><button class="tab-btn" onclick="switchStrategyTab('picks')">é¸è‚¡</button></div>`;
        
        html += `<div class="tab-content active" id="stab-overview"><div class="modal-section"><h3 class="section-title">è§€é»æ‘˜è¦</h3><div class="content-block">${r.macroSummary}</div></div><div class="info-grid"><div class="info-item"><div class="info-label">æŒ‡æ•¸å€é–“</div><div class="info-value">${r.indexLow} - ${r.indexHigh}</div></div></div></div>`;
        
        html += `<div class="tab-content" id="stab-themes">${themes.map(t=>`<div class="product-item"><div class="product-name">${t.topic}</div><div class="product-ratio">${t.content}</div></div>`).join('')}</div>`;
        
        html += `<div class="tab-content" id="stab-quarters"><div class="quarter-grid">${quarters.map(q=>`<div class="quarter-card"><div class="quarter-title">${q.quarter}</div><div class="quarter-factors">åˆ©å¤š:${q.positives}</div></div>`).join('')}</div></div>`;
        
        html += `<div class="tab-content" id="stab-picks"><table class="stock-pick-table"><thead><tr><th>ä»£è™Ÿ</th><th>å…¬å¸</th><th>é¡Œæ</th></tr></thead><tbody>${picks.map(p=>`<tr onclick="openStockModal('${p.stockCode}')"><td>${p.stockCode}</td><td>${p.stockName}</td><td>${p.theme}</td></tr>`).join('')}</tbody></table></div>`;

        document.getElementById('modalBody').innerHTML = html;
        openModal();
    }
    
    function switchStrategyTab(tabId) {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById('stab-' + tabId).classList.add('active');
    }

    function openTrendModal(id) {
        const t = trendsData.find(x => x.id == id);
        if(!t) return;
        document.getElementById('modalHeaderInfo').innerHTML = `<div class="modal-meta"><span class="meta-tag broker">${t.broker}</span></div><h2 class="modal-title">${t.topic}</h2>`;
        document.getElementById('modalBody').innerHTML = `<div class="content-block">${formatContent(t.content)}</div><div style="margin-top:10px;">ç›¸é—œ: ${t.companies}</div>`;
        openModal();
    }

    function openIndustryModal(idx) {
        const item = memoIndustryTrends[idx];
        document.getElementById('modalHeaderInfo').innerHTML = `<div class="modal-meta"><span class="meta-tag industry">${item.industry}</span></div><h2 class="modal-title">${item.industry} å‹•æ…‹</h2>`;
        document.getElementById('modalBody').innerHTML = `
            <div class="info-grid"><div class="info-item"><div class="info-label">è¶¨å‹¢</div><div class="info-value">${item.trend}</div></div></div>
            <div class="modal-section" style="margin-top:15px;"><h3 class="section-title">é—œéµé©…å‹•</h3><div class="content-block">${formatContent(item.driver)}</div></div>
            ${item.outlook2026 ? `<div class="modal-section"><h3 class="section-title">2026å±•æœ›</h3><div class="content-block">${formatContent(item.outlook2026)}</div></div>` : ''}
        `;
        openModal();
    }

    function openStockModal(code) {
        const s = masterStocks[code];
        if(!s) { alert('ç„¡æ­¤å€‹è‚¡è³‡æ–™'); return; }
        const r = revenueData[code] || {};
        const cbs = cbData[code] || [];
        
        document.getElementById('modalHeaderInfo').innerHTML = `<div class="modal-meta"><span class="meta-tag industry">${s.industry}</span></div><h2 class="modal-title">${s.name} (${s.code})</h2>`;
        let html = `<div class="tab-buttons"><button class="tab-btn active" onclick="switchStockTab('basic')">åŸºæœ¬</button><button class="tab-btn" onclick="switchStockTab('rev')">ç‡Ÿæ”¶</button></div>`;
        
        html += `<div class="tab-content active" id="stock-basic">
            <div class="info-grid">
                <div class="info-item"><div class="info-label">è‚¡åƒ¹</div><div class="info-value large">${s.price}</div></div>
                <div class="info-item"><div class="info-label">æ¼²è·Œå¹…</div><div class="info-value">${s.changePercent}</div></div>
                <div class="info-item"><div class="info-label">å¸‚å€¼</div><div class="info-value">${s.marketCap}å„„</div></div>
            </div>
            ${s.business ? `<div class="section-block"><h4>æ¥­å‹™æ‘˜è¦</h4><div class="content-block">${s.business}</div></div>` : ''}
            ${cbs.length > 0 ? `<div class="section-block"><h4>å¯è½‰å‚µ</h4>${cbs.map(c=>`<div class="product-item" style="border-left-color:#e74c3c;">${c.cbName} (è½‰:${c.conversionPrice})</div>`).join('')}</div>` : ''}
        </div>`;
        
        html += `<div class="tab-content" id="stock-rev">`;
        if(r.monthly && r.monthly.length > 0) {
            html += `<table style="width:100%;font-size:12px;border-collapse:collapse;"><tr>${r.monthly.map(m=>`<th style="border:1px solid #ddd;padding:5px;">${m.period}</th>`).join('')}</tr><tr>${r.monthly.map(m=>`<td style="border:1px solid #ddd;padding:5px;text-align:right;">${m.value}</td>`).join('')}</tr></table>`;
        } else {
            html += `<p class="no-data">ç„¡ç‡Ÿæ”¶è³‡æ–™</p>`;
        }
        html += `</div>`;
        
        document.getElementById('modalBody').innerHTML = html;
        openModal();
    }
    
    function switchStockTab(tabId) {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById('stock-' + tabId).classList.add('active');
    }

    </script>
</body>
</html>
