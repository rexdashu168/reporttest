<!DOCTYPE html>

<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rexå¤§å”æŠ•è³‡ç ”ç©¶å®¤ v11.6</title>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root { --primary: #c96442; --bg: #f5f4ef; --text: #333; --gray: #666; --border: #e0e0e0; --link: #2980b9; --up: #e74c3c; --down: #27ae60; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif; background: var(--bg); color: var(--text); padding-bottom: 60px; }
        .container { max-width: 800px; margin: 0 auto; padding: 12px; }
        @media(min-width: 1024px) { .container { max-width: 1400px; padding: 20px; } }
        @media(min-width: 1600px) { .container { max-width: 1600px; } }

```
    .loading-overlay { position: fixed; top:0; left:0; right:0; bottom:0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.3s; }
    .loading-overlay.hidden { opacity: 0; pointer-events: none; }
    .loading-spinner { width: 40px; height: 40px; border: 3px solid #e0e0e0; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .header { text-align: center; padding: 15px 0; border-bottom: 1px solid var(--border); }
    .header h1 { color: var(--primary); font-size: 22px; margin-bottom: 5px; font-weight: 800; }
    .db-switcher { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin: 15px 0; }
    .db-tab { padding: 6px 14px; background: #fff; border: 1px solid var(--border); border-radius: 20px; font-size: 13px; color: var(--gray); cursor: pointer; display: flex; align-items: center; gap: 5px; transition: all 0.2s; }
    .db-tab:hover { border-color: var(--primary); }
    .db-tab.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    .count { background: rgba(0,0,0,0.1); padding: 1px 6px; border-radius: 10px; font-size: 10px; }

    .search-box { position: relative; margin-bottom: 15px; }
    .search-input { width: 100%; padding: 12px 35px 12px 40px; border-radius: 25px; border: 2px solid var(--border); background: #fff; font-size: 15px; outline: none; transition: border-color 0.2s; }
    .search-input:focus { border-color: var(--primary); }
    .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #999; }
    .clear-btn { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); width: 20px; height: 20px; background: #ccc; color: #fff; border-radius: 50%; font-size: 12px; line-height: 20px; text-align: center; cursor: pointer; display: none; }

    /* CB çµ±è¨ˆå€å¡Š */
    .cb-stats { background: #fff5f5; border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid #ffe0e0; }
    .cb-mode-switcher { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
    .cb-mode-tab { padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; border: 1px solid #ddd; background: #fff; color: #666; transition: all 0.2s; }
    .cb-mode-tab:hover { border-color: var(--primary); }
    .cb-mode-tab.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    .cb-sub-switcher { display: flex; gap: 6px; margin-bottom: 12px; padding-left: 10px; }
    .cb-sub-tab { padding: 4px 10px; border-radius: 15px; font-size: 11px; font-weight: 600; cursor: pointer; border: 1px solid #ccc; background: #f9f9f9; color: #666; transition: all 0.2s; }
    .cb-sub-tab:hover { border-color: #e67e22; }
    .cb-sub-tab.active { background: #e67e22; color: #fff; border-color: #e67e22; }
    .cb-stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; }
    .cb-stat-item { background: #fff; padding: 12px 8px; border-radius: 8px; text-align: center; }
    .cb-stat-item.clickable { cursor: pointer; transition: all 0.2s; }
    .cb-stat-item.clickable:hover { background: #fff8f0; border: 1px solid var(--primary); }
    .cb-stat-num { font-size: 22px; font-weight: 800; color: var(--primary); }
    .cb-stat-label { font-size: 11px; color: #888; margin-top: 2px; }
    .cb-ind-title { font-size: 13px; font-weight: 600; color: #666; margin-bottom: 10px; }
    .cb-ind-grid { display: flex; flex-wrap: wrap; gap: 8px; }
    .cb-ind-tag { padding: 6px 12px; background: #fff; border-radius: 20px; font-size: 12px; color: #666; cursor: pointer; transition: all 0.2s; border: 1px solid #eee; }
    .cb-ind-tag:hover { border-color: var(--primary); color: var(--primary); }
    .cb-ind-tag .num { background: var(--primary); color: #fff; padding: 1px 6px; border-radius: 10px; font-size: 10px; margin-left: 4px; }
    
    /* ç«¶æ‹å‰ååè¡¨æ ¼ */
    .auction-top10-table { overflow-x: auto; margin-bottom: 10px; }
    .auction-top10-table table { width: 100%; border-collapse: collapse; font-size: 12px; background: #fff; border-radius: 8px; overflow: hidden; }
    .auction-top10-table th { background: #f8f8f8; padding: 8px 6px; text-align: center; font-weight: 600; color: #555; border-bottom: 1px solid #eee; white-space: nowrap; }
    .auction-top10-table td { padding: 8px 6px; text-align: center; border-bottom: 1px solid #f5f5f5; }
    .auction-top10-table tr:hover { background: #fff8f0; }
    .auction-top10-table .code { color: var(--primary); font-weight: 600; }
    .auction-top10-table .highlight { color: var(--primary); font-weight: 700; }
    .auction-top10-table .highlight-red { color: #e74c3c; font-weight: 700; }
    
    /* æµé€šé¤˜é¡å‰ååè¡¨æ ¼ */
    .balance-top10-table { overflow-x: auto; margin-bottom: 10px; }
    .balance-top10-table table { width: 100%; border-collapse: collapse; font-size: 12px; background: #fff; border-radius: 8px; overflow: hidden; }
    .balance-top10-table th { background: #f8f8f8; padding: 8px 4px; text-align: center; font-weight: 600; color: #555; border-bottom: 1px solid #eee; white-space: nowrap; font-size: 11px; }
    .balance-top10-table td { padding: 6px 4px; text-align: center; border-bottom: 1px solid #f5f5f5; font-size: 11px; }
    .balance-top10-table tr:hover { background: #fff8f0; }
    .balance-top10-table .code { color: var(--primary); font-weight: 600; }
    .balance-top10-table .name-cell { text-align: left; min-width: 80px; max-width: 120px; white-space: normal; line-height: 1.3; }
    .balance-top10-table .highlight-red { color: #e74c3c; font-weight: 700; }
    
    /* æµé€šé¤˜é¡ä¸»è¡¨æ ¼æ¬„å¯¬ç¸®æ¸› */
    .cb-table.balance-table { font-size: 11px; }
    .cb-table.balance-table th, .cb-table.balance-table td { padding: 6px 4px; }
    .cb-table.balance-table .name-col { max-width: 90px; white-space: normal; line-height: 1.3; text-align: left; }
    
    /* ä¸»æ—¨æ¬„ä½ */
    .cb-table .subject-col { text-align: left; font-size: 11px; line-height: 1.4; max-width: 300px; white-space: normal; }
    .cb-table .name-col { max-width: 100px; white-space: normal; line-height: 1.3; text-align: left; }

    .card-list { display: flex; flex-direction: column; gap: 12px; }
    @media(min-width: 1024px) { .card-list:not(.cb-mode) { display: grid; grid-template-columns: repeat(2, 1fr); } }
    @media(min-width: 1400px) { .card-list:not(.cb-mode) { grid-template-columns: repeat(3, 1fr); } }
    .card-list.cb-mode { display: block; }
    .card { background: #fff; padding: 15px; border-radius: 12px; border: 1px solid var(--border); box-shadow: 0 2px 5px rgba(0,0,0,0.02); cursor: pointer; transition: all 0.2s; }
    .card:hover { border-color: var(--primary); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    .card.industry-card { border-left: 4px solid #9b59b6; background: linear-gradient(135deg, #faf8fc 0%, #fff 100%); }
    .card-head { display: flex; justify-content: space-between; margin-bottom: 8px; }
    .card-title { font-weight: 700; font-size: 16px; color: #2c3e50; }
    .card-meta { display: flex; gap: 5px; margin-bottom: 8px; flex-wrap: wrap; }
    .tag { font-size: 11px; padding: 2px 8px; border-radius: 6px; color: #fff; font-weight: 500; }
    .tag.brk { background: var(--primary); }
    .tag.ind { background: #2980b9; }
    .tag.trend-ind { background: #8e44ad; }
    .tag.dt { background: #e0e0e0; color: #666; }
    .tag.concept { background: #8e44ad; }
    .tag.trend-up { background: #27ae60; }
    .tag.trend-down { background: #e74c3c; }
    .tag.cb-tag { background: #e74c3c; font-size: 10px; padding: 1px 6px; }
    .cb-tags { display: flex; gap: 3px; flex-wrap: wrap; margin-left: auto; }
    .card-head { display: flex; align-items: center; gap: 8px; }
    .news-type { font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-right: 6px; font-weight: 600; }
    .news-type.ind-type { background: #9b59b6; color: #fff; }
    
    /* CB åŸºæœ¬è³‡æ–™å­æ¨™ç±¤ */
    .cb-info-tabs { display: flex; gap: 8px; margin: 10px 0; flex-wrap: wrap; }
    .cb-table tr.active-cb td { background: #e8f5e9; }
    .cb-table tr.active-cb:hover td { background: #c8e6c9; }
    
    /* çµæœåˆ—å’Œ CB ç¯©é¸æ¨™ç±¤ */
    .result-bar { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; margin-bottom: 10px; }
    .cb-filter-tags { display: flex; flex-wrap: wrap; gap: 6px; }
    .cb-filter-tag { font-size: 11px; padding: 4px 10px; border-radius: 15px; cursor: pointer; border: 1px solid #ddd; background: #fff; transition: all 0.2s; }
    .cb-filter-tag:hover { border-color: var(--primary); }
    .cb-filter-tag.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    .cb-filter-tag .cnt { margin-left: 4px; opacity: 0.7; }
    .card-body { font-size: 13px; color: #555; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

    /* CB åˆ—è¡¨è¡¨æ ¼ */
    .cb-table-wrap { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .cb-table { width: 100%; border-collapse: collapse; font-size: 13px; background: #fff; border-radius: 8px; overflow: hidden; }
    .cb-table th { background: #f8f9fa; padding: 12px 8px; text-align: center; color: #666; font-weight: 600; border-bottom: 2px solid #eee; white-space: nowrap; }
    .cb-table td { padding: 10px 8px; border-bottom: 1px solid #f0f0f0; text-align: center; white-space: nowrap; }
    .cb-table tr:hover td { background: #fffaf8; }
    .cb-table .code { color: var(--primary); font-weight: 600; cursor: pointer; }
    .cb-table .stock { color: var(--link); cursor: pointer; }
    .cb-table th.sortable { cursor: pointer; user-select: none; }
    .cb-table th.sortable:hover { background: #eee; }
    .cb-table th .sort-icon { font-size: 10px; color: #999; margin-left: 2px; }
    .cb-table th.sort-asc .sort-icon { color: var(--primary); }
    .cb-table th.sort-desc .sort-icon { color: var(--primary); }
    .cb-table th.sort-asc .sort-icon::after { content: 'â†‘'; }
    .cb-table th.sort-desc .sort-icon::after { content: 'â†“'; }
    .cb-table tfoot { background: #f8f9fa; }
    .cb-table tfoot td { border-top: 2px solid #ddd; padding: 12px 8px; }
    
    /* æ‰‹æ©Ÿç‰ˆéš±è—éƒ¨åˆ†æ¬„ä½ */
    @media(max-width: 768px) {
        .cb-table { font-size: 12px; }
        .cb-table th, .cb-table td { padding: 8px 5px; }
        .cb-table .hide-mobile { display: none; }
    }
    
    /* æ¡Œæ©Ÿç‰ˆæ»¿ç‰ˆ */
    @media(min-width: 1024px) {
        .cb-table { font-size: 14px; }
        .cb-table th, .cb-table td { padding: 12px 10px; }
    }

    /* Modal */
    .modal { position: fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.6); z-index: 1000; display: none; justify-content: center; align-items: flex-end; }
    .modal.show { display: flex; }
    .modal-inner { background: #fff; width: 100%; max-width: 650px; height: 92vh; border-radius: 16px 16px 0 0; display: flex; flex-direction: column; animation: slideUp 0.3s; }
    @media(min-width: 1024px) { .modal-inner { max-width: 900px; } }
    @media(min-width: 1400px) { .modal-inner { max-width: 1100px; } }
    @keyframes slideUp { from{transform:translateY(100%)} to{transform:translateY(0)} }
    
    .m-head { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: flex-start; }
    .m-close { width: 32px; height: 32px; border-radius: 50%; border: none; background: #f0f0f0; font-size: 20px; color: #666; cursor: pointer; display: flex; justify-content: center; align-items: center; flex-shrink: 0; }
    .m-close:hover { background: #e0e0e0; }
    
    .nav-grid { display: flex; gap: 4px; padding: 10px 15px; background: #fafafa; border-bottom: 1px solid #eee; overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .nav-btn { padding: 6px 10px; border-radius: 8px; border: none; background: #f0f0f0; font-size: 11px; font-weight: 600; color: #666; cursor: pointer; white-space: nowrap; transition: all 0.2s; flex-shrink: 0; }
    .nav-btn.active { background: var(--primary); color: #fff; }

    .m-body { flex: 1; overflow-y: auto; padding: 15px; background: #fff; -webkit-overflow-scrolling: touch; }
    .tab-pane { display: none; }
    .tab-pane.active { display: block; }
    
    .m-footer-tags { padding: 12px 15px; border-top: 1px solid #eee; background: #fafafa; display: none; }
    .m-footer-tags.show { display: block; }
    .m-footer-tags .tags-wrap { display: flex; flex-wrap: wrap; gap: 6px; }
    .m-footer-tags .tag { padding: 6px 12px; font-size: 12px; cursor: pointer; transition: all 0.2s; }
    .m-footer-tags .tag:hover { transform: scale(1.05); }

    .section-head { font-size: 14px; font-weight: 700; color: #444; margin: 20px 0 10px; padding: 8px 12px; background: linear-gradient(90deg, #f8f9fa, transparent); border-left: 4px solid var(--primary); border-radius: 0 8px 8px 0; }
    .section-head:first-child { margin-top: 0; }
    .hl-block { background: #fafaf8; padding: 12px; border-radius: 8px; border-left: 4px solid var(--primary); margin-bottom: 10px; font-size: 13px; line-height: 1.7; white-space: pre-wrap; }
    .hl-block b { color: var(--primary); }
    .info-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
    .info-label { color: #666; }
    .info-val { font-weight: 600; color: #333; }
    
    .list-item { padding: 12px; border: 1px solid #eee; border-radius: 10px; margin-bottom: 8px; background: #fff; cursor: pointer; transition: all 0.2s; }
    .list-item:hover { border-color: var(--primary); background: #fffaf8; }
    .list-title { font-weight: 700; font-size: 14px; color: #2c3e50; margin-bottom: 4px; }
    .list-sub { font-size: 12px; color: #888; margin-bottom: 6px; }
    .list-content { font-size: 13px; color: #555; line-height: 1.6; white-space: pre-wrap; }

    .tag-link { color: var(--link); cursor: pointer; font-weight: 600; }
    .tag-link:hover { text-decoration: underline; }
    
    .fin-switcher { display: flex; margin-bottom: 10px; border: 1px solid var(--primary); border-radius: 6px; overflow: hidden; }
    .fin-btn { flex: 1; padding: 8px; text-align: center; font-size: 13px; color: var(--primary); background: #fff; cursor: pointer; font-weight: 600; border-right: 1px solid var(--primary); transition: all 0.2s; }
    .fin-btn:last-child { border-right: none; }
    .fin-btn.active { background: var(--primary); color: #fff; }
    .fin-sub-pane { display: none; }
    .fin-sub-pane.active { display: block; }
    
    .rev-unit { text-align: right; font-size: 11px; color: #888; margin-bottom: 8px; }

    .table-wrap { overflow-x: auto; border: 1px solid #eee; border-radius: 8px; margin-bottom: 10px; -webkit-overflow-scrolling: touch; }
    .fin-table { width: 100%; border-collapse: collapse; font-size: 12px; white-space: nowrap; }
    .fin-table th { background: #f8f9fa; padding: 10px 8px; border-bottom: 2px solid #ddd; text-align: right; color: #555; position: sticky; top: 0; }
    .fin-table td { padding: 10px 8px; border-bottom: 1px solid #eee; text-align: right; color: #333; }
    .fin-table th:first-child, .fin-table td:first-child { position: sticky; left: 0; background: #fff; border-right: 1px solid #eee; text-align: left; z-index: 2; font-weight: 700; }
    .fin-table tr:nth-child(even) td { background: #fcfcfc; }
    .fin-table tr:nth-child(even) td:first-child { background: #fcfcfc; }
    .fin-table .highlight-row td { background: #fff3e0; font-weight: 700; }
    .fin-table .highlight-row td:first-child { background: #fff3e0; color: var(--primary); }
    
    .t-up { color: var(--up); font-weight: 700; }
    .t-down { color: var(--down); font-weight: 700; }

    .rating-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 15px; border-radius: 12px; margin-bottom: 15px; }
    .rating-card .big-num { font-size: 28px; font-weight: 800; }
    .rating-card .label { font-size: 12px; opacity: 0.8; }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
    .stat-box { background: #f8f9fa; padding: 12px; text-align: center; border-radius: 8px; }
    .stat-box .num { font-size: 18px; font-weight: 700; color: var(--primary); }
    .stat-box .lbl { font-size: 11px; color: #888; margin-top: 2px; }

    .qa-item { margin-bottom: 15px; }
    .qa-q { background: #e3f2fd; padding: 10px 12px; border-radius: 8px 8px 0 0; font-weight: 600; color: #1565c0; font-size: 13px; }
    .qa-a { background: #f5f5f5; padding: 10px 12px; border-radius: 0 0 8px 8px; font-size: 13px; line-height: 1.6; color: #444; }

    .timeline-item { position: relative; padding-left: 20px; margin-bottom: 12px; }
    .timeline-item::before { content: ''; position: absolute; left: 0; top: 8px; width: 10px; height: 10px; background: var(--primary); border-radius: 50%; }
    .timeline-item::after { content: ''; position: absolute; left: 4px; top: 20px; width: 2px; height: calc(100% + 4px); background: #e0e0e0; }
    .timeline-item:last-child::after { display: none; }
    .timeline-date { font-size: 12px; font-weight: 700; color: var(--primary); }
    .timeline-text { font-size: 13px; color: #444; margin-top: 2px; }

    @media(min-width: 768px) { .modal { align-items: center; } .modal-inner { height: 85vh; border-radius: 16px; } }
    @media(max-width: 480px) { .cb-stats-grid { grid-template-columns: repeat(3, 1fr); } .cb-stat-num { font-size: 18px; } }
</style>
```

</head>
<body>

<div class="loading-overlay" id="loader">
    <div class="loading-spinner"></div>
    <div style="font-weight:700;font-size:18px">Rexå¤§å”æŠ•è³‡ç ”ç©¶å®¤</div>
    <div style="font-size:12px;color:#888;margin-top:8px" id="loadStatus">æ­£åœ¨è¼‰å…¥è³‡æ–™åº«...</div>
</div>

<div class="container">
    <div class="header">
        <h1>ğŸ“Š Rexå¤§å”æŠ•è³‡ç ”ç©¶å®¤</h1>
        <p style="font-size:12px;color:#666">å…¨æ–¹ä½å°è‚¡æŠ•è³‡æ±ºç­–ç³»çµ± v11.6</p>
    </div>

```
<div class="db-switcher">
    <div class="db-tab active" data-db="news">âš¡ å¤–é›» <span class="count" id="c-news">0</span></div>
    <div class="db-tab" data-db="memo">ğŸ“‹ Memo <span class="count" id="c-memo">0</span></div>
    <div class="db-tab" data-db="reports">ğŸ“‘ ç”¢æ¥­ <span class="count" id="c-reports">0</span></div>
    <div class="db-tab" data-db="strategy">ğŸ”® å±•æœ› <span class="count" id="c-strategy">0</span></div>
    <div class="db-tab" data-db="stocks">ğŸ¢ å€‹è‚¡ <span class="count" id="c-stocks">0</span></div>
    <div class="db-tab" data-db="trends">ğŸ“ˆ è¶¨å‹¢ <span class="count" id="c-trends">0</span></div>
    <div class="db-tab" data-db="cb">ğŸ« CB <span class="count" id="c-cb">0</span></div>
    <div class="db-tab" data-db="article">ğŸ“ æ–‡ç«  <span class="count" id="c-article">0</span></div>
</div>

<div class="search-box">
    <span class="search-icon">ğŸ”</span>
    <input type="text" class="search-input" id="search" placeholder="æœå°‹å…¬å¸ã€ä»£è™Ÿã€ç”¢æ¥­ã€#Tag..." oninput="handleInput(this)">
    <div class="clear-btn" id="clearBtn" onclick="clearSearch()">âœ•</div>
</div>

<!-- CB çµ±è¨ˆå€å¡Š (åªåœ¨ CB åˆ†é é¡¯ç¤º) -->
<div id="cbStatsArea" style="display:none"></div>

<!-- å€‹è‚¡çµ±è¨ˆå€å¡Š (åªåœ¨å€‹è‚¡åˆ†é é¡¯ç¤º) -->
<div id="stockStatsArea" style="display:none"></div>

<!-- Memo çµ±è¨ˆå€å¡Š (åªåœ¨ Memo åˆ†é é¡¯ç¤º) -->
<div id="memoStatsArea" style="display:none"></div>

<div class="result-bar">
    <div style="font-size:12px;color:#666;">æ‰¾åˆ° <b id="resCount" style="color:var(--primary)">0</b> ç­†è³‡æ–™</div>
    <div id="cbFilterTags" class="cb-filter-tags" style="display:none"></div>
</div>
<div class="card-list" id="list"></div>
```

</div>

<div class="modal" id="modal" onclick="closeModal(event)">
    <div class="modal-inner" onclick="event.stopPropagation()">
        <div class="m-head">
            <div id="m-info" style="flex:1"></div>
            <button class="m-close" onclick="closeModal()">Ã—</button>
        </div>
        <div class="nav-grid" id="navGrid"></div>
        <div class="m-body" id="m-body"></div>
        <div class="m-footer-tags" id="m-tags"></div>
    </div>
</div>

<script>
const FILES = {
    NEWS: '01_news.xlsx', MEMO: '02_memo.xlsx', REPORTS: '03_reports.xlsx',
    MASTER: '04_master.xlsx', STRAT: '05_Strategy_01.xlsx', CB: '00_CB.xlsx', REV: '06_revenue.xlsx', ARTICLE: '07_article.xlsx'
};

const DB = { 
    news:[], memo:[], memoStock:[], memoIndustry:[], reports:[], strategy:[], stocks:{}, 
    cb:[], cbHistory:[], cbAuction:[], cbPrimary:[], cbBoard:[], cbBalance:[], cbCBAS:[],
    cbRedeem:[], cbStopConv:[], cbPriceAdj:[], cbConcept:[], cbAll:[],
    conceptLists: {}, // å„æ¦‚å¿µè‚¡æ¸…å–® { 'NVDIAæ¦‚å¿µè‚¡': ['6579','2353',...], ... }
    trends:[], conceptStocks:[], article:[] 
};
let CB_MODE = 'info'; // 'info' åŸºæœ¬è³‡æ–™, 'active' æ›ç‰Œä¸­, 'history' æ­·å², 'auction' ç«¶æ‹, 'primary' åˆç´šå¸‚å ´, 'balance' æµé€šé¤˜é¡, 'cbas' CBASå ±åƒ¹
let CB_INFO_TAB = 'issue'; // 'issue' ç™¼è¡Œæ¢ä»¶, 'timeline' æ™‚ç¨‹è³‡è¨Š, 'putback' è³£å›æ¢ä»¶
let PRIMARY_MODE = 'underwriting'; // 'underwriting' æ‰¿éŠ·ä¸­, 'board' è‘£äº‹æœƒå…¬å‘Š
let STOCK_MODE = 'all'; // 'all' å…¨éƒ¨å€‹è‚¡, 'concept' æ¦‚å¿µè‚¡
let MEMO_MODE = 'all'; // 'all' å…¨éƒ¨, 'stock' å€‹è‚¡, 'industry' ç”¢æ¥­
let ARTICLE_FILTER = 'all'; // 'all' å…¨éƒ¨, 'beginner' å…¥é–€ç´š, 'advanced' é€²éšç´š, 'expert' é«˜éšç´š
const META = { 
    memoDetail:{}, tracking:{}, finance:{}, products:{}, 
    concepts:{}, cbMap:{}, relatedNews:{}, relatedMemo:{},
    reportFocus:{}, reportViews:{}, reportRatings:{},
    stratMacro:{}, stratFundamental:{}, stratTheme:{}, stratChip:{}, stratTech:{}, stratQuarter:{}, stratPicks:{},
    revData: { month:{}, quarter:{}, year:{}, highlights:{} },
    cbStats: { total: 0, companies: 0, industries: {}, totalBalance: 0 },
    cbPrimaryStats: { underwriting: 0, board: 0 },
    cbBalanceStats: { total: 0, totalBalance: 0 },
    cbCBASStats: { total: 0 },
    stockStats: { total: 0, conceptTotal: 0, markets: {}, industries: {}, conceptCategories: {} },
    memoStats: { total: 0, stockTotal: 0, industryTotal: 0, brokers: {}, types: {} }, articleContent: {}
};

let CURR_DB = 'news';
const $ = id => document.getElementById(id);
const safe = v => (v==null||v==undefined?'':String(v).trim());

// çµ±ä¸€ä»£ç¢¼è™•ç†å‡½æ•¸
const normalizeCode = v => {
    if(!v) return '';
    let s = String(v).trim();
    // ç§»é™¤ .0 (Excel æ•¸å­—æ ¼å¼)
    if(s.match(/^\d+\.0$/)) s = s.replace('.0', '');
    // ç§»é™¤ TT å¾Œç¶´
    s = s.replace(/\s*TT$/i, '');
    // è£œé›¶åˆ°4ä½
    if(s.match(/^\d{1,4}$/) && s.length < 4) s = s.padStart(4, '0');
    return s;
};

const fmtDate = v => {
    if(!v) return '';
    if(typeof v === 'number' && v > 20000) { 
        const d = new Date((v-25569)*86400000); 
        return `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')}`; 
    }
    return String(v).split(' ')[0].split('T')[0];
};
const getDateVal = v => { if(!v) return 0; if(typeof v === 'number') return (v-25569)*86400000; return new Date(v).getTime(); };
const fmtNum = (v, decimal=0) => {
    if(v===undefined||v===null||v==='') return '-';
    let n = parseFloat(String(v).replace(/,/g,''));
    if(isNaN(n)) return v;
    return decimal > 0 ? n.toFixed(decimal) : n.toLocaleString();
};
const colorClass = v => {
    if(!v||v==='-') return '';
    let n = parseFloat(String(v).replace(/[%$,]/g,''));
    return n>0?'t-up':n<0?'t-down':'';
};

const fmtTxt = t => {
    if(!t) return '';
    let html = safe(t).replace(/\n/g, '<br>');
    html = html.replace(/#(\S+)/g, '<span class="tag-link" onclick="setSearch(\'#$1\');closeModal()">#$1</span>');
    return html;
};

function handleInput(el) { 
    $('clearBtn').style.display = el.value.length > 0 ? 'block' : 'none'; 
    renderList(); 
}
function clearSearch() { 
    $('search').value=''; 
    $('search').focus(); 
    $('clearBtn').style.display='none'; 
    renderList(); 
}
window.setSearch = term => { $('search').value = term; handleInput($('search')); };

async function fetchXlsx(url) {
    try {
        $('loadStatus').innerText = `è¼‰å…¥ ${url}...`;
        const res = await fetch(url);
        if(!res.ok) throw new Error();
        return XLSX.read(await res.arrayBuffer(), {type:'array'});
    } catch(e) { console.warn('Load Error:', url); return null; }
}

async function init() {
    // é¡¯ç¤ºæç¤ºè¨Šæ¯
    $('loadStatus').innerHTML = 'âš ï¸ è«‹å°‡ Excel æª”æ¡ˆæ”¾åœ¨ç›¸åŒç›®éŒ„<br><small>éœ€è¦ï¼š00_CB.xlsx, 01_news.xlsx, 02_memo.xlsx, 03_reports.xlsx,<br>04_master.xlsx, 05_Strategy_01.xlsx, 06_revenue.xlsx, 07_article.xlsx</small>';
    
    // 3ç§’å¾Œéš±è— loader
    setTimeout(() => {
        $('loader').classList.add('hidden');
        alert('é€™æ˜¯æ¸¬è©¦ç‰ˆæœ¬ï¼Œè«‹ç¢ºä¿æ‰€æœ‰ Excel æª”æ¡ˆéƒ½æ”¾åœ¨ç›¸åŒç›®éŒ„ä¸‹ã€‚\n\néœ€è¦çš„æª”æ¡ˆï¼š\n- 00_CB.xlsx\n- 01_news.xlsx\n- 02_memo.xlsx\n- 03_reports.xlsx\n- 04_master.xlsx\n- 05_Strategy_01.xlsx\n- 06_revenue.xlsx\n- 07_article.xlsx');
    }, 3000);
    
    // è¨­å®šé ç±¤åˆ‡æ›
    document.querySelectorAll('.db-tab').forEach(tab => {
        tab.onclick = () => {
            CURR_DB = tab.dataset.db;
            document.querySelectorAll('.db-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            renderList();
        };
    });
    
    renderList();
}

function renderList() {
    const list = $('list');
    list.innerHTML = `
        <div style="text-align:center;padding:50px;color:#999">
            <div style="font-size:48px;margin-bottom:20px">ğŸ“Š</div>
            <div style="font-size:18px;font-weight:600;margin-bottom:10px">Rexå¤§å”æŠ•è³‡ç ”ç©¶å®¤ v11.6</div>
            <div style="font-size:14px;line-height:1.8">
                é€™æ˜¯æ¸¬è©¦ç‰ˆæœ¬<br>
                è«‹å°‡æ‰€æœ‰ Excel æª”æ¡ˆæ”¾åœ¨ç›¸åŒç›®éŒ„ä¸‹<br><br>
                <b>éœ€è¦çš„æª”æ¡ˆï¼š</b><br>
                00_CB.xlsx, 01_news.xlsx, 02_memo.xlsx,<br>
                03_reports.xlsx, 04_master.xlsx,<br>
                05_Strategy_01.xlsx, 06_revenue.xlsx, 07_article.xlsx
            </div>
        </div>
    `;
    $('resCount').innerText = '0';
}

window.onload = init;
</script>

</body>
</html>